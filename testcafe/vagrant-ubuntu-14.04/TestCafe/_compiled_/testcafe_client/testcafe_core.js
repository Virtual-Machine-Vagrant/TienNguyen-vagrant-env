!function(){window.initTestCafeClientCore=function(e){var t=e.HammerheadClient,n=e.TestCafeClient=new t.Mods,o=e.document;n.define("Automation",function(n,o){function i(e,t,n){if(/click|drag|select|type|hover/.test(e.type)&&!e.element)return void n();switch(e.type){case"click":t.run(e.element,e.apiArguments.options,n,{prevSelectedIndex:e.serviceInfo.prevPageState&&e.serviceInfo.prevPageState.affectedElementSelectedIndex?e.serviceInfo.prevPageState.affectedElementSelectedIndex:null});break;case"rclick":t.run(e.element,e.apiArguments.options,n);break;case"dblclick":t.run(e.element,e.apiArguments.options,n);break;case"drag":var o={dragOffsetX:e.apiArguments.dragOffsetX,dragOffsetY:e.apiArguments.dragOffsetY};t.run(e.element,o,e.apiArguments.options,n,{screenPointTo:e.endPosition});break;case"select":var i={startPos:e.apiArguments.startPos,endPos:e.apiArguments.endPos};t.run(e.element,i,n,{screenPointTo:e.endPosition});break;case"type":t.run(e.element,e.apiArguments.text,e.apiArguments.options,n);break;case"press":t.run(e.apiArguments.keysCommand,n);break;case"hover":t.run(e.element,e.apiArguments.options,n);break;default:n()}}function r(e){if(e.selector){var t=f.parseSelectorSync(e.selector).$elements;t&&t.length&&(1===t.length?e.element=t[0]:e.elements=t.toArray())}}var a=t.get("Hammerhead"),s=n("Settings"),l=a.$,c=a.async,E=a.EventSandbox,u=a.EventSimulator,_=a.Util,f=n("Base.JavascriptExecutor"),d=n("Automation.Click.Playback"),T=n("Automation.RClick.Playback"),S=n("Automation.DblClick.Playback"),A=n("Automation.Drag.Playback"),p=n("Automation.Select.Playback"),I=n("Automation.Press.Playback"),m=n("Automation.Type.Playback"),R=n("Automation.Hover.Playback"),g=/blur|focus|(dbl)?click|contextmenu|key|mouse|pointer/i,N={type:"",serviceInfo:{prevPageState:null,isDeferred:!1}},C=l.extend(!0,{},N,{element:null,selector:null,serviceInfo:{selectors:[]}});o.AUTOMATION_RUNNERS="tc-ar-73630b99",o.SUPPORTED_SHORTCUTS=["ctrl+a","backspace","delete","left","right","up","down","shift+left","shift+right","shift+up","shift+down","shift+home","shift+end","home","end","enter","tab","shift+tab"],o.ADD_ACTION_SHORTCUTS={wait:"Ctrl+Q",hover:"Ctrl+Space",screenshot:"Ctrl+M"},o.defaultMouseActionDescriptor=l.extend(!0,{},C,{apiArguments:{options:{ctrl:!1,alt:!1,shift:!1,meta:!1,offsetX:"",offsetY:""}},serviceInfo:{useOffsets:!1}}),o.defaultDragActionDescriptor=l.extend(!0,{},o.defaultMouseActionDescriptor,{type:"drag",apiArguments:{dragOffsetX:0,dragOffsetY:0},startPosition:null,endPosition:null}),o.defaultHoverActionDescriptor=l.extend(!0,{},C,{type:"hover"}),o.defaultTypeActionDescriptor=l.extend(!0,{},o.defaultMouseActionDescriptor,{type:"type",apiArguments:{text:"",options:{replace:!1,caretPos:""}}}),o.defaultPressActionDescriptor=l.extend(!0,{},N,{type:"press",apiArguments:{keysCommand:""}}),o.defaultWaitActionDescriptor={type:"wait",apiArguments:{ms:""}},o.defaultScreenshotActionDescriptor={type:"screenshot"},o.defaultSelectActionDescriptor=l.extend(!0,{},C,{type:"select",apiArguments:{startPos:null,endPos:null}});var h=!1,O=function(t,n,o){var i=t.target||t.srcElement;if(!(!g.test(t.type)||n||s.RECORDING&&!s.PLAYBACK&&!h||s.PLAYBACK&&_.isShadowUIElement(i))){if("blur"===t.type){var r=l(i);if(_.isIE&&_.browserVersion<12)(!_.isWindowInstance(i)&&"none"===r.css("display")||r.parents().filter(function(){return"none"===this.style.display}).length)&&e.setTimeout(function(){u.blur(r[0])},0);else if(i!==e&&i!==e.document&&!r.is(":visible"))return}o()}},v=!1;o.init=function(){v||(E.addFirstInternalHandler(e,_.RECORDING_LISTENED_EVENTS,O),v=!0)};var M=e[o.AUTOMATION_RUNNERS]={click:{playback:d},rclick:{playback:T},dblclick:{playback:S},drag:{playback:A},select:{playback:p},press:{playback:I},type:{playback:m},hover:{playback:R}};o.playback=function(e,t){var n=null,o=0;return M[e.type]?(h=!0,r(e),void c.forEachSeries(e.elements||[],function(t,r){return n=l.extend(n,e),n.element=t,delete n.elements,o===e.elements.length-1?void r():void i(n,M[n.type].playback,function(){n={},o++,r()})},function(){n=n||e,i(n,M[n.type].playback,function(){h=!1,t()})})):void t()}}),n.define("Automation.IFrameBehavior",function(e,n){function i(e){var t=e.message,n=null,i=null;switch(t.cmd){case c.CURSOR_START_REQUEST_CMD:(!l.RECORDING||l.PLAYBACK)&&_.start(t.position,function(){s.sendServiceMsg({cmd:c.CURSOR_START_RESPONSE_CMD},e.source)},e.source);break;case c.MOVE_TO_IFRAME_REQUEST_CMD:var r=_.getPosition();if(!r)return void s.sendServiceMsg({cmd:c.MOVE_TO_IFRAME_RESPONSE_CMD,point:null},e.source);var f=a.getFixedPosition(t.point,e.source),d=a.clientToOffsetCoord(r);n=a.getIFrameCoordinates(e.source),a.checkPresenceInRectangle(d,n)&&a.checkPresenceInRectangle(f,n)?s.sendServiceMsg({cmd:c.MOVE_TO_IFRAME_RESPONSE_CMD,point:t.point},e.source):(i=a.findLineAndRectangelIntersection(d,f,n),E.run(i,!1,{},function(){s.sendServiceMsg({cmd:c.MOVE_TO_IFRAME_RESPONSE_CMD,point:a.getFixedPositionForIFrame(i,e.source)},e.source)}));break;case c.MOVE_CURSOR_IN_IFRAME_PING:t.isPingRequest&&s.sendServiceMsg({cmd:c.MOVE_CURSOR_IN_IFRAME_PING,isPingResponse:!0},e.source);break;case c.MOVE_FROM_IFRAME_REQUEST_CMD:var T=o.documentElement,S=T.scrollHeight>T.clientHeight?a.getScrollbarSize():0,A=T.scrollWidth>T.clientWidth?a.getScrollbarSize():0;n={left:t.rectangle.left,right:t.rectangle.right-S,top:t.rectangle.top,bottom:t.rectangle.bottom-A},a.checkPresenceInRectangle(t.endPoint,n)?(_.setPosition(t.cursorPosition),i=a.findLineAndRectangelIntersection(t.startPoint,t.endPoint,n),i={x:i.x-n.left,y:i.y-n.top},E.run(a.clientToOffsetCoord(i),!1,{},function(){s.sendServiceMsg({cmd:c.MOVE_FROM_IFRAME_RESPONSE_CMD,point:i},e.source)})):s.sendServiceMsg({cmd:c.MOVE_FROM_IFRAME_RESPONSE_CMD,point:null},e.source);break;case c.SCROLL_TOP_WINDOW_REQUEST_CMD:u.setScroll(e.source,t.point,t.options,function(){s.sendServiceMsg({cmd:c.SCROLL_TOP_WINDOW_RESPONSE_CMD},e.source)});break;case c.GET_IFRAME_POSITION_DATA_REQUEST_CMD:var p=u.getScrollData(e.source);p.cmd=c.GET_IFRAME_POSITION_DATA_RESPONSE_CMD,s.sendServiceMsg(p,e.source)}}var r=t.get("Hammerhead"),a=r.Util,s=r.MessageSandbox,l=e("Settings"),c=e("Base.CrossDomainMessages"),E=e("Automation.Move.Playback"),u=e("Automation.Scroll"),_=e("UI.Cursor");n.init=function(){s.on(s.SERVICE_MSG_RECEIVED,i)},n.destroy=function(){s.off(s.SERVICE_MSG_RECEIVED,i)}}),n.define("Automation.Scroll",function(e,n){var i=t.get("Hammerhead"),r=i.$,a=i.Util,s=e("Automation.Scroll.Playback");n.setScroll=function(e,t,n,o){var i=a.getIFrameByWindow(e),r=t?a.getFixedPosition(t,e,!0):i,l=t?null:n;s.run(r,l,null,o)},n.getScrollData=function(e){var t=a.getIFrameByWindow(e);return{scroll:a.getElementScroll(r(a.findDocument(o))),iFrameOffset:a.getOffsetPosition(t),iFrameBorders:a.getBordersWidth(r(t)),iFramePadding:a.getElementPadding(r(t))}}}),n.define("Automation.Settings",function(e,t){t.MOVING_SPEED=1e3,t.MOVING_SPEED_IN_DRAGGING=4,t.MINIMUM_MOVING_TIME=25,t.ACTION_STEP_DELAY=80,t.CLICK_STEP_DELAY=160,t.DRAG_ACTION_STEP_DELAY=100}),n.define("Automation.Util",function(e,n){var i=t.get("Hammerhead"),r=i.$,a=i.ContentEditableHelper,s=i.TextSelection,l=e("UI.Cursor"),c=i.Util,E=i.EventSandbox,u=r(o);n.getMouseActionPoint=function(e,t,n){var o=c.getOffsetPosition(e),i=e===u[0].documentElement?0:o.left,a=e===u[0].documentElement?0:o.top,s=c.getElementScroll(r(e)),l=c.findCenter(e);return t&&"undefined"!=typeof t.offsetX&&!isNaN(parseInt(t.offsetX))&&(l.x=i+(t.offsetX||0)),t&&"undefined"!=typeof t.offsetY&&!isNaN(parseInt(t.offsetY))&&(l.y=a+(t.offsetY||0)),n?(!/html/i.test(e.tagName)&&c.hasScroll(e,c.findDocument(e))&&(l.x-=s.left,l.y-=s.top),c.offsetToClientCoords(l)):l},n.getEventOptionCoordinates=function(e,t){var n={x:t.x,y:t.y};if(c.isElementInIframe(e)){var o=c.getIFrameByElement(e);if(o){var i=c.getOffsetPosition(o),a=c.getBordersWidth(r(o)),s=c.offsetToClientCoords({x:i.left,y:i.top});n.x-=s.x+a.left,n.y-=s.y+a.top}}return n},n.focusAndSetSelection=function(e,t,o,i){var l=c.getActiveElement(),u=c.isTextEditableElement(e),_=c.isContentEditableElement(e),f=_?a.findContentEditableParent(e):e,d=null,T=u||_,S=r(e).closest("label[for]");o&&c.isWebKit&&u&&s.select(e,0,0),S.length&&!c.isElementFocusable(r(e))?o?n.focusElementByLabel(S,i):i():E.focus(f,function(){if(!_&&o&&e!==c.getActiveElement())return void i();if(T)if(_&&isNaN(parseInt(t.caretPos)))s.setCursorToLastVisiblePosition(e);else{var n=isNaN(parseInt(t.caretPos))?e.value.length:t.caretPos;s.select(e,n,n)}else d=a.findContentEditableParent(f),d&&s.setCursorToLastVisiblePosition(f);o||l===c.getActiveElement()?i():E.focus(l,i,!0,!0)},!o,!0)},n.focusLabelChildElement=function(e,t){var n=r(e).closest("label[for]");if(n.length&&!c.isElementFocusable(r(e))){var o=r("#"+n.attr("for"),c.findDocument(n[0]));if(o.length){var i=o[0];if(c.getActiveElement()!==i)return void E.focus(i,t,!1,!0)}}t&&t()},n.focusElementByLabel=function(e,t){var n=r("#"+e.attr("for"),c.findDocument(e[0]));if(n.length){var o=n[0];if(c.getActiveElement()!==o)return void E.focus(o,t,!1,!0)}t&&t()},n.getDragEndPoint=function(e,t,n){var i=n!==o,a={x:e.x+Math.floor(t.dragOffsetX),y:e.y+Math.floor(t.dragOffsetY)},s=0,l=0;if(i){var E=c.getIFrameByElement(n);if(E){var u=c.getOffsetPosition(E),_=c.getBordersWidth(r(E));s=u.left+_.left,l=u.top+_.top}}return s+=r(n).width(),l+=r(n).height(),a.x=a.x<0?0:a.x,a.x=a.x>s?s:a.x,a.y=a.y<0?0:a.y,a.y=a.y>l?l:a.y,a},n.getElementUnderCursor=function(e,t,n,o){var i=l.getElementUnderCursor(e,t,n);if(!o||!c.isDomElement(o)||i===o||"a"!==o.tagName.toLowerCase()&&!r(o).parents("a").length||!r(o).text().length)return i;if(o&&c.isDomElement(o)&&"a"===o.tagName.toLowerCase()&&i!==o&&r(o).has(i).length&&r(i).text().length)return i;var a=o.getBoundingClientRect(),s=l.getElementUnderCursor(a.right-1,a.top+1,n);return s&&s===o||r(o).has(s).length&&r(s).text().length?s:(s=l.getElementUnderCursor(a.left+1,a.bottom-1),s&&s===o||r(o).has(s).length&&r(s).text().length?s:i)}}),n.define("Base.CrossDomainMessages",function(e,t){t.IFRAME_TEST_RUNNER_PING_DISPATCHER_CMD="pingIFrameDispatcher",t.IFRAME_TEST_RUNNER_RUN_CMD="runInIFrameTestRunner",t.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_REQUEST_CMD="waitingStepCompletionRequest",t.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_RESPONSE_CMD="waitingStepCompletionResponse",t.IFRAME_TEST_RUNNER_STEP_COMPLETED_CMD="iframeTestRunnerStepCompleted",t.CURSOR_START_REQUEST_CMD="cursorStartRequest",t.CURSOR_START_RESPONSE_CMD="cursorStartResponse",t.MOVE_TO_IFRAME_REQUEST_CMD="moveToIFrameRequest",t.MOVE_TO_IFRAME_RESPONSE_CMD="moveToIFrameResponse",t.MOVE_CURSOR_IN_IFRAME_PING="moveCursorInIFramePing",t.MOVE_FROM_IFRAME_REQUEST_CMD="moveFromIFrameRequest",t.MOVE_FROM_IFRAME_RESPONSE_CMD="moveFromIFrameResponse",t.SCROLL_TOP_WINDOW_REQUEST_CMD="scrollTopWindowRequest",t.SCROLL_TOP_WINDOW_RESPONSE_CMD="scrollTopWindowResponse",t.GET_IFRAME_POSITION_DATA_REQUEST_CMD="getIFramePositionDataRequest",t.GET_IFRAME_POSITION_DATA_RESPONSE_CMD="getIFramePositionDataResponse",t.GENERATE_GENERAL_PROPERTIES_IN_IFRAME_REQUEST_CMD="generateGeneralPropertiesRequest",t.GENERATE_GENERAL_PROPERTIES_IN_IFRAME_RESPONSE_CMD="generateGeneralPropertiesResponse",t.GENERATE_CSS_PROPERTIES_IN_IFRAME_REQUEST_CMD="generateCssPropertiesRequest",t.GENERATE_CSS_PROPERTIES_IN_IFRAME_RESPONSE_CMD="generateCssPropertiesResponse",t.GENERATE_ATTRIBUTES_IN_IFRAME_REQUEST_CMD="generateAttributesRequest",t.GENERATE_ATTRIBUTES_IN_IFRAME_RESPONSE_CMD="generateAttributesResponse",t.ASSERT_REQUEST_CMD="assertRequest",t.ASSERT_RESPONSE_CMD="assertResponse",t.OBJECT_VIEWER_GET_OBJECT_VIEW_REQUEST_CMD="objectViewerGetObjectViewRequest",t.OBJECT_VIEWER_GET_OBJECT_VIEW_RESPONSE_CMD="objectViewerGetObjectViewResponse",t.OBJECT_VIEWER_GET_OBJECT_PROPERTIES_ROWS_REQUEST_CMD="objectViewerGetObjectPropertiesRowsRequest",t.OBJECT_VIEWER_GET_OBJECT_PROPERTIES_ROWS_RESPONSE_CMD="objectViewerGetObjectPropertiesRowsResponse"}),n.define("Base.IFrameDispatcher",function(n,i){var r=null,a=null;!function(){function s(e){I?e():m.push(e)}function l(e){R?s(function(){a(e.stepName,e.step,0,function(){g.run.apply(g,arguments)})}):(R=!0,r(g,function(e){a=e}),s(function(){a(e.stepName,e.step,0,function(){g.act._start.apply(g,arguments)})}))}function c(t){var n=E.$,i=!1,r=function(){i||(i=!0,t())};n(e).load(r),n(o).ready(function(){_.isIFrameWindowInDOM(e)&&e.setTimeout(r,N)})}var E=t.get("Hammerhead"),u=E.MessageSandbox,_=E.Util,f=n("ActionBarrier.Xhr"),d=n("Base.CrossDomainMessages"),T=n("Automation"),S=n("Automation.IFrameBehavior"),A=n("UI.Cursor"),p=n("TestRunner.IFrameTestRunner"),I=!1,m=[],R=!1,g=new p;i.MESSAGE_RECEIVED="messageReceived",i.init=function(t){T.init(),r=t;var n=new _.EventEmitter;i.on=function(){n.on.apply(n,arguments)},i.off=function(){n.off.apply(n,arguments)},u.on(u.SERVICE_MSG_RECEIVED,function(t){var o=t.message;switch(o.cmd){case d.IFRAME_TEST_RUNNER_RUN_CMD:l(o);break;case d.IFRAME_TEST_RUNNER_PING_DISPATCHER_CMD:o.isPingRequest&&u.sendServiceMsg({cmd:d.IFRAME_TEST_RUNNER_PING_DISPATCHER_CMD,isPingResponse:!0},e.top);break;default:n.emit(i.MESSAGE_RECEIVED,o)}})};var N=3e3,C=200;f.init();var h=!1;S.init(),A.init(),c(function(){h||(h=!0,e.setTimeout(function(){f.waitPageInitialRequests(function(){u.on(u.SERVICE_MSG_RECEIVED,function(t){var n=t.message;n.cmd===d.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_RESPONSE_CMD&&(g.onStepCompleted(),g.testIterator.state.stopped||u.sendServiceMsg({cmd:d.IFRAME_TEST_RUNNER_STEP_COMPLETED_CMD},e.top))});var t={cmd:d.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_REQUEST_CMD};u.sendServiceMsg(t,e.top),I=!0;for(var n=0;n<m.length;n++)m[n]()})},C))})}()}),n.define("Base.JavascriptExecutor",function(n,i){function r(e){if(e instanceof NodeList||e instanceof HTMLCollection||l.isArray(e)||c.isJQueryObj(e)){for(var t=0;t<e.length;t++)if(!c.isDomElement(e[t]))return!1;return!0}return!1}function a(e){var t=[];return t.push("(function (window, document, jQuery, $) {"),t.push("var savedAlert = window.alert;window.alert = new Function();"),t.push("var savedConfirm = window.confirm;window.confirm = new Function();"),t.push("var savedPrompt = window.prompt;window.prompt = new Function();"),t.push("var savedConsoleLog = null; if(window.console) {savedConsoleLog = window.console.log;window.console.log = new Function();}"),t.push("var saved$ = window.$, savedJQuery = window.jQuery; window.$ = $; window.jQuery = $;"),t.push("var err = null;"),t.push("try { var res = (function () { return "+f.process(e)+"})(); } catch (e) {err = e;}"),t.push("window.alert = savedAlert;"),t.push("window.confirm = savedConfirm;"),t.push("window.prompt = savedPrompt;"),t.push("if(savedConsoleLog){window.console.log = savedConsoleLog;}"),t.push("window.$ = saved$; window.jQuery = savedJQuery;"),t.push("if(err)throw err;"),t.push("return res;"),t.push("})(window.parent, window.parent.document, window.$, window.$)"),g().contentWindow.eval(t.join(""))}var s=t.get("Hammerhead"),l=s.$,c=s.Util,E=s.NativeMethods,u=s.ShadowUI,_=s.MessageSandbox,f=s.JSProcessor,d=n("Base.jQueryExtensions.Selectors"),T="safeExecutor",S="safeExecutorIFrame",A=null,p=null,I=null;i.EMPTY_SELECTOR_ERROR="Empty element selector",i.INVALID_ELEMENTS_IN_JQUERY_OBJECT_ERROR="jQuery object contains invalid elements",i.INVALID_ELEMENTS_IN_ARRAY_ERROR="Array contains invalid elements",i.INVALID_OBJECT_ERROR="Invalid object type",i.RECURSIVE_JQUERY_CALLING_ERROR="Maximum call stack size exceeded",i.SELECTOR_DOES_NOT_CONTAIN_ELEMENT_ERROR="Selector doesn't contain any element",i.JAVASCRIPT_ERROR_PREFIX="Javascript error: ";var m=e.top!==e.self,R=function(){return A&&O(A)||(A=u.getRoot().find(" > div[class]").filter(function(){return 0===l(this).attr("class").indexOf(T)}),A.length||(A=l(E.createElement.call(o,"div")),E.appendChild.call(u.getRoot()[0],A[0]),u.addClass(A,T))),A},g=function(){return p&&O(l(p))||N(),p},N=function(){C(),h()},C=function(){var e=R().find("iframe");e.length||(e=l(E.createElement.call(o,"iframe")),e.css("display","none"),E.appendChild.call(R()[0],e[0]),u.addClass(e,S)),p=e.get(0),e.load(h)},h=function(){p&&O(l(p))||C();try{Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(p.contentWindow.document,"body")&&Object.getOwnPropertyDescriptor(p.contentWindow.document,"body").configurable?(Object.defineProperty(p.contentWindow.document,"body",{get:function(){return e.document.body},configurable:!0}),I=!0):I=!1}catch(t){I=!1}var n=d.create(s.SandboxedJQuery);d.init(),p.contentWindow.$=p.contentWindow.jQuery=function(e,t){if(e===arguments.callee||t===arguments.callee)throw new Error(i.RECURSIVE_JQUERY_CALLING_ERROR);return n(e,t)},p.contentWindow.alert=p.contentWindow.confirm=p.contentWindow.prompt=new Function,p.contentWindow[f.CALL_METHOD_METH_NAME]=e[f.CALL_METHOD_METH_NAME],p.contentWindow[f.GET_LOCATION_METH_NAME]=e[f.GET_LOCATION_METH_NAME],p.contentWindow[f.GET_PROPERTY_METH_NAME]=e[f.GET_PROPERTY_METH_NAME],p.contentWindow[f.PROCESS_SCRIPT_METH_NAME]=e[f.PROCESS_SCRIPT_METH_NAME],p.contentWindow[f.SET_LOCATION_METH_NAME]=new Function,p.contentWindow[f.SET_PROPERTY_METH_NAME]=new Function},O=function(e){return!!e.parents("body").length},v=function(e){var t=null,n=null,o=function(){return{result:t,error:n}};if(c.isJQueryObj(e))return r(e)?t=e:n=i.INVALID_ELEMENTS_IN_JQUERY_OBJECT_ERROR,o();if("string"==typeof e||c.isDomElement(e)||e instanceof NodeList||e instanceof HTMLCollection)try{var a=l(e);return c.isJQueryObj(a)&&(t=a),o()}catch(s){return n=i.JAVASCRIPT_ERROR_PREFIX+s,o()}if(l.isArray(e)){t=l();for(var E=0;E<e.length;E++){var u=v(e[E]);if(u.error)return n=u.error,o();if(!u.result)return n=i.INVALID_ELEMENTS_IN_ARRAY_ERROR,o();t=t.add(u.result)}return o()}return"function"==typeof e?(t=i.eval(e+"()",function(e){n=i.JAVASCRIPT_ERROR_PREFIX+e}),n?o():v(t)):o()};i.eval=function(e,t){try{return I||(e=e.replace(/(^|[^a-z0-9_\$])document.body($|[^a-z0-9_\$])/g,function(e,t,n){return t+(m?"window.document.body":"window.top.document.body")+n})),a(e)}catch(n){t(n)}},i.parseSelector=function(t,n,o,r){if(!r||e.top!==e.self||r.top===r.self)return void o(i.parseSelectorSync(t,n));P=o;var a={cmd:M,selector:t,parseDomElementsOrJqueryObjectsOnly:n};_.sendServiceMsg(a,r)},i.parseSelectorSync=function(e,t){function n(){return 2===a.length&&c.isSelectElement(a[0])&&/option|optgroup/.test(a[1].tagName.toLowerCase())&&a.eq(0).has(a.last()).length}var o=null,a=null,s=null,E="";if(!e.length)return{$elements:null,length:0,$visibleElements:null,visibleLength:0,iframeContext:!1,error:i.EMPTY_SELECTOR_ERROR,selector:e};if(o=i.eval(e,function(e){E=i.JAVASCRIPT_ERROR_PREFIX+e.message}),!E)if(c.isJQueryObj(o))r(o)?a=o:E=i.INVALID_ELEMENTS_IN_JQUERY_OBJECT_ERROR;else if(t)c.isDomElement(o)||r(o)?a=l(o):E=i.SELECTOR_DOES_NOT_CONTAIN_ELEMENT_ERROR;else{var u=v(o);u.error?E=u.error:u.result?a=u.result:E=i.INVALID_OBJECT_ERROR}var _=!1;return a&&!E&&(_=n(),s=_?a:a.filter(function(e){return c.isElementVisible(a[e])})),{$elements:a,length:_?1:a?a.length:0,$visibleElements:s,visibleLength:_?1:s?s.length:0,iframeContext:!1,error:E,selector:e,evalResults:o}},i.init=function(){N()};var M="parseSelectorRequest",D="parseSelectorResponse",P=null;_.on(_.SERVICE_MSG_RECEIVED,function(t){var n=t.message;switch(n.cmd){case M:var o=i.parseSelectorSync(n.selector,n.parseDomElementsOrJqueryObjectsOnly);o.length=o.$elements?o.$elements.length:0,o.iframeContext=!0,delete o.$elements,delete o.$visibleElements,delete o.evalResults;var r={cmd:D,parsedSelector:o,selector:n.selector};_.sendServiceMsg(r,e.top);break;case D:"function"==typeof P&&(P(n.parsedSelector),P=null)}})}),n.define("Base.Transport",function(n,o){function i(t){E&&(e.clearTimeout(u),u=e.setTimeout(E,t||c))}var r=t.get("Hammerhead"),a=r.Transport,s=n("Settings"),l=n("Shared.ServiceCommands"),c=11e4,E=null,u=null;o.syncServiceMsg=function(e,t){return i(),a.syncServiceMsg(e,t)},o.asyncServiceMsg=function(e,t){return i(),a.asyncServiceMsg(e,t)},o.waitForServiceMessagesCompleted=a.waitForServiceMessagesCompleted,o.batchUpdate=a.batchUpdate,o.queuedAsyncServiceMsg=a.queuedAsyncServiceMsg,o.switchToWorkerIdle=function(){e.location.href=s.WORKER_IDLE_URL},o.switchToStartRecordingUrl=function(t){var n=/#.*$/,o=e.location.href.replace(n,"").toLowerCase(),i=t.replace(n,"").toLowerCase();e.location.href=t,e.location.hash&&o===i&&n.test(t)&&e.location.reload(!0)},o.expectInactivity=function(e,t){var n=e+c,r={cmd:l.INACTIVITY_EXPECTED,duration:n};o.asyncServiceMsg(r,function(){i(n),t()})},o.fail=function(t){var n={cmd:l.TEST_FAIL,err:t};throw o.asyncServiceMsg(n,function(){o.switchToWorkerIdle()}),e.onerror=function(){},"STOP"},o.assertionFailed=function(e){var t={cmd:l.ASSERTION_FAILED,err:e};o.asyncServiceMsg(t)},o.startInactivityMonitor=function(e){E=e,i()},o.stopInactivityMonitor=function(){E&&(E=null,e.clearTimeout(u))}}),n.define("TestRunner.SourceIndexTracker",function(e,n){var o=t.get("Hammerhead"),i=o.Util,r=e("Settings"),a=/#(\d+)/;n.currentIndex=null,n.wrapTrackableMethods=function(e,t){i.arrForEach(t,function(t){var o=e[t];e[t]=function(){var e=Array.prototype.slice.call(arguments);if(r.ENABLE_SOURCE_INDEX){var t=e[e.length-1],i="string"==typeof t&&t.match(a);i&&(n.currentIndex=parseInt(i[1],10),e.pop())}return o.apply(this,e)}})}}),n.define("TestRunner.TestIterator",function(n){var i=t.get("Hammerhead"),r=i.$,a=i.async,s=i.Util,l=i.NativeMethods,c=i.JSON,E=n("ActionBarrier"),u=n("ActionBarrier.Xhr"),_=n("Settings"),f=n("Shared.Errors"),d=500,T=3e3,S=30,A=this.exports=function(e){this.state={step:0,stepNames:null,testSteps:null,pageUnloading:!1,stepDelayTimeout:null,inAsyncAction:!1,prolongStepDelay:!1,shortProlongStepDelay:!1,stepsSharedData:{},lastSyncedSharedDataJSON:null,stopped:!1,waitedIFrame:null,needScreeshot:!1},this.pingIFrame=e,this.globalWaitForEvent=null,this.globalWaitForTimeout=null,this.eventEmitter=new s.EventEmitter};A.TEST_COMPLETE_EVENT="testComplete",A.NEXT_STEP_STARTED_EVENT="nextStepStarted",A.ACTION_TARGET_WAITING_STARTED_EVENT="actionTargetWaitingStarted",A.ACTION_RUN_EVENT="actionRun",A.ERROR_EVENT="error",A.ASSERTION_FAILED_EVENT="assertionFailed",A.SET_STEPS_SHARED_DATA_EVENT="setStepsSharedData",A.GET_STEPS_SHARED_DATA_EVENT="getStepsSharedData",A.EXPECT_INACTIVITY_EVENT="expectInactivity",A.TAKE_SCREENSHOT_EVENT="takeScreenshot",A.BEFORE_UNLOAD_EVENT_RAISED="beforeUnload",A.UNLOAD_EVENT_RAISED="unload",A.prototype.on=function(){return this.eventEmitter.on.apply(this.eventEmitter,arguments)},A.prototype._checkSharedDataSerializable=function(){var e=null;return c.isSerializable(this.state.stepsSharedData)?!0:(e={code:f.STORE_DOM_NODE_OR_JQUERY_OBJECT,stepName:_.CURRENT_TEST_STEP_NAME,stepNum:this.state.step-1},this.eventEmitter.emit(A.ERROR_EVENT,e),!1)},A.prototype._runStep=function(){this.state.stopped=!1;var e=this;if(e.state.step>0&&!e.state.stepDoneCalled&&"function"==typeof e.state.stepDone&&(e.state.stepDone(),e.state.stepDoneCalled=!0),!this.state.stopped){if(e.state.step>=e.state.testSteps.length)return void this.eventEmitter.emit(A.TEST_COMPLETE_EVENT,{callback:function(){e.state.runningCopmlete=!0}});_.CURRENT_TEST_STEP_NAME=e.state.stepNames[e.state.step];var t=e.state.testSteps[e.state.step];e.state.step++,e.eventEmitter.emit(A.NEXT_STEP_STARTED_EVENT,{nextStep:e.state.step,callback:function(){e.__waitFor(function(){var n=null;"function"==typeof e.state.stepSetup&&e.state.stepSetup(),e.state.stepDoneCalled=!1,e.state.inAsyncAction=!1,e.state.prolongStepDelay=!1,e.state.shortProlongStepDelay=!1;try{e.callWithSharedDataContext(t)}catch(o){n={code:f.UNCAUGHT_JS_ERROR_IN_TEST_CODE_STEP,scriptErr:o&&o.message||o,stepName:_.CURRENT_TEST_STEP_NAME,stepNum:e.state.step-1},e.eventEmitter.emit(A.ERROR_EVENT,n)}if(!e.state.stopped){var i=function(){"function"!=typeof e.state.stepDone||e.state.stepDoneCalled||(e.state.stepDone(),e.state.stepDoneCalled=!0),e._runStep()};if(!e.state.inAsyncAction){if(!e._checkSharedDataSerializable())return;_.TAKE_SCREENSHOT_ON_FAILS&&e.state.needScreeshot?e.takeScreenshot(function(){e.state.needScreeshot=!1,i()},!0):i()}}})}})}},A.prototype._setupUnloadPrediction=function(){function t(){E(),e.setTimeout(function(){"loading"!==o.readyState||o.activeElement&&"a"===o.activeElement.tagName.toLowerCase()&&null!==o.activeElement.getAttribute("download")||u()},0)}var n=this,a=r("form"),c=function(){n.state.prolongStepDelay=!0},E=function(){n.state.shortProlongStepDelay=!0},u=function(){n.state.pageUnloading=!0,n.eventEmitter.emit(A.BEFORE_UNLOAD_EVENT_RAISED)},_=function(){n.state.pageUnloading=!0,n.eventEmitter.emit(A.UNLOAD_EVENT_RAISED)};r(o).on("submit","form",c),a.each(function(){var e=this.submit;this.submit=function(){c(),e.apply(this,arguments)}});var f=!1;l.addEventListener.call(o,"click",function(e){var t=e.srcElement||e.target;if(!e.defaultPrevented&&t.tagName&&"a"===t.tagName.toLowerCase()){var n=r(t).attr("href");t.hasAttribute("href")&&!/(^javascript:)|(^mailto:)|(^tel:)|(^#)/.test(n)?c():s.isIE&&(f=!0)}}),i.on(i.BEFORE_UNLOAD_EVENT,s.isIE?t:u),i.on(i.BEFORE_UNLOAD_EVENT,function(){f=!1}),l.windowAddEventListener.call(e,"unload",_)},A.prototype._syncSharedDataWithServer=function(e){var t=this,n="";t._checkSharedDataSerializable()&&(n=c.stringify(t.state.stepsSharedData),t.state.lastSyncedSharedDataJSON===n?"function"==typeof e&&e():t.eventEmitter.emit(A.SET_STEPS_SHARED_DATA_EVENT,{stepsSharedData:t.state.stepsSharedData,callback:function(){t.state.lastSyncedSharedDataJSON=n,"function"==typeof e&&e()}}))},A.prototype._completeAsyncAction=function(){var t=this;if("function"!=typeof t.state.stepDone||t.state.stepDoneCalled||(t.state.stepDone(),t.state.stepDoneCalled=!0),!t.state.stopped){var n=function(){t.state.pageUnloading||(t._runStep(),e.clearTimeout(t.state.stepDelayTimeout),t.state.stepDelayTimeout=null)};t.state.stepDelayTimeout=e.setTimeout(function(){t.state.prolongStepDelay||t.state.shortProlongStepDelay?t.state.stepDelayTimeout=e.setTimeout(function(){n()},t.state.prolongStepDelay?T:S):n()},d)}},A.prototype.callWithSharedDataContext=function(e){return e.apply(this.state.stepsSharedData)},A.prototype._checkIFrame=function(t,n){if(e.top!==e.self||!s.isElementInIframe(t))return void n(null);var o=s.getIFrameByElement(t);this.pingIFrame(o,function(){n(o)})},A.prototype.asyncAction=function(e){var t=this;this.state.inAsyncAction=!0;var n=function(){t._syncSharedDataWithServer(function(){E.waitActionSideEffectsCompletion(e,function(){t._completeAsyncAction.apply(t,arguments)})})};_.TAKE_SCREENSHOT_ON_FAILS&&this.state.needScreeshot?this.takeScreenshot(function(){t.state.needScreeshot=!1,n()},!0):n()},A.prototype.asyncActionSeries=function(e,t,n){var o=this,i=function(){var i=function(e,t){a.forEachSeries(e,function(e,t){o._checkIFrame(e,function(i){if(i){var r=i.contentWindow[u.GLOBAL_START_XHR_BARRIER],a=i.contentWindow[u.GLOBAL_WAIT_XHR_BARRIER];E.waitActionSideEffectsCompletion(function(t){function s(){l.windowRemoveEventListener.call(i.contentWindow,"beforeunload",s),c=!0}var c=!1;o.iFrameActionCallback=function(){o.iFrameActionCallback=null,o.waitedIFrame=null,t()},o.waitedIFrame=i,r(function(){c||o.iFrameActionCallback()}),l.windowAddEventListener.call(i.contentWindow,"beforeunload",s,!0),n(e,function(){a()},i)},t)}else E.waitActionSideEffectsCompletion(function(t){n(e,t)},t)})},function(){o.state.stopped||t()})};o._syncSharedDataWithServer(function(){t(e,i,function(){o._completeAsyncAction.apply(o,arguments)})})};o.state.inAsyncAction=!0,_.TAKE_SCREENSHOT_ON_FAILS&&this.state.needScreeshot?this.takeScreenshot(function(){o.state.needScreeshot=!1,i()},!0):i()},A.prototype._init=function(){this.initialized=!0,this._setupUnloadPrediction()},A.prototype.start=function(e,t,n,o,i){this._init(),this.runSteps(e,t,n,o,i)},A.prototype.stop=function(){this.state.stopped=!0},A.prototype.runSteps=function(e,t,n,o,i){this.initialized||this._init();var r=this;r.state.testSteps=t,r.state.stepNames=e,r.state.inAsyncAction=!1,r.state.step=i,r.state.stepSetup=n,r.state.stepDone=o,r.state.runningCopmlete=!1,r.eventEmitter.emit(A.GET_STEPS_SHARED_DATA_EVENT,{callback:function(e){r.state.stepsSharedData=e||{},r.state.lastSyncedSharedDataJSON=c.stringify(r.state.stepsSharedData),r._runStep()}})},A.prototype.getSharedData=function(){return this.state.stepsSharedData},A.prototype.setSharedData=function(e){this.state.stepsSharedData=e,this._syncSharedDataWithServer()},A.prototype.onError=function(e){this.state.stopped||this.eventEmitter.emit(A.ERROR_EVENT,r.extend({stepNum:this.state.step-1},e))},A.prototype.onAssertionFailed=function(e){this.state.stopped||this.eventEmitter.emit(A.ASSERTION_FAILED_EVENT,{err:e,stepNum:this.state.step-1,isAssertion:!0})},A.prototype.expectInactivity=function(e,t){this.eventEmitter.emit(A.EXPECT_INACTIVITY_EVENT,{duration:e,callback:t})},A.prototype.runNext=function(){this._runStep()},A.prototype.runLast=function(){this.state.step--,this.runNext()},A.prototype.getCurrentStep=function(){return this.state.stepNames?this.state.stepNames[this.state.step-1]:_.CURRENT_TEST_STEP_NAME},A.prototype.getCurrentStepNum=function(){return this.state.step-1},A.prototype.onActionTargetWaitingStarted=function(e){this.eventEmitter.emit(A.ACTION_TARGET_WAITING_STARTED_EVENT,e)},A.prototype.onActionRun=function(){this.eventEmitter.emit(A.ACTION_RUN_EVENT,{})},A.prototype.setGlobalWaitFor=function(e,t){this.globalWaitForEvent=e,this.globalWaitForTimeout=t},A.prototype.__waitFor=function(t){var n=this;if("function"!=typeof this.globalWaitForEvent)return void t();"number"!=typeof this.globalWaitForTimeout&&(this.globalWaitForTimeout=0);var o=e.setTimeout(function(){n.onError({code:f.API_WAIT_FOR_ACTION_TIMEOUT_EXCEEDED,stepName:_.CURRENT_TEST_STEP_NAME})},this.globalWaitForTimeout);this.expectInactivity(this.globalWaitForTimeout,function(){n.callWithSharedDataContext(function(){n.globalWaitForEvent.call(this,function(){e.clearTimeout(o),t()})})})},A.prototype.takeScreenshot=function(e,t){this.eventEmitter.emit(A.TAKE_SCREENSHOT_EVENT,{isFailedStep:t,callback:e})}}),n.define("TestRunner.TestRunner",function(n){var i=t.get("Hammerhead"),r=i.Util,a=n("Base.Transport"),s=n("Shared.ServiceCommands"),l=n("Shared.Errors"),c=n("Settings"),E=n("TestRunner.TestRunnerBase"),u=1e3,_=this.exports=function(e){var t=this;E.apply(this,[e]),a.startInactivityMonitor(function(){t._onError({code:l.TEST_INACTIVITY})})};r.inherit(_,E),_.prototype._onTestComplete=function(e){a.waitForServiceMessagesCompleted(function(){var t={cmd:s.TEST_COMPLETE};a.asyncServiceMsg(t,function(){e.callback(),a.switchToWorkerIdle()})},u)},_.prototype._onNextStepStarted=function(e){var t={cmd:s.SET_NEXT_STEP,nextStep:e.nextStep};a.asyncServiceMsg(t,e.callback)},_.prototype._onActionTargetWaitingStarted=function(e){E.prototype._onActionTargetWaitingStarted.apply(this,[e]);var t={cmd:s.SET_ACTION_TARGET_WAITING,value:!0};a.asyncServiceMsg(t)},_.prototype._onActionRun=function(){E.prototype._onActionRun.apply(this,[]);var e={cmd:s.SET_ACTION_TARGET_WAITING,value:!1};a.asyncServiceMsg(e)},_.prototype._onError=function(e){var t=this;if(!this.stopped){if(this.testIterator.stop(),E.prototype._onError.call(this,e),!c.TAKE_SCREENSHOT_ON_FAILS)return this.stopped=!0,void a.fail(e);var n={cmd:s.SET_TEST_ERROR,err:e};a.asyncServiceMsg(n),this._onTakeScreenshot({isFailedStep:!0,withoutStepName:!(l.hasErrorStepName(e)&&i.Errs.hasErrorStepName(e)),callback:function(){t.stopped=!0,a.fail(e)}})}},_.prototype._onAssertionFailed=function(e,t){this.testIterator.state.needScreeshot=!t,a.assertionFailed(e.err)},_.prototype._onSetStepsSharedData=function(e){var t={cmd:s.SET_STEPS_SHARED_DATA,stepsSharedData:e.stepsSharedData};a.asyncServiceMsg(t,function(){e.callback()})},_.prototype._onGetStepsSharedData=function(e){var t={cmd:s.GET_STEPS_SHARED_DATA};a.asyncServiceMsg(t,e.callback)},_.prototype._onExpectInactivity=function(e){a.expectInactivity(e.duration,e.callback)},_.prototype._onTakeScreenshot=function(t){var n=o.title,i="[tc-"+Date.now()+"]",l=null,c=t&&t.callback?t.callback:function(){},u=this;u.eventEmitter.emit(E.SCREENSHOT_CREATING_STARTED_EVENT,{}),r.isMSEdge?l="MSEDGE":r.isSafari?l="SAFARI":r.isOpera||r.isOperaWithWebKit?l="OPERA":r.isWebKit?l="CHROME":r.isMozilla?l="FIREFOX":r.isIE&&(l="IE");
var _={cmd:s.TAKE_SCREENSHOT,windowMark:i,browserName:l,isFailedStep:t.isFailedStep,withoutStepName:t.withoutStepName,url:e.location.toString()},f=n+i,d=e.setInterval(function(){o.title!==f&&(n=o.title,o.title=f)},50);o.title=f,e.setTimeout(function(){a.asyncServiceMsg(_,function(){e.clearInterval(d),d=null,o.title=n,u.eventEmitter.emit(E.SCREENSHOT_CREATING_FINISHED_EVENT,{}),e.setTimeout(function(){c()},100)})},500)},_.prototype._onDialogsInfoChanged=function(e){a.asyncServiceMsg({cmd:s.NATIVE_DIALOGS_INFO_SET,info:e,timeStamp:Date.now()})}}),n.define("TestRunner.TestRunnerBase",function(n){function i(t){var n=a.$,i=!1,r=function(){i||(i=!0,t())};n(e).load(r),n(o).ready(function(){l.isIFrameWindowInDOM(e)&&e.setTimeout(r,h)})}function r(e,t){c.pingIFrame(e,f.IFRAME_TEST_RUNNER_PING_DISPATCHER_CMD,t)}var a=t.get("Hammerhead"),s=a.$,l=a.Util,c=a.MessageSandbox,E=n("Base.jQueryExtensions.Selectors"),u=n("Settings"),_=n("Base.Transport"),f=n("Base.CrossDomainMessages"),d=n("Shared.Errors"),T=n("Shared.ServiceCommands"),S=n("TestRunner.TestIterator"),A=n("TestRunner.API.Actions"),p=n("TestRunner.API.Dialogs"),I=n("TestRunner.API.Assertions"),m=n("Automation"),R=n("ActionBarrier"),g=n("UI.ModalBackground"),N=n("UI.Cursor"),C=n("Automation.IFrameBehavior"),h=3e3,O=200,v=500,M=this.exports=function(){var e=this;this.eventEmitter=new l.EventEmitter,this.testIterator=new S(r),this.executingStepInIFrameWindow=null,this.stopped=!1,this.listenNativeDialogs=!1,this.isFileDownloadingIntervalID=null,this.assertionsAPI=new I(function(t){e.testIterator.onAssertionFailed(t)}),A.init(this.testIterator),this._initNativeDialogs(),m.init(),this._initBarrier(),this._initApi(),this._initIFrameBehavior(),a.on(a.UNCAUGHT_JS_ERROR,function(t){t.inIFrame&&!u.PLAYBACK?e.testIterator.stop():(u.FAIL_ON_JS_ERRORS||u.RECORDING)&&e._onError({code:d.UNCAUGHT_JS_ERROR,scriptErr:t.msg,pageError:!0,pageUrl:t.pageUrl})}),e.testIterator.on(S.ERROR_EVENT,function(t){e._onError(t)}),e.act._onJSError=function(t){e._onError({code:d.UNCAUGHT_JS_ERROR,scriptErr:t&&t.message||t})},e.act._start=function(t,n,o,i){e._prepareStepsExecuting(function(){delete e.act._onJSError,delete e.act._start,e.eventEmitter.emit(e.TEST_STARTED_EVENT,{nextStep:o}),g.hide(),e.testIterator.on(S.TEST_COMPLETE_EVENT,function(t){e._onTestComplete(t)}),e.testIterator.on(S.NEXT_STEP_STARTED_EVENT,function(t){e._onNextStepStarted(t),e._clearFileDownloadingInterval()}),e.testIterator.on(S.ACTION_TARGET_WAITING_STARTED_EVENT,function(t){e._onActionTargetWaitingStarted(t)}),e.testIterator.on(S.ACTION_RUN_EVENT,function(t){e._onActionRun(t)}),e.testIterator.on(S.ASSERTION_FAILED_EVENT,function(t){e._onAssertionFailed(t)}),e.testIterator.on(S.SET_STEPS_SHARED_DATA_EVENT,function(t){e._onSetStepsSharedData(t)}),e.testIterator.on(S.GET_STEPS_SHARED_DATA_EVENT,function(t){e._onGetStepsSharedData(t)}),e.testIterator.on(S.EXPECT_INACTIVITY_EVENT,function(t){e._onExpectInactivity(t)}),e.testIterator.on(S.TAKE_SCREENSHOT_EVENT,function(t){e._onTakeScreenshot(t)}),e.testIterator.on(S.BEFORE_UNLOAD_EVENT_RAISED,function(){e._onBeforeUnload()}),e.testIterator.on(S.UNLOAD_EVENT_RAISED,function(){e._clearFileDownloadingInterval()}),e.listenNativeDialogs=!0,e.testIterator.start(t,n,p.resetHandlers,p.checkExpectedDialogs,o)},i)}};M.prototype.run=function(e,t,n){this.testIterator.runSteps(e,t,p.resetHandlers,p.checkExpectedDialogs,n)},M.prototype._destroy=function(){p.destroy(),this._destroyIFrameBehavior(),_.stopInactivityMonitor()},M.prototype._initBarrier=function(){R.init()},M.prototype._initIFrameBehavior=function(){function e(e){var n=e.message,o=null;switch(n.cmd){case M.IFRAME_STEP_COMPLETED_CMD:t._onIFrameStepExecuted();break;case M.IFRAME_ERROR_CMD:-1===n.err.stepNum&&(n.err.stepNum=t.testIterator.getCurrentStepNum(),n.err.stepName=t.testIterator.getCurrentStep()),t._onError(n.err);break;case M.IFRAME_FAILED_ASSERTION_CMD:t.executingStepInIFrameWindow=null,t._onAssertionFailed(n.err,!0);break;case M.IFRAME_GET_SHARED_DATA_REQUEST_CMD:o={cmd:M.IFRAME_GET_SHARED_DATA_RESPONSE_CMD,sharedData:t.testIterator.getSharedData()},c.sendServiceMsg(o,e.source);break;case M.IFRAME_SET_SHARED_DATA_CMD:t.testIterator.setSharedData(n.sharedData);break;case M.IFRAME_EXPECT_INACTIVITY_CMD:t._onExpectInactivity({duration:n.duration,callback:function(){}});break;case M.IFRAME_NEXT_STEP_STARTED_CMD:t.executingStepInIFrameWindow=e.source,t._clearFileDownloadingInterval();break;case M.IFRAME_ACTION_TARGET_WAITING_STARTED_CMD:t.actionTargetWaitingStarted=!0;break;case M.IFRAME_ACTION_RUN_CMD:t.actionTargetWaitingStarted=!1;break;case f.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_REQUEST_CMD:(t.testIterator.waitedIFrame===l.getIFrameByWindow(e.source)||t.executingStepInIFrameWindow===e.source)&&(o={cmd:f.IFRAME_TEST_RUNNER_WAITING_STEP_COMPLETION_RESPONSE_CMD},c.sendServiceMsg(o,e.source));break;case f.IFRAME_TEST_RUNNER_STEP_COMPLETED_CMD:t.testIterator.waitedIFrame===l.getIFrameByWindow(e.source)?t.testIterator.iFrameActionCallback():t.executingStepInIFrameWindow===e.source&&t._onIFrameStepExecuted();break;case M.IFRAME_TAKE_SCREENSHOT_REQUEST_CMD:t._onTakeScreenshot({isFailedStep:n.isFailedStep,callback:function(){o={cmd:M.IFRAME_TAKE_SCREENSHOT_RESPONSE_CMD},c.sendServiceMsg(o,e.source)}});break;case M.IFRAME_NATIVE_DIALOGS_INFO_CHANGED_CMD:t._onDialogsInfoChanged(n.info);break;case M.IFRAME_BEFORE_UNLOAD_REQUEST_CMD:t._onBeforeUnload(!0,function(t){o={cmd:M.IFRAME_BEFORE_UNLOAD_RESPONSE_CMD,res:t},c.sendServiceMsg(o,e.source)})}}var t=this;C.init(),c.on(c.SERVICE_MSG_RECEIVED,e),t._destroyIFrameBehavior=function(){C.destroy(),c.off(c.SERVICE_MSG_RECEIVED,e)}},M.prototype._prepareStepsExecuting=function(t,n){function o(){N.init(),t()}n?o():i(function(){e.setTimeout(function(){_.batchUpdate(function(){E.init(),R.waitPageInitialization(function(){N.init(),t()})})},O)})},M.WAITING_FOR_ACTION_TARGET_MESSAGE="Waiting for the target element of the next action to appear",M.prototype.TEST_STARTED_EVENT="testStarted",M.prototype.TEST_COMPLETED_EVENT="testCompleted",M.prototype.NEXT_STEP_STARTED_EVENT="nextStepStarted",M.prototype.ACTION_TARGET_WAITING_STARTED_EVENT="actionTargetWaitingStarted",M.prototype.ACTION_RUN_EVENT="actionRun",M.prototype.TEST_FAILED_EVENT="testFailed",M.SCREENSHOT_CREATING_STARTED_EVENT="screenshotCreatingStarted",M.SCREENSHOT_CREATING_FINISHED_EVENT="screenshotCreatingFinished",M.IFRAME_STEP_COMPLETED_CMD="iframeStepCompleted",M.IFRAME_ERROR_CMD="iframeError",M.IFRAME_FAILED_ASSERTION_CMD="iframeFailedAssertion",M.IFRAME_GET_SHARED_DATA_REQUEST_CMD="getSharedDataRequest",M.IFRAME_GET_SHARED_DATA_RESPONSE_CMD="getSharedDataResponse",M.IFRAME_SET_SHARED_DATA_CMD="setSharedData",M.IFRAME_EXPECT_INACTIVITY_CMD="expectInactivity",M.IFRAME_NEXT_STEP_STARTED_CMD="nextStepStarted",M.IFRAME_ACTION_TARGET_WAITING_STARTED_CMD="actionTargetWaitingStarted",M.IFRAME_ACTION_RUN_CMD="actionRun",M.IFRAME_TAKE_SCREENSHOT_REQUEST_CMD="takeScreenshotRequest",M.IFRAME_TAKE_SCREENSHOT_RESPONSE_CMD="takeScreenshotResponse",M.IFRAME_NATIVE_DIALOGS_INFO_CHANGED_CMD="nativeDialogsInfoChanged",M.IFRAME_BEFORE_UNLOAD_REQUEST_CMD="iframeBeforeUnloadRequest",M.IFRAME_BEFORE_UNLOAD_RESPONSE_CMD="iframeBeforeUnloadResponse",M.prototype.on=function(e,t){this.eventEmitter.on(e,t)},M.prototype._runInIFrame=function(e,t,n,o){var i=this;this.testIterator.state.inAsyncAction=!0;var a={cmd:f.IFRAME_TEST_RUNNER_RUN_CMD,stepName:t,step:n.toString(),stepNum:o};r(e,function(t){t?i._onError({code:d.IN_IFRAME_TARGET_LOADING_TIMEOUT,stepName:u.CURRENT_TEST_STEP_NAME}):c.sendServiceMsg(a,e.contentWindow)})},M.prototype._ensureIFrame=function(e){return e?l.isDomElement(e)?e.tagName&&"iframe"===e.tagName.toLowerCase()?e:(this._onError({code:d.API_IFRAME_ARGUMENT_IS_NOT_IFRAME,stepName:u.CURRENT_TEST_STEP_NAME}),null):("string"==typeof e&&(e=s(e)),l.isJQueryObj(e)?0===e.length?(this._onError({code:d.API_EMPTY_IFRAME_ARGUMENT,stepName:u.CURRENT_TEST_STEP_NAME}),null):e.length>1?(this._onError({code:d.API_MULTIPLE_IFRAME_ARGUMENT,stepName:u.CURRENT_TEST_STEP_NAME}),null):this._ensureIFrame(e[0]):"function"==typeof e?this._ensureIFrame(e()):(this._onError({code:d.API_INCORRECT_IFRAME_ARGUMENT,stepName:u.CURRENT_TEST_STEP_NAME}),null)):(this._onError({code:d.API_EMPTY_IFRAME_ARGUMENT,stepName:u.CURRENT_TEST_STEP_NAME}),null)},M.prototype._initApi=function(){var e=this;this.act=A,this.ok=function(){e.assertionsAPI.ok.apply(e.assertionsAPI,arguments)},this.notOk=function(){e.assertionsAPI.notOk.apply(e.assertionsAPI,arguments)},this.eq=function(){e.assertionsAPI.eq.apply(e.assertionsAPI,arguments)},this.notEq=function(){e.assertionsAPI.notEq.apply(e.assertionsAPI,arguments)},this.handleAlert=p.handleAlert,this.handleConfirm=p.handleConfirm,this.handlePrompt=p.handlePrompt,this.handleBeforeUnload=p.handleBeforeUnload,this.inIFrame=function(t,n){return function(){var o=e.testIterator.state.step,i=e._ensureIFrame(t());i&&e._runInIFrame(i,u.CURRENT_TEST_STEP_NAME,n,o)}}},M.prototype._initNativeDialogs=function(){var e=this;u.NATIVE_DIALOGS_INFO&&(e.listenNativeDialogs=!0),p.init(u.NATIVE_DIALOGS_INFO),p.on(p.UNEXPECTED_DIALOG_ERROR_EVENT,function(t){e.listenNativeDialogs&&e.testIterator.onError({code:d.API_UNEXPECTED_DIALOG,stepName:e.testIterator.getCurrentStep(),dialog:t.dialog,message:t.message})}),p.on(p.WAS_NOT_EXPECTED_DIALOG_ERROR_EVENT,function(t){e.listenNativeDialogs&&e.testIterator.onError({code:d.API_EXPECTED_DIALOG_DOESNT_APPEAR,stepName:e.testIterator.getCurrentStep(),dialog:t.dialog})}),p.on(p.DIALOGS_INFO_CHANGED_EVENT,function(t){e._onDialogsInfoChanged(t.info)})},M.prototype._onTestComplete=function(e){this.eventEmitter.emit(this.TEST_COMPLETED_EVENT,{}),e.callback()},M.prototype._onNextStepStarted=function(e){e.callback()},M.prototype._onActionTargetWaitingStarted=function(e){this.eventEmitter.emit(this.ACTION_TARGET_WAITING_STARTED_EVENT,e)},M.prototype._onActionRun=function(){this.eventEmitter.emit(this.ACTION_RUN_EVENT,{})},M.prototype._onError=function(e){this.eventEmitter.emit(this.TEST_FAILED_EVENT,{stepNum:this.testIterator.state.step-1,err:e})},M.prototype._onAssertionFailed=function(){},M.prototype._onSetStepsSharedData=function(e){e.callback()},M.prototype._onGetStepsSharedData=function(e){e.callback()},M.prototype._onExpectInactivity=function(e){e.callback()},M.prototype._onTakeScreenshot=function(e){e&&e.callback&&e.callback()},M.prototype._onIFrameStepExecuted=function(){this.executingStepInIFrameWindow=null,this.actionTargetWaitingStarted?(this.actionTargetWaitingStarted=!1,this.testIterator.runLast()):this.testIterator.runNext()},M.prototype._onDialogsInfoChanged=function(){},M.prototype.setGlobalWaitFor=function(e,t){this.testIterator.setGlobalWaitFor(e,t)},M.prototype._onBeforeUnload=function(t,n){var o=this;_.asyncServiceMsg({cmd:T.UNCHECK_FILE_DOWNLOADING_FLAG},function(){o.isFileDownloadingIntervalID=e.setInterval(function(){_.asyncServiceMsg({cmd:T.GET_AND_UNCHECK_FILE_DOWNLOADING_FLAG},function(i){if(i){if(e.clearInterval(o.isFileDownloadingIntervalID),o.isFileDownloadingIntervalID=null,t)return void n(i);o.testIterator.state.stepDelayTimeout&&(e.clearTimeout(o.testIterator.state.stepDelayTimeout),o.testIterator.state.stepDelayTimeout=null),o.testIterator.state.pageUnloading=!1,o.testIterator._runStep()}})},v)})},M.prototype._clearFileDownloadingInterval=function(){this.isFileDownloadingIntervalID&&(e.clearInterval(this.isFileDownloadingIntervalID),this.isFileDownloadingIntervalID=null)}}),n.define("Automation.Click.Playback",function(n,o){function i(t,n,o,i){var r="option"===t.tagName.toLowerCase(),E=c.getSelectParent(a(t));if(!E)return _.click(t,n),void o();var d=a(E),S=d[0].selectedIndex,I=A.isOptionListExpanded(d),m=c.getChildIndex(d,t),R=null;if(I)R=A.getEmulatedChildElement(m,!r);else{var g=c.getSelectSizeValue(d);if((!l.RECORDING||l.PLAYBACK)&&1>=g)return void i({code:f.API_INVISIBLE_ACTION_ELEMENT,element:c.getElementDescription(t)});R=t}s.series({moveCursorToElement:function(n){var o=null;I?o=R:(A.scrollOptionListByChild(t),o=A.getSelectChildCenter(t)),p.run(o,!1,{},function(){e.setTimeout(n,T.ACTION_STEP_DELAY)})},click:function(){!I&&(c.isWebKit&&1===c.getSelectSizeValue(d)||c.isIE&&c.getSelectSizeValue(d)>1)?_.click(d[0],n):_.click(R,n),I?o():(r&&!R.disabled&&(d[0].selectedIndex=m),u.focus(d[0],function(){e.setTimeout(function(){r&&a(t).index()!==S&&_.change(d[0]),o()},c.hasTouchEvents?0:T.CLICK_STEP_DELAY)},!1,!0))}})}var r=t.get("Hammerhead"),a=r.$,s=r.async,l=n("Settings"),c=r.Util,E=r.NativeMethods,u=r.EventSandbox,_=r.EventSimulator,f=n("Shared.Errors"),d=n("Automation.Util"),T=n("Automation.Settings"),S=n("UI.Cursor"),A=n("UI.SelectElement"),p=n("Automation.Move.Playback");o.run=function(t,n,o,r){if(n={ctrl:n.ctrl,alt:n.alt,shift:n.shift,meta:n.meta,offsetX:n.offsetX,offsetY:n.offsetY,caretPos:n.caretPos},"option"===t.tagName.toLowerCase()||"optgroup"===t.tagName.toLowerCase())return void i(t,n,o,r);var u=c.isSvgElement(t),f=null,I=null,m=null,R=c.isContainOffset(t,n.offsetX,n.offsetY)?t:d.getMouseActionPoint(t,n,!1),g=!0,N=null,C=!1,h=null,O=!1;n.offsetX&&(n.offsetX=Math.round(n.offsetX)),n.offsetY&&(n.offsetY=Math.round(n.offsetY)),s.series({moveCursorToElement:function(o){return!l.RECORDING||l.PLAYBACK||c.isElementVisible(t)?void p.run(R,!1,n,function(){u&&c.isOpera||a(t).is("tref")?N=t:(f=d.getMouseActionPoint(t,n,!0),I=d.getEventOptionCoordinates(t,f),m=a.extend({clientX:I.x,clientY:I.y},n),N=d.getElementUnderCursor(f.x,f.y,null,R),N||(C=!0,N=t)),e.setTimeout(o,T.ACTION_STEP_DELAY)}):(N=t,void e.setTimeout(o,T.ACTION_STEP_DELAY))},touchstart:function(e){c.hasTouchEvents&&_.touchstart(N,m),e()},cursorTouchMouseDown:function(e){c.hasTouchEvents?S.lMouseDown(e):e()},touchend:function(t){c.hasTouchEvents?(_.touchend(N,m),e.setTimeout(t,T.ACTION_STEP_DELAY)):t()},cursorMouseDown:function(e){c.hasTouchEvents?e():S.lMouseDown(e)},mousedown:function(o){var i=(c.isWebKit||c.isIE)&&c.isSelectElement(t),r=null,a=!1,s=c.getActiveElement(),l=!(c.isIE&&s===N)||"body"===N.tagName.toLowerCase()&&c.isContentEditableElement(N),u=function(){e.setTimeout(o,T.ACTION_STEP_DELAY)};if(i){var S=function(e){r=e.defaultPrevented,c.preventDefault(e),E.removeEventListener.call(t,"mousedown",S,!1)};E.addEventListener.call(t,"mousedown",S,!1)}var A=function(){a=!0,E.removeEventListener.call(s,"blur",A,!0)};if(E.addEventListener.call(s,"blur",A,!0),g=_.mousedown(N,m),!C&&f&&(h=d.getElementUnderCursor(f.x,f.y,null,R),h&&h!==N&&(O=!0,N=h)),c.getActiveElement()===s||a||(c.isIE&&c.browserVersion<12?e.setTimeout(function(){a||_.blur(s)},0):_.blur(s)),g===!1){if(!i||r)return void u();g=!0}d.focusAndSetSelection(c.isContentEditableElement(t)?t:N,n,l,u)},cursorMouseUp:function(e){S.mouseUp(e)},mouseup:function(t){_.mouseup(N,m),!C&&f&&(h=d.getElementUnderCursor(f.x,f.y,null,R)),e.setTimeout(t,T.ACTION_STEP_DELAY)},click:function(){var e=a(N);if((!l.RECORDING||l.PLAYBACK)&&"option"===N.tagName.toLowerCase())return void o();if("option"===N.tagName.toLowerCase()){var t=c.getSelectParent(e),n=a(t);return t&&(c.isWebKit&&c.getSelectSizeValue(n)<=1||c.isIE&&c.getSelectSizeValue(n)>1)?_.click(n[0],m):_.click(e[0],m),t&&_.change(n[0]),void o()}O||_.click(N,m),d.focusLabelChildElement(N),l.RECORDING&&!l.PLAYBACK||!c.isSelectElement(N)||g===!1||(A.isOptionListExpanded(e)?A.collapseOptionList():A.expandOptionList(N)),o()}})}}),n.define("Automation.DblClick.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.$,a=i.Util,s=n("UI.SelectElement"),l=i.async,c=i.EventSimulator,E=i.NativeMethods,u=n("Settings"),_=n("UI.Cursor"),f=n("Automation.Util"),d=n("Automation.Settings"),T=n("Automation.Click.Playback");o.run=function(t,n,o){n={ctrl:n.ctrl,alt:n.alt,shift:n.shift,meta:n.meta,offsetX:n.offsetX,offsetY:n.offsetY,caretPos:n.caretPos};var i=null,S=null,A=null,p=!1;a.isContainOffset(t,n.offsetX,n.offsetY)||(S=f.getMouseActionPoint(t,n,!0),i=_.getElementUnderCursor(S.x,S.y)),i||(i=t);var I=u.RECORDING&&!u.PLAYBACK&&!a.isElementVisible(t),m=f.getMouseActionPoint(t,n,!0),R=f.getEventOptionCoordinates(t,m),g=r.extend({clientX:R.x,clientY:R.y},n);l.series({firstClick:function(o){T.run(t,n,function(){I||(A=f.getElementUnderCursor(m.x,m.y,null,t),A&&A!==i&&(i=A)),e.setTimeout(o,d.CLICK_STEP_DELAY)})},secondClick:function(o){var T=!0;l.series({touchstart:function(e){a.hasTouchEvents&&c.touchstart(i,g),e()},cursorTouchMouseDown:function(e){a.hasTouchEvents?_.lMouseDown(e):e()},touchend:function(t){a.hasTouchEvents?(c.touchend(i,g),e.setTimeout(t,d.ACTION_STEP_DELAY)):t()},cursorMouseDown:function(e){a.hasTouchEvents?e():_.lMouseDown(e)},mousedown:function(e){var o=(a.isWebKit||a.isIE)&&a.isSelectElement(i),r=null,s=a.getActiveElement(),l=!(a.isIE&&s===i);if(o){var u=function(e){r=e.defaultPrevented,a.preventDefault(e),E.removeEventListener.call(i,"mousedown",u,!1)};E.addEventListener.call(i,"mousedown",u,!1)}if(T=c.mousedown(i,g),I||(A=f.getElementUnderCursor(m.x,m.y,null,t),A&&A!==i&&(p=!0,i=A)),T===!1){if(!o||r)return void e();T=!0}a.isIE?e():f.focusAndSetSelection(a.isContentEditableElement(t)?t:i,n,l,e)},cursorMouseUp:function(e){_.mouseUp(e)},mouseup:function(e){c.mouseup(i,g),e()},click:function(){"option"===i.tagName.toLowerCase()?o():(p||c.click(i,g),u.RECORDING&&!u.PLAYBACK||!a.isSelectElement(i)||T===!1||(s.isOptionListExpanded(r(i))?s.collapseOptionList():s.expandOptionList(i)),o())}})},dblclick:function(){p||c.dblclick(i,g),o()}})}}),n.define("Automation.Drag.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.$,a=i.async,s=i.Util,l=i.EventSandbox,c=i.EventSimulator,E=n("Settings"),u=n("Automation.Util"),_=n("Automation.Settings"),f=n("UI.Cursor"),d=i.ContentEditableHelper,T=n("Automation.Move.Playback");o.run=function(t,n,o,i){var S=s.isContainOffset(t,o.offsetX,o.offsetY)?t:u.getMouseActionPoint(t,o,!1),A=null,p=null,I=null,m=null,R=E.RECORDING&&!E.PLAYBACK&&!s.isElementVisible(t),g=null,N=s.findDocument(t),C=null,h=null,O=null,v=null,M=null;return o.offsetX&&(o.offsetX=Math.round(o.offsetX)),o.offsetY&&(o.offsetY=Math.round(o.offsetY)),R?void i(t):void a.series({moveCursorToElement:function(a){T.run(S,!1,o,function(){return h=u.getMouseActionPoint(t,o,!1),A=s.offsetToClientCoords(h),p=u.getEventOptionCoordinates(t,A),I=r.extend({clientX:p.x,clientY:p.y},o),C=s.isDomElement(n)?s.findCenter(n):u.getDragEndPoint(h,n,N),(m=f.getElementUnderCursor(A.x,A.y))?void e.setTimeout(a,_.DRAG_ACTION_STEP_DELAY):void i(t)})},cursorMouseDown:function(e){f.lMouseDown(e)},take:function(n){s.hasTouchEvents?c.touchstart(m,I):c.mousedown(m,I),l.focus(s.isContentEditableElement(t)?d.findContentEditableParent(t):m,function(){e.setTimeout(n,_.DRAG_ACTION_STEP_DELAY)},!1,!0)},drag:function(t){g={x:o.offsetX,y:o.offsetY},delete o.offsetX,delete o.offsetY,T.run(s.isDomElement(n)?n:C,!0,o,function(){o.offsetX=g.x,o.offsetY=g.y,e.setTimeout(t,_.DRAG_ACTION_STEP_DELAY)},N)},cursorMouseUp:function(e){if(C)O=s.offsetToClientCoords(C);else{var n=s.getOffsetPosition(t);O=s.offsetToClientCoords({x:n.left,y:n.top})}if(v=u.getEventOptionCoordinates(t,O),s.isElementInIframe(t)){var a=s.getIFrameByElement(t);if(a){var l={x:O.x-r(a.contentWindow).scrollLeft(),y:O.y-r(a.contentWindow).scrollTop()};m=f.getElementUnderCursor(l.x,l.y)}}else m=f.getElementUnderCursor(O.x,O.y);return m?(M=r.extend({clientX:v.x,clientY:v.y},o),void f.mouseUp(e)):void i()},mouseUp:function(e){s.hasTouchEvents?c.touchend(m,M):c.mouseup(m,M),e()},click:function(){f.getElementUnderCursor(O.x,O.y)===m&&c.click(m,M),i()}})}}),n.define("Automation.Hover.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.Util,a=n("Settings"),s=n("Automation.Settings"),l=n("Automation.Move.Playback");o.run=function(t,n,o){return!a.RECORDING||a.PLAYBACK||r.isElementVisible(t)?(n.offsetX&&(n.offsetX=Math.round(n.offsetX)),n.offsetY&&(n.offsetY=Math.round(n.offsetY)),void l.run(t,!1,n,o)):void e.setTimeout(o,s.ACTION_STEP_DELAY)}}),n.define("Automation.Press.KeyPressSimulator",function(n,o){function i(e){var t=e.value,n=_.hasInverseSelection(e),o=n?_.getSelectionStart(e):_.getSelectionEnd(e);return t&&o?l.getTextareaIndentInLine(e,o):0}var r=t.get("Hammerhead"),a=r.$,s=r.async,l=r.Util,c=r.NativeMethods,E=r.EventSandbox,u=r.EventSimulator,_=r.TextSelection,f=n("Automation.TypeChar.Playback"),d=80,T=function(e){var t=1===e.length||"space"===e,n=t?e:e.toLowerCase(),o=null,i=null;l.KEYS_MAPS.MODIFIERS_MAP[n]&&(n=l.KEYS_MAPS.MODIFIERS_MAP[n]);var r=null,s=l.KEYS_MAPS.MODIFIERS[n],c=l.KEYS_MAPS.SPECIAL_KEYS[n];return t&&"space"!==e?r=l.getKeyCodeByChar(n):s?r=s:c&&(r=c),{down:function(e){var t=l.getActiveElement();return o=t,s&&(e[n]=!0),u.keydown(t,a.extend({keyCode:r},e))},press:function(e){function r(t){if("space"===t)return" ";if(e.shift){if(l.isLetter(t))return l.changeLetterCase(t);if(l.KEYS_MAPS.REVERSED_SHIFT_MAP[t])return l.KEYS_MAPS.REVERSED_SHIFT_MAP[t]}return t}var s=l.getActiveElement();if(!t&&!c)return!0;var E=t?r(n):null,_=c||E.charCodeAt(0);if(l.isWebKit&&s!==o&&l.isElementInIframe(s)!==l.isElementInIframe(o))return!0;i=s;var d=u.keypress(s,a.extend({keyCode:_,charCode:_},e));s=l.getActiveElement();var T=l.isInputWithoutSelectionPropertiesInMozilla(s)?s.value.length:null;if(d){if(E&&!e.ctrl&&!e.alt)try{if(i===s||(!l.isMozilla||l.isEditableElement(i))&&(!l.isWebKit||l.isElementInIframe(s)===l.isElementInIframe(i)||l.isEditableElement(i))){var S=s;!l.isIE&&s!==i&&l.isEditableElement(i)&&l.isEditableElement(s)&&(S=i),f.run(S,E,T)}}catch(A){}"enter"===n&&s.tagName&&"input"===s.tagName.toLowerCase()&&/button|submit|reset/.test(s.type)&&s.click()}return d},up:function(e){s&&(e[n]=!1);var t=u.keyup(l.getActiveElement(),a.extend({keyCode:r},e)),o=l.getActiveElement();return t&&"space"===n&&o.tagName&&"input"===o.tagName.toLowerCase()&&/button|submit|reset|radio|checkbox/.test(o.type)&&o.click(),t},getKey:function(){return n}}},S=function(){function e(){y=null,b=null,c.removeEventListener.call(this,"blur",e,!0)}function t(t){"textarea"===t.tagName.toLowerCase()&&(y!==t&&(c.addEventListener.call(t,"blur",e,!0),y=t),b=i(t))}function n(e,n){var o=e.value;if(o){var i=_.hasInverseSelection(e),a=_.getSelectionStart(e),s=_.getSelectionEnd(e),l=o.substring(0,i?a:s),c=l.lastIndexOf("\n"),E=l.substring(0,c);(null===b||y!==e)&&t(e);var u=Math.min(E.lastIndexOf("\n")+1+b,E.length);r(e,a,s,i,u,n)}}function o(e,n){var o=e.value;if(o){var i=_.hasInverseSelection(e),a=_.getSelectionStart(e),s=_.getSelectionEnd(e),l=o.substring(i?a:s),c=-1===l.indexOf("\n")?l.length:l.indexOf("\n")+1,E=l.substring(c),u=(i?a:s)+c,f=-1===E.indexOf("\n")?E.length:E.indexOf("\n");(null===b||y!==e)&&t(e),u+=b>=f?f:b,r(e,a,s,i,u,n)}}function r(e,t,n,o,i,r){var a=null,s=null,l=null;r?t===n?t>i?(a=i,s=t,l=!0):(a=t,s=i):o?i>n?(a=n,s=i):(a=i,s=n,l=!0):t>i?(a=i,s=t,l=!0):(a=t,s=i):s=a=i,_.select(e,a,s,l)}function s(e,t){e.value=t,u.input(e)}function f(e,t){l.isEditableElement(e)&&_.select(e),t()}function d(e,t){if(l.isTextEditableElementAndEditingAllowed(e)){var n=_.getSelectionStart(e),o=_.getSelectionEnd(e),i=e.value.replace(/\r\n/g,"\n");o===n?n>0&&(s(e,i.substring(0,n-1)+i.substring(o,i.length)),_.select(e,n-1,n-1)):(s(e,i.substring(0,n)+i.substring(o,i.length)),_.select(e,n,n))}else l.isContentEditableElement(e)&&_.deleteSelectionContents(e);t()}function T(e,t){if(l.isTextEditableElementAndEditingAllowed(e)){var n=_.getSelectionStart(e),o=_.getSelectionEnd(e),i=e.value.replace(/\r\n/g,"\n");o===n?n<i.length&&(s(e,i.substring(0,n)+i.substring(o+1,i.length)),_.select(e,n,n)):(s(e,i.substring(0,n)+i.substring(o,i.length)),_.select(e,n,n))}else l.isContentEditableElement(e)&&_.deleteSelectionContents(e);t()}function S(e,n){var o=null,i=null;if(l.isTextEditableElement(e)){o=_.getSelectionStart(e),i=_.getSelectionEnd(e);var r=o?o===i?o-1:o:0;_.select(e,r,r),t(e)}else if(l.isContentEditableElement(e)&&(o=_.getSelectionStart(e),i=_.getSelectionEnd(e),o!==i)){var a=_.getSelectionByElement(e),s=_.hasInverseSelectionContentEditable(e),c=s?a.focusNode:a.anchorNode,E=s?a.focusOffset:a.anchorOffset;_.selectByNodesAndOffsets(c,E,c,E,!0,!1)}n()}function A(e,n){var o=null,i=null;if(l.isTextEditableElement(e)){o=_.getSelectionStart(e),i=_.getSelectionEnd(e);var r=o===e.value.length?o:o===i?o+1:i;_.select(e,r,r),t(e)}else if(l.isContentEditableElement(e)&&(o=_.getSelectionStart(e),i=_.getSelectionEnd(e),o!==i)){var a=_.getSelectionByElement(e),s=_.hasInverseSelectionContentEditable(e),c=s?a.anchorNode:a.focusNode,E=s?a.anchorOffset:a.focusOffset;_.selectByNodesAndOffsets(c,E,c,E,!0,!1)}n()}function p(e,t){return l.isWebKit&&e.tagName&&"input"===e.tagName.toLowerCase()?void m(e,t):(e.tagName&&"textarea"===e.tagName.toLowerCase()&&n(e,!1),void t())}function I(e,t){return l.isWebKit&&e.tagName&&"input"===e.tagName.toLowerCase()?void R(e,t):(e.tagName&&"textarea"===e.tagName.toLowerCase()&&o(e,!1),void t())}function m(e,t,n){if(l.isTextEditableElement(e)){var o=e.value,i=_.getSelectionStart(e),r=_.getSelectionEnd(e),a=_.hasInverseSelection(e),s="textarea"!==e.tagName.toLocaleLowerCase()?!0:l.getTextareaLineNumberByPosition(e,i)===l.getTextareaLineNumberByPosition(e,r),c=null;c=s?a?r:i:a?i:r;var E=o.substring(0,c),u=-1===E.lastIndexOf("\n")?0:E.lastIndexOf("\n")+1;s?_.select(e,u,n?c:u,n):_.select(e,a?u:i,a?r:u,a)}t()}function R(e,t,n){if(l.isTextEditableElement(e)){var o=e.value,i=_.getSelectionStart(e),r=_.getSelectionEnd(e),a=_.hasInverseSelection(e),s="textarea"!==e.tagName.toLocaleLowerCase()?!0:l.getTextareaLineNumberByPosition(e,i)===l.getTextareaLineNumberByPosition(e,r),c=null;c=s?a?r:i:a?i:r;var E=o.substring(c),u=c;u+=-1===E.indexOf("\n")?E.length:E.indexOf("\n"),s?_.select(e,n?c:u,u):_.select(e,a?u:i,a?r:u,a)}t()}function g(e,t){return l.isWebKit&&e.tagName&&"input"===e.tagName.toLowerCase()?void O(e,t):(e.tagName&&"textarea"===e.tagName.toLowerCase()&&n(e,!0),void t())}function N(e,t){return l.isWebKit&&e.tagName&&"input"===e.tagName.toLowerCase()?void v(e,t):(e.tagName&&"textarea"===e.tagName.toLowerCase()&&o(e,!0),void t())}function C(e,n){if(l.isTextEditableElement(e)){var o=_.getSelectionStart(e),i=_.getSelectionEnd(e);o===i||_.hasInverseSelection(e)?_.select(e,Math.max(o-1,0),i,!0):_.select(e,o,Math.max(i-1,0),o>i-1),t(e)}n()}function h(e,n){if(l.isTextEditableElement(e)){var o=_.getSelectionStart(e),i=_.getSelectionEnd(e);o!==i&&_.hasInverseSelection(e)?_.select(e,Math.min(o+1,e.value.length),i,i>o+1):_.select(e,o,Math.min(i+1,e.value.length)),t(e)}n()}function O(e,t){m(e,t,!0)}function v(e,t){R(e,t,!0)}function M(e,t){if(/input/i.test(e.tagName)){l.isIE||E.processElementChanging(e);var n=a(e).parents("form:first");if(n.length){var o=n.find("input[type=submit]:enabled,button[type=submit]:enabled");if(o.length||(o=n.find("button:enabled").filter(function(){return"submit"===this.type})),o.length)u.click(o[0]);else{var i=l.isWebKit?/^(text|search|url|number|tel|password|number|email)$/i:/^(text|search|url|number|tel|password|number|email|date|time)$/i;if(i.test(e.type)){var r=n.find("input").filter(function(){return i.test(this.type)});1!==r.length||r[0]!==e||e.validity&&!e.validity.valid||u.submit(n[0])&&n[0].submit()}}}}else if(e.tagName&&"textarea"===e.tagName.toLowerCase()){var c=_.getSelectionStart(e),f=e.value,d=_.getSelectionStart(e)+1;s(e,f.substring(0,c)+String.fromCharCode(10)+f.substring(c)),_.select(e,d,d)}else e.tagName&&"a"===e.tagName.toLowerCase()&&u.click(e);t()}function D(e,t){var n=l.getNextFocusableElement(e);E.focus(n,function(){l.isTextEditableInput(n)&&_.select(n),t()})}function P(e,t){var n=l.getNextFocusableElement(e,!0);E.focus(n,function(){l.isTextEditableInput(n)&&_.select(n),t()})}var y=null,b=null;return{"ctrl+a":f,backspace:d,"delete":T,left:S,right:A,up:p,down:I,"shift+left":C,"shift+right":h,"shift+up":g,"shift+down":N,"shift+home":O,"shift+end":v,home:m,end:R,enter:M,tab:D,"shift+tab":P}}();o.press=function(t,n){var o=l.getShortcutsByKeyCombination(S,t.toLowerCase()),i={},r="",c=t,E=0;for(E=0;E<o.length;E++){var u=o[E].toLowerCase(),_=c.indexOf(u),f=u.length;r+=c.substring(0,_+f),i[r]=l.getShortcutHandlerByKeyCombination(S,u),c=c.substring(_+f)}var A={ctrl:!1,alt:!1,shift:!1,meta:!1},p=l.getArrayByKeyCombination(t);for(E=0;E<p.length;E++){var I=p[E];if("shift"===I.toLowerCase()){var m=p[E+1];if(!m)continue;l.KEYS_MAPS.SHIFT_MAP[m]&&(p[E+1]=l.KEYS_MAPS.SHIFT_MAP[m])}!l.KEYS_MAPS.SHIFT_MAP[I]||p[E-1]&&"shift"===p[E-1].toLowerCase()||(p[E]=l.KEYS_MAPS.SHIFT_MAP[I],p.splice(E,0,"shift"),E++)}var R=a.map(p,function(e){return T(e)}),g=[],N="";s.series({keydown:function(t){s.forEachSeries(R,function(t,n){var o=!t.down(A),r=t.getKey();g.push(t),N+=(N?"+":"")+r;var a=function(){e.setTimeout(n,d)};if(o)a();else{var s=i[N];(!s||l.isMozilla||"enter"===r)&&(o=!t.press(A)),!o&&s?s(l.getActiveElement(),a):a()}},function(){t()})},keyup:function(){s.whilst(function(){return g.length},function(e){g.pop().up(A),setTimeout(e,d)},function(){n()})}})}}),n.define("Automation.Move.Playback",function(n,i){var r=t.get("Hammerhead"),a=r.$,s=r.async,l=r.Util,c=r.EventSimulator,E=r.MessageSandbox,u=n("Base.CrossDomainMessages"),_=n("Automation.Util"),f=n("Automation.Settings"),d=n("Automation.Scroll.Playback"),T=n("UI.Cursor");i.run=function(t,n,i,r,S,A,p){function I(e){s.series({setPosition:function(t){if(l.hasTouchEvents&&!n)return b=g,void T.move(b,e);M||(M=l.dateNow(),D=M+P);var o=Math.min(l.dateNow(),D),i=(o-M)/(D-M);if(b={x:Math.round(N+O*i),y:Math.round(C+v*i)},b.x===N&&b.y===C){if(p)return void e();0!==O?b.x=b.x+(O>0?1:-1):0!==v&&(b.y=b.y+(v>0?1:-1))}T.move(b,t)},emulateEvents:function(){if(!A){var t=T.getElementUnderCursor(b.x,b.y),o=b;n&&!h&&(h=t),t&&(o=_.getEventOptionCoordinates(t,b));var r=a.extend({clientX:o.x,clientY:o.y,button:0,which:l.isWebKit?n?l.WHICH_PARAMETER.LEFT_BUTTON:l.WHICH_PARAMETER.NO_BUTTON:1,buttons:n?l.BUTTONS_PARAMETER.LEFT:l.BUTTONS_PARAMETER.NO_BUTTON},i),s=!0;try{s=t!==y}catch(E){y=null,s=!0}s&&y&&c.mouseout(y,a.extend({relatedTarget:t},r));var u=l.hasTouchEvents?"touchmove":"mousemove",f=l.hasTouchEvents?h:t;l.isIE&&t&&c[u](f,r),s&&(t&&c.mouseover(t,a.extend({relatedTarget:y},r)),y=t),!l.isIE&&t&&c[u](f,r),s&&t&&c[u](f,r)}e()}})}S=S||o;var m=l.isDomElement(t)?_.getMouseActionPoint(t,i,!1):{x:Math.floor(t.x),y:Math.floor(t.y)},R=S!==o,g=null,N=null,C=null,h=null,O=null,v=null,M=null,D=null,P=null,y=null,b=T.getPosition(),L=a(e);s.series({scrollToTarget:function(e){var n=l.isDomElement(t)?l.getOffsetPosition(t):null;d.run(l.isDomElement(t)?t:m,i,S,function(){if(l.isDomElement(t)){var i=l.getOffsetPosition(t),r=l.getElementScroll(a(t));t!==o.documentElement&&(m.x+=i.left-n.left,m.y+=i.top-n.top),!/html/i.test(t.tagName)&&l.hasScroll(t,S)&&(m.x-=r.left,m.y-=r.top)}g=l.offsetToClientCoords(m),e()})},setCursor:function(t){if(m.x<0||g.x>L.width()||g.y<0||g.y>L.height)return void r();var n=null;if(e.top===e.self){var o=T.getPosition(),i=o?T.getElementUnderCursor(o.x,o.y):null;if(!i||!i.tagName||"iframe"!==i.tagName.toLowerCase())return void T.ensureCursorPosition(g,!1,t);var a=l.clientToOffsetCoord(o),s=l.getFixedPositionForIFrame(a,i.contentWindow);(s.x<=0||s.y<=0)&&T.ensureCursorPosition(g,!1,t),E.pingIFrame(i,u.MOVE_CURSOR_IN_IFRAME_PING,function(o){return o?void T.ensureCursorPosition(g,!1,t):(n=function(o){o.message.cmd===u.MOVE_FROM_IFRAME_RESPONSE_CMD&&(E.off(E.SERVICE_MSG_RECEIVED,n),o.message.point?T.getPosition()?(T.setPosition(l.getFixedPosition(o.message.point,i.contentWindow,!0)),e.setTimeout(t,0)):T.ensureCursorPosition(l.getFixedPosition(o.message.point,i.contentWindow,!0),!0,t):T.ensureCursorPosition(g,!1,t))},E.on(E.SERVICE_MSG_RECEIVED,n),E.sendServiceMsg({cmd:u.MOVE_FROM_IFRAME_REQUEST_CMD,rectangle:l.getIFrameCoordinates(i.contentWindow),startPoint:l.clientToOffsetCoord(g),endPoint:a,cursorPosition:l.getFixedPositionForIFrame(a,i.contentWindow)},i.contentWindow),void 0)},!0)}else n=function(o){o.message.cmd===u.MOVE_TO_IFRAME_RESPONSE_CMD&&(E.off(E.SERVICE_MSG_RECEIVED,n),!o.message.point||o.message.point.x===g.x&&o.message.point.y===g.y?T.ensureCursorPosition(g,!1,t):T.getPosition()?(T.setPosition(o.message.point),e.setTimeout(t,0)):T.ensureCursorPosition(o.message.point,!0,t))
},E.on(E.SERVICE_MSG_RECEIVED,n),E.sendServiceMsg({cmd:u.MOVE_TO_IFRAME_REQUEST_CMD,point:g},e.top)},moveToTarget:function(t){return(b=T.getPosition())?(N=b.x,C=b.y,O=g.x-N,v=g.y-C,R&&(N-=a(S).scrollLeft(),C-=a(S).scrollTop()),P=Math.max(Math.abs(O),Math.abs(v))/(n?f.MOVING_SPEED_IN_DRAGGING:f.MOVING_SPEED),n&&(P=Math.max(P,f.MINIMUM_MOVING_TIME)),void s.whilst(function(){return R?b.x+a(S).scrollLeft()!==g.x||b.y+a(S).scrollTop()!==g.y:b.x!==g.x||b.y!==g.y},function(t){e.setTimeout(function(){I(t)},0)},function(e){e||t()})):void r()},callback:function(){r()}})}}),n.define("Automation.Press.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.async,a=i.Util,s=n("Settings"),l=n("Automation.Press.KeyPressSimulator"),c=n("Automation.Util"),E=n("UI.SelectElement");o.run=function(t,n){var o=a.parseKeysString(t),i=o.commands;r.forEachSeries(i,function(t,n){a.isSelectElement(a.getActiveElement())&&(!/enter|tab/.test(t)||(!s.RECORDING||s.PLAYBACK)&&/enter|tab/.test(t))&&E.switchOptionsByKeys(t),l.press(t,function(){e.setTimeout(n,c.ACTION_STEP_DELAY)})},function(){n()})}}),n.define("Automation.RClick.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.$,a=i.async,s=i.Util,l=i.EventSimulator,c=n("Settings"),E=n("Automation.Util"),u=n("Automation.Settings"),_=n("UI.Cursor"),f=n("Automation.Move.Playback");o.run=function(t,n,o){n={ctrl:n.ctrl,alt:n.alt,shift:n.shift,meta:n.meta,offsetX:n.offsetX,offsetY:n.offsetY,caretPos:n.caretPos};var i=s.isSvgElement(t),d=s.isContainOffset(t,n.offsetX,n.offsetY)?t:E.getMouseActionPoint(t,n,!1),T=!0,S=null,A=null,p=null,I=null,m=!1,R=null;n.offsetX&&(n.offsetX=Math.round(n.offsetX)),n.offsetY&&(n.offsetY=Math.round(n.offsetY)),a.series({moveCursorToElement:function(o){return!c.RECORDING||c.PLAYBACK||s.isElementVisible(t)?void f.run(d,!1,n,function(){i&&s.isOpera||r(t).is("tref")?I=t:(S=E.getMouseActionPoint(t,n,!0),A=E.getEventOptionCoordinates(t,S),p=r.extend({clientX:A.x,clientY:A.y,button:s.BUTTON.RIGHT,which:s.WHICH_PARAMETER.RIGHT_BUTTON,buttons:s.BUTTONS_PARAMETER.RIGHT_BUTTON},n),I=E.getElementUnderCursor(S.x,S.y,null,d),I||(m=!0,I=t)),e.setTimeout(o,u.ACTION_STEP_DELAY)}):(I=t,void e.setTimeout(o,u.ACTION_STEP_DELAY))},cursorMouseDown:function(e){_.rMouseDown(e)},mousedown:function(e){var o=s.getActiveElement(),i=!(s.isIE&&o===I);return T=l.mousedown(I,p),!m&&S&&(R=E.getElementUnderCursor(S.x,S.y,null,d),R&&(I=R)),T===!1?void e():void E.focusAndSetSelection(s.isContentEditableElement(t)?t:I,n,i,e)},cursorMouseUp:function(e){_.mouseUp(e)},mouseup:function(t){l.mouseup(I,p),!m&&S&&(R=_.getElementUnderCursor(S.x,S.y,null,d),R&&(I=R)),e.setTimeout(t,u.ACTION_STEP_DELAY)},contextmenu:function(){l.contextmenu(I,p),E.focusLabelChildElement(I),o()}})}}),n.define("Automation.Scroll.Playback",function(n,i){function r(e,t,n,o){var i=E.getClientDimensions(t),r=E.getClientDimensions(e[0]),a=null,s=null,l=Math.min(f,Math.floor(r.width/2)),c=Math.min(f,Math.floor(r.height/2)),u=-1,_=-1,d={top:i.top-(r.top+r.border.top),bottom:r.bottom-r.border.bottom-r.scrollbar.bottom-i.bottom,left:i.left-(r.left+r.border.left),right:r.right-r.border.right-r.scrollbar.right-i.right};d.top<0?a=Math.round(r.scroll.top+d.top-c):d.top>0&&d.bottom<0&&(a=Math.round(r.scroll.top+Math.min(d.top,-d.bottom)+c),u=1),d.left<0?s=Math.round(r.scroll.left+d.left-l):d.left>0&&d.right<0&&(s=Math.round(r.scroll.left+Math.min(d.left,-d.right)+l),_=1);var T=Math.abs(i.right-i.left),S=Math.abs(i.bottom-i.top);return r.width<=T&&n>=r.width-(r.border.left+r.border.right)&&(s=(null===s?n:s+n-_*l)-l),r.height<=S&&o>=r.height-(r.border.top+r.border.bottom)&&(a=(null===a?o:a+o-u*c)-c),null!==s||null!==a?{top:a,left:s}:null}function a(t,n,o,i){function r(e,t){return null===e?0:e>(t?_:f)?1:-1}function a(){t.scrollLeft(I),t.scrollTop(m),R=I,g=m}var s=null,l=null,u=E.getElementScroll(t),_=u.left,f=u.top,A=0,p=0,I=null,m=null,R=null,g=null,N=e.requestAnimationFrame||e.webkitRequestAnimationFrame,C=null,h=null;A=r(n,!0),p=r(o,!1),s=Math.max(Math.abs(n-_)/T,d),l=Math.max(Math.abs(o-f)/T,d),c.whilst(function(){return A||p?(I=Math.round(E.getElementScroll(t).left+A*s),I=1===A?Math.min(I,n):Math.max(I,n),m=Math.round(E.getElementScroll(t).top+p*l),m=1===p?Math.min(m,o):Math.max(m,o),I!==R||m!==g):!1},function(t){E.isSafari&&N?(C=function(e){h||(h=e),a(),e-h>=T?t():N(C)},N(C)):(a(),e.setTimeout(function(){t()},S))},function(){i()})}var s=t.get("Hammerhead"),l=s.$,c=s.async,E=s.Util,u=s.MessageSandbox,_=n("Base.CrossDomainMessages"),f=50,d=10,T=1,S=10;i.run=function(t,n,i,s){function d(t,n){L=function(e){e.message.cmd===_.SCROLL_TOP_WINDOW_RESPONSE_CMD&&(u.off(u.SERVICE_MSG_RECEIVED,L),L=null,n())},u.on(u.SERVICE_MSG_RECEIVED,L),u.sendServiceMsg(t,e.top)}var T=E.isTouchDevice&&E.isMozilla?200:0,S=E.isDomElement(t),A=S&&/html/i.test(t.tagName),p=[],I=null,m=null,R=null,g=null,N=null,C=null,h=null,O=null,v=null,M=null,D=null,P=null,y=0,b=0,L=null;c.series({scrollElement:function(e){return S?(m=l(t),R=m[0].getBoundingClientRect(),g=A?m[0].clientWidth:R.width,N=A?m[0].clientHeight:R.height,C=n&&"undefined"!=typeof n.offsetX?n.offsetX:Math.round(g/2),h=n&&"undefined"!=typeof n.offsetY?n.offsetY:Math.round(N/2),O=Math.min(f,Math.floor(g/2)),v=Math.min(f,Math.floor(N/2)),M=E.getElementScroll(m),E.hasScroll(t,i)?(C>=M.left+g?D=C-O:C<=M.left&&(D=C-O),h>=M.top+N?P=h-v:h<=M.top&&(P=h-v),void c.series({scrollBody:function(e){A?a(m.find("body"),D,P,e):e()},ownScroll:function(e){a(m,D,P,e)},callback:function(){e()}})):void e()):void e()},scrollElementParents:function(e){if(p=S?E.getScrollableParents(t,i):[o.documentElement],!p.length)return void e();var n=I?I:t;y=m?C-m.scrollLeft():C,b=m?h-m.scrollTop():h,c.forEachSeries(p,function(e,t){function o(){var o=E.getClientDimensions(n),r=E.getClientDimensions(i[0]);y=o.left-r.left+r.border.left+C,b=o.top-r.top+r.border.top+h,n=e,t()}var i=l(e),s=r(i,n,Math.max(0,y),Math.max(0,b));return s?void c.series({scrollBody:function(t){/html/i.test(e.tagName)?a(i.find("body"),s.left,s.top,t):t()},ownScroll:function(){a(i,s.left,s.top,o)}}):void o()},function(){e()})},callback:function(){e.setTimeout(function(){if(e.top===e.self)return void s();if(S){var n={cmd:_.SCROLL_TOP_WINDOW_REQUEST_CMD,options:{offsetX:Math.max(0,y),offsetY:Math.max(0,b)}};d(n,s)}else L=function(e){if(e.message.cmd===_.GET_IFRAME_POSITION_DATA_RESPONSE_CMD){u.off(u.SERVICE_MSG_RECEIVED,L),L=null;var n=E.getElementScroll(l(o)),i={cmd:_.SCROLL_TOP_WINDOW_REQUEST_CMD,point:{x:t.x-n.left+e.message.scroll.left,y:t.y-n.top+e.message.scroll.top}};d(i,s)}},u.on(u.SERVICE_MSG_RECEIVED,L),u.sendServiceMsg({cmd:_.GET_IFRAME_POSITION_DATA_REQUEST_CMD},e.top)},T)}})}}),n.define("Automation.Select.Playback",function(n,o){var i=t.get("Hammerhead"),r=i.$,a=i.async,s=i.Util,l=i.EventSandbox,c=i.EventSimulator,E=i.NativeMethods,u=n("Settings"),_=i.ContentEditableHelper,f=n("UI.Cursor"),d=i.TextSelection,T=n("Automation.Settings"),S=n("Automation.Util"),A=n("Automation.Select.Util"),p=n("Automation.Scroll.Playback"),I=n("Automation.Move.Playback");o.run=function(t,n,o){var i="textarea"===t.tagName.toLowerCase(),m=s.isTextEditableElement(t),R=s.isContentEditableElement(t),g=null,N=null,C=null,h=null,O=null,v=null,M=null,D=null,P=null,y=null,b=null,L=null,F=!0,U=null,x=null,w=A.getProcessedOptions(t,n);return C=w.startPosition,h=w.endPosition,!u.RECORDING||u.PLAYBACK||s.isElementVisible(t)?void a.series({scrollToElement:function(e){p.run(t,{},null,function(){A.getCorrectOptions(t,function(t){x=t,e()})})},moveToStart:function(a){m&&t.value.length>0||R&&_.getContentEditableValue(t).length?(O=A.getSelectPositionCoordinates(t,C,h,!0,x),v=A.getSelectPositionCoordinates(t,C,h,!1,x)):(O=s.findCenter(t),v=O),A.scrollElementByPoint(t,O),U=A.updatePointByScrollElement(t,O),I.run(U,!1,n,function(){return D=s.offsetToClientCoords(U),y=S.getEventOptionCoordinates(t,D),b=r.extend({clientX:y.x,clientY:y.y},n),(g=f.getElementUnderCursor(D.x,D.y))?(m=s.isTextEditableElement(g),i="textarea"===g.tagName.toLowerCase(),void e.setTimeout(a,T.DRAG_ACTION_STEP_DELAY)):void o()})},cursorMousseDown:function(e){f.lMouseDown(e)},mousedown:function(e){var o=(s.isWebKit||s.isIE)&&s.isSelectElement(t),i=null;if(o){var r=function(e){i=e.defaultPrevented,s.preventDefault(e),E.removeEventListener.call(t,"mousedown",r,!1)};E.addEventListener.call(t,"mousedown",r,!1)}if(F=s.hasTouchEvents?c.touchstart(g,b):c.mousedown(g,b),N=f.getElementUnderCursor(D.x,D.y),N&&(g=N),F===!1){if(!o||i)return void e();F=!0}R&&(g=t),l.focus(R?_.findContentEditableParent(g):g,function(){v=A.getSelectPositionCoordinates(g,C,h,!1,x),R&&!v&&(v=A.getSelectionLastVisiblePosition(t,C,h,x)||s.findCenter(t)),A.scrollElementByPoint(g,v),v=A.updatePointByScrollElement(g,v),I.run(v,!1,n,function(){e()})},!1,!0)},getCorrectOptions:function(e){if(m&&g.value.length>0||R&&_.getContentEditableValue(g).length){if(v)return U=v,void e();A.getCorrectOptions(g,function(t){U=A.getSelectPositionCoordinates(g,C,h,!1,t),e()})}else e()},setFinalSelection:function(e){U||(U=s.findCenter(g)),A.scrollElementByPoint(g,U),U=A.updatePointByScrollElement(g,U),M=s.offsetToClientCoords(U),P=S.getEventOptionCoordinates(g,M),L=r.extend({clientX:P.x,clientY:P.y},n),(m||R)&&F!==!1&&(R&&n.startNode&&n.endNode?A.selectContentEditableByOptions(t,C,h,n):d.select(g,C,h)),e()},cursorMouseUp:function(e){f.mouseUp(e)},mouseup:function(){s.hasTouchEvents?c.touchend(g,L):c.mouseup(g,L),o()}}):(g=t,void e.setTimeout(o,T.ACTION_STEP_DELAY))}}),n.define("Automation.Select.Util",function(n,i){function r(e,t,n){var o=_.getPositionCoordinates(e,t,n);if(o){var i={x:o.left,y:o.top+(o.bottom-o.top)/2},r=E.getElementScroll(c(e));return E.isIE&&(i.x+=r.left,i.y+=r.top),i}}function a(e,t,n){return t.x+(e-t.y)*(n.x-t.x)/(n.y-t.y)}function s(e,t,n,o,i){function r(e,t){var n=u.slice(e+1),o=e+1;return n.length?(c.each(n,function(e,r){if(s){if(r.point.x>t)return o+=e,!1}else if(r.point.x>=a(n[e].point.y,u[0].point,null===i?u[u.length-1].point:i))return o+=e,!1}),o):e}var s=t.endPos>t.startPos,l=t.startPosition>t.endPosition,E=0===t.startPos&&l?2:1,u=[{position:t.startPosition,point:n}],_=null,f=null;u=u.concat(c.extend(!0,[],e));var d=0,T=0;if(s){for(d=E;d<u.length;d++)if(u[d].point.x<u[d-1].point.x){for(_=r(d,u[d-1].point.x),T=d;_>T;T++)u[T].point.x=a(u[T].point.y,u[d-1].point,u[_].point);d=_}}else for(d=E;d<u.length&&u[d].position!==(null===o?u[u.length-1].position:o);d++)if(f=a(u[d].point.y,u[0].point,null===i?u[u.length-1].point:i),u[d].point.x<f){for(_=r(d),T=d;_>T;T++)u[T].point.x=a(u[T].point.y,u[d-1].point,u[_].point);d=_}return u}var l=t.get("Hammerhead"),c=l.$,E=l.Util,u=l.MessageSandbox,_=l.TextSelection,f=l.ContentEditableHelper,d=n("Base.CrossDomainMessages");i.getSelectPositionCoordinates=function(e,t,n,o,i){var r=t>n,a=_.getPositionCoordinates(e,t,i),s=_.getPositionCoordinates(e,n,i),l=null;return o||t===n?a?l=t!==n?{x:a.left,y:r?a.bottom:a.top}:{x:a.left,y:a.top+(a.bottom-a.top)/2}:E.findCenter(e):s?{x:s.left,y:r?s.top:s.bottom}:null},i.scrollElementByPoint=function(e,t){var n="textarea"===e.tagName.toLowerCase();if(E.isEditableElement(e)){var o=E.getOffsetPosition(e),i=E.getBordersWidth(c(e)),r=E.getElementScroll(c(e)),a=E.getIFrameByElement(e),s=a?E.getElementScroll(c(a.contentWindow.document)):null;if(!(E.isMozilla||E.isIE&&E.browserVersion>10)||n){var l=t.x-(o.left+i.left+(n&&a?s.left:0)),u=t.y-(o.top+i.top+(n&&a?s.top:0)),_=null;n?(u<r.top?_=u:u>e.clientHeight+r.top&&(_=u-e.clientHeight),null!==_&&c(e).scrollTop(Math.round(_))):(l<r.left?_=l:l>e.clientWidth+r.left&&(_=l-e.clientWidth),null!==_&&c(e).scrollLeft(Math.round(_)))}}},i.updatePointByScrollElement=function(e,t){var n=E.isTextEditableElement(e),o="textarea"===e.tagName.toLowerCase();if(n||E.isContentEditableElement(e)){var i=t.x,r=t.y,a=E.getOffsetPosition(e),s=E.getBordersWidth(c(e)),l=E.getElementScroll(c(e)),u=E.isElementInIframe(e)?E.getElementScroll(c(E.findDocument(e))):null;return n&&(E.isMozilla||E.isIE&&E.browserVersion>10)&&!o?{x:Math.min(i,a.left+s.left+e.clientWidth)-(u?u.left:0),y:r-(u?u.top:0)}:{x:i-l.left-(u?u.left:0),y:r-l.top-(u?u.top:0)}}},i.getProcessedOptions=function(e,t){var n="textarea"===e.tagName.toLowerCase(),o=E.isTextEditableElement(e),i=E.isContentEditableElement(e),r=null,a=null,s=[],l=null,u=null,_=null,d=null,T=null,S=null;return n&&(s=e.value.length?e.value.split("\n"):[]),o?e.value.length?"undefined"!=typeof t.offset||c.isEmptyObject(t)?(r=0,"undefined"==typeof t.offset?a=e.value.length:t.offset>=0?a=Math.min(t.offset,e.value.length):(a=Math.max(0,e.value.length+t.offset),r=e.value.length)):"undefined"!=typeof t.startLine&&n?(t.startLine>=s.length?(T=e.value.length,_=s.length-1):(_=t.startLine,T=E.getTextareaPositionByLineAndOffset(e,_,0)),t.endLine>=s.length?(S=e.value.length,d=s.length-1):(d=t.endLine,S=E.getTextareaPositionByLineAndOffset(e,d,0)),l=Math.min(t.startPos,s[_].length),r=T+l,"undefined"==typeof t.endPos?(u=s[d].length,a=S+u):(u=Math.min(t.endPos,s[d].length),a=S+u)):(r=Math.min(t.startPos,e.value.length),a=Math.min(t.endPos,e.value.length)):r=a=0:i&&(f.getContentEditableValue(e).length||(r=a=0),"undefined"!=typeof t.startNode&&"undefined"!=typeof t.endNode?(r=f.getFirstVisiblePosition(t.startNode),r=f.calculatePositionByNodeAndOffset(e,t.startNode,r),a=f.getLastVisiblePosition(t.endNode),a=f.calculatePositionByNodeAndOffset(e,t.endNode,a),r>a&&(r=f.getLastVisiblePosition(t.startNode),r=f.calculatePositionByNodeAndOffset(e,t.startNode,r),a=f.getFirstVisiblePosition(t.endNode),a=f.calculatePositionByNodeAndOffset(e,t.endNode,a))):"undefined"!=typeof t.offset||c.isEmptyObject(t)?(r=f.getFirstVisiblePosition(e),"undefined"==typeof t.offset?a=f.getLastVisiblePosition(e):t.offset>=0?a=Math.min(t.offset,f.getLastVisiblePosition(e)):(a=Math.max(0,f.getLastVisiblePosition(e)+t.offset),r=f.getLastVisiblePosition(e))):(r=Math.min(t.startPos,f.getLastVisiblePosition(e)),a=Math.min(t.endPos,f.getLastVisiblePosition(e)))),n&&"undefined"==typeof t.endLine&&e.value.length&&(_=E.getTextareaLineNumberByPosition(e,r),l=E.getTextareaIndentInLine(e,r),d=E.getTextareaLineNumberByPosition(e,a),u=E.getTextareaIndentInLine(e,a)),{startPosition:r,endPosition:a,startLine:_,endLine:d,startPos:l,endPos:u}},i.getSelectionPath=function(e,t,n,o,i){function a(t){g&&null===O&&(h=t,O=r(e,t,i))}function l(t){N.push(t===_?{position:_,point:o}:{position:t,point:r(e,t,i)})}var c="textarea"===e.tagName.toLowerCase(),u=t.startPosition,_=t.endPosition,f=u>_,d=[],T=null,S=null,A=null,p=null,I=u,m=null,R=null,g=!1,N=[],C=null,h=null,O=null;if(c&&(d=e.value.length?e.value.split("\n"):[],T=t.startPos,S=t.endPos,A=t.startLine,p=t.endLine),c&&A!==p)for(m=E.getTextareaLineNumberByPosition(e,I),R=E.getTextareaIndentInLine(e,I);I!==_;)m!==p?(g||(g=1!==Math.abs(u-_)),m=f?m-1:m+1,R!==S?m!==p||0!==S&&S!==d[m].length?(m===p||0!==S&&(S!==d[p].length||0===T))&&(R=R>S?R-1:R+1):(!N[N.length-1]||f&&E.getTextareaIndentInLine(e,N[N.length-1].position)<S||a(N[N.length-1]?N[N.length-1].position:null),R=S):E.isIE||m===p||0!==S||(R=f?1:R+1),I=E.getTextareaPositionByLineAndOffset(e,m,Math.min(R,d[m].length))):(I=I>_?I-1:I+1,a(I)),l(I);else for(;I!==_;)I=f?I-1:I+1,l(I);return N.push({position:_,point:o||C}),g?s(N,t,n,h,O):N},i.getSelectionLastVisiblePosition=function(e,t,n,o){for(var i=t>n,a=n+(i?1:-1),s=null;a!==t&&(a=i?a+1:a-1,!(s=r(e,a,o))););return s},i.selectContentEditableByOptions=function(e,t,n,o){var i=t>n,r=f.calculateNodeAndOffsetByPosition(e,t),a=f.calculateNodeAndOffsetByPosition(e,n),s=null,l=null;o.startNode!==r.node&&!E.isElementContainsNode(o.startNode,r.node)||o.endNode!==a.node&&!E.isElementContainsNode(o.endNode,a.node)?(i?(s=f.getLastVisiblePosition(o.startNode),l=f.getFirstVisiblePosition(o.endNode)):(s=f.getFirstVisiblePosition(o.startNode),l=f.getLastVisiblePosition(o.endNode)),r=f.calculateNodeAndOffsetByPosition(o.startNode,s),a=f.calculateNodeAndOffsetByPosition(o.endNode,l),_.selectByNodesAndOffsets(r.node,r.offset,a.node,a.offset,!0,i)):_.select(e,t,n)},i.getCorrectOptions=function(t,n){var i=t.getBoundingClientRect(),r=t.scrollHeight||i.height,a=E.isElementInIframe(t),s=E.getIFrameByElement(t),l=null,_={isTextarea:"textarea"===t.tagName.toLowerCase(),isContentEditable:E.isContentEditableElement(t),elementBorders:E.getBordersWidth(c(t)),elementRect:i,elementHeight:r,elementOffset:E.getOffsetPosition(t),isInIFrame:a,isInProcessedIFrame:e.top!==e.self,iFrame:s,documentScroll:E.getElementScroll(c(o)),iFrameDocumentScroll:a?E.getElementScroll(c(E.findDocument(t))):{left:0,top:0}};a&&(_.iFrame=E.getIFrameByElement(t),_.iFrameOffset=E.getOffsetPosition(s),_.iFrameBorders=E.getBordersWidth(c(s)),_.iFrameMargin=E.getElementMargin(c(s)),_.iFramePadding=E.getElementPadding(c(s))),E.isIE&&E.browserVersion<11&&_.isInProcessedIFrame?(l=function(e){e.message.cmd===d.GET_IFRAME_POSITION_DATA_RESPONSE_CMD&&(u.off(u.SERVICE_MSG_RECEIVED,l),l=null,_.windowTopScroll=e.message.scroll,_.crossDomainIFrameOffset=e.message.iFrameOffset,_.crossDomainIFrameBorders=e.message.iFrameBorders,_.crossDomainIFramePadding=e.message.iFramePadding,n(_))},u.on(u.SERVICE_MSG_RECEIVED,l),u.sendServiceMsg({cmd:d.GET_IFRAME_POSITION_DATA_REQUEST_CMD},e.top)):n(_)}}),n.define("Automation.Type.Playback",function(n,o){function i(e){var t=l.isContentEditableElement(e);if(!l.isTextEditableElement(e)&&!t){var n=a(e).find("*").filter(function(){return l.isTextEditableElementAndEditingAllowed(this)});if(n.length)return n[0]}return e}var r=t.get("Hammerhead"),a=r.$,s=r.async,l=r.Util,c=r.EventSandbox,E=r.EventSimulator,u=n("Settings"),_=r.TextSelection,f=r.ContentEditableHelper,d=n("Automation.Settings"),T=n("Automation.TypeChar.Playback"),S=n("Automation.Click.Playback");o.run=function(t,n,o,r){n=n.toString();var A=n.length,p=null,I=null,m=0,R=null,g=null,N=l.isContentEditableElement(t),C=!0;return o.offsetX&&(o.offsetX=Math.round(o.offsetX)),o.offsetY&&(o.offsetY=Math.round(o.offsetY)),p=i(t),R=l.isTextEditableElementAndEditingAllowed(p),g=l.isInputWithoutSelectionPropertiesInMozilla(p),!u.RECORDING||u.PLAYBACK||l.isElementVisible(p)?void s.series({click:function(t){l.getActiveElement()!==p?S.run(p,o,function(){e.setTimeout(t,d.ACTION_STEP_DELAY)}):(R&&c.watchElementEditing(p),(R||N)&&(isNaN(parseInt(o.caretPos))||o.caretPos===_.getSelectionStart(p)||_.select(p,o.caretPos,o.caretPos)),t())},clearText:function(e){return!N&&l.getActiveElement()!==p||N&&l.getActiveElement()!==f.findContentEditableParent(p)?void r():(p=N?t:l.getActiveElement(),o.replace&&(g?p.value="":R?(_.select(p),T.run(p,"")):N&&_.deleteSelectionContents(p,!0)),void e())},type:function(){var u=null;g&&(u=isNaN(parseInt(o.caretPos))?t.value.length:o.caretPos),s.whilst(function(){return A>m},function(t){var r=l.getKeyCodeByChar(n.charAt(m)),_=n.charCodeAt(m);s.series({startTypeSymbol:function(t){if(C=E.keydown(p,a.extend(o,{keyCode:r})),delete o.keyCode,C!==!1)if(N||p===l.getActiveElement()||(p=l.getActiveElement(),p=i(p),R=l.isTextEditableElementAndEditingAllowed(p),g=l.isInputWithoutSelectionPropertiesInMozilla(p)),I=p,C=E.keypress(p,a.extend(o,{keyCode:_,charCode:_})),delete o.charCode,N||p===l.getActiveElement()||(p=l.getActiveElement(),p=i(p)),C===!1)c.restartWatchingElementEditing(I);else{var s=n.charAt(m),f=0===m?null:n.charAt(m-1);g&&"."===s||(f&&(g&&/(\.|-)/.test(f)||(!l.isIE||9!==l.browserVersion)&&a(I).is("input[type=number]")&&"-"===f)?T.run(I,f+s,u+m-1):T.run(I,s,u+m))}e.setTimeout(t,d.ACTION_STEP_DELAY)},endTypeSymbol:function(){E.keyup(p,a.extend(o,{keyCode:r})),delete o.keyCode,m++,t()}})},function(){r()})}}):void r()}}),n.define("Automation.TypeChar.Playback",function(e,n){function i(e){var t=E.getSelectionByElement(e),n=E.hasInverseSelectionContentEditable(e);if(E.hasElementContainsSelection(e))t=u.getSelection(e,t,n);else{var o=u.calculateNodeAndOffsetByPosition(e,0),i=u.calculateNodeAndOffsetByPosition(e,0);t={},t.startNode=o.node,t.startOffset=o.offset,t.endNode=i.node,t.endOffset=i.offset}return t}function r(e,t){var n=" "===t?String.fromCharCode(160):t,r=i(e),a=r.startNode,s=r.startOffset,c=r.endNode,_=r.endOffset;if(a&&l.isContentEditableElement(a)&&c&&l.isContentEditableElement(c)){var f=u.getFirstNonWhitespaceSymbolIndex(a.nodeValue),d=u.getLastNonWhitespaceSymbolIndex(a.nodeValue),T=a.parentNode,S=!l.isTheSameNode(a,c),A=null,p=null,I=null,m=null,R=null,g=null;if(S){if(E.deleteSelectionContents(e),!(!l.isWebKit&&a.parentNode&&a.parentElement&&l.isElementContainsNode(e,a)||(r=i(e),A=E.hasInverseSelectionContentEditable(e),a=A?r.endNode:r.startNode,s=A?r.endOffset:r.startOffset,a&&l.isContentEditableElement(a))))return;_=s}if(l.isRenderedNode(a)){if(1===a.nodeType)return p=o.createTextNode(n),"br"===a.tagName.toLowerCase()?T.insertBefore(p,a):a.appendChild(p),R=n.length,void E.selectByNodesAndOffsets(p,R,p,R);f>s&&0!==s?(I=f,m=_+(f-s)):_>d&&_!==a.nodeValue.length?(I=a.nodeValue.length,m=_+(a.nodeValue.length-s)):(I=s,m=_),p=p||a,g=p.nodeValue,p.nodeValue=g.substring(0,I)+n+g.substring(m,g.length),R=I+n.length,E.selectByNodesAndOffsets(p,R,p,R)}}}var a=t.get("Hammerhead"),s=a.$,l=a.Util,c=a.EventSimulator,E=a.TextSelection,u=a.ContentEditableHelper;n.run=function(e,t,n){if(l.isContentEditableElement(e))return void r(e,t);if(l.isTextEditableElementAndEditingAllowed(e)){var o=E.getSelectionStart(e),i=E.getSelectionEnd(e),a=s(e).is("input[type=number]"),u=!l.isIE&&a?null:parseInt(s(e).attr("maxLength")),_=e.value;(null===u||isNaN(u)||u>_.length)&&(a&&(l.isIOS&&"."===_[_.length-1]?(o+=1,i+=1):l.isInputWithoutSelectionPropertiesInMozilla(e)&&(o=i=n)),e.value=_.substring(0,o)+t+_.substring(i,_.length),E.select(e,o+t.length,o+t.length)),c.input(e)}}}),n.define("Base.jQueryExtensions.Selectors",function(e,n){var o=t.get("Hammerhead"),i=o.$;n.create=function(e){function t(){e.expr[":"][s]=function(e,t,n){if(!n[3])return!1;var i=o(e);return!!(i&&i.indexOf(n[3])>=0)},e.expr[":"][a]=function(e,t,n){var o,a,s=n[3];return s&&s.indexOf(i)>0&&s.lastIndexOf(r)===s.length-r.length&&s.indexOf(i)<s.length-r.length-i.length?(o=s.substr(0,s.indexOf(i)),a=s.substring(s.indexOf(i)+i.length,s.lastIndexOf(r)),new RegExp(a).test(e.getAttribute(o))):!1}}function o(t){if(!t||!l.test(t.tagName.toLowerCase()))return"";for(var n="",o=0;o<t.childNodes.length;o++)3===t.childNodes[o].nodeType&&t.childNodes[o].data&&(n+=t.childNodes[o].data);return n&&(n=e.trim(n.replace(/[^a-z0-9а-я \xC0-\xFF]+/gi,"")),n=n.replace(/\s+/g," "),/\S/.test(n))?n:""}var i=":/",r="/",a="attrRegExp",s="containsExcludeChildren",l=/^i$|^b$|^big$|^small$|^em$|^strong$|^dfn$|^code$|^samp$|^kbd$|^var$|^cite$|^abbr$|^acronym$|^sub$|^sup$|span$|^bdo$|^address$|^div$|^a$|^object$|^p$|^h\d$|^pre$|^q$|^ins$|^del$|^dt$|^dd$|^li$|^label$|^option$|^textarea$|^fieldset$|^legend$|^button$|^caption$|^td$|^th$|^title$/;return n.REGEXP_START_SUBSTR=i,n.REGEXP_END_SUBSTR=r,n.ATTR_REGEXP_METHOD_NAME=a,n.CONTAINS_OWN_TEXT_METHOD_NAME=s,n.getOwnTextForSelector=o,n.init=t,e},n.create(i)}),n.define("Base.jQueryExtensions.DataMethodProxy",function(t,n){n.setup=function(t){t.fn._data=t.fn.data,t!==e.jQuery&&!function(n){t.fn.data=function(){var o=this[0],i=e.jQuery,r=arguments[0],a=arguments[1];if(2===arguments.length)return this._data(r,a);if(!i||"function"!=typeof i(o).data)return this._data(r);if(!o)return this._data(r);var s=this._data(r);if(r===n)return t.extend(s,i(o).data());if(s!==n)return s;var l=i(o);return l.length?l.data(r):n}}()}}),n.define("ActionBarrier",function(t,n){var o=t("ActionBarrier.Xhr");n.init=function(){o.init()},n.waitPageInitialization=function(e){o.waitPageInitialRequests(e)},n.waitActionSideEffectsCompletion=function(t,n){o.startBarrier(n),t.call(e,function(){o.waitBarrier()})}}),n.define("ActionBarrier.Xhr",function(n,o){function i(t){d={passed:!1,collectingReqs:!0,requests:[],reqCount:0,callback:function(){d.passed||(d.passed=!0,d.watchdog&&e.clearTimeout(d.watchdog),t.apply(e,arguments))},watchdog:null}}function r(){d.collectingReqs=!1,d.reqCount?d.watchdog=e.setTimeout(function(){S.emit(o.XHR_BARRIER_ERROR,{code:c.XHR_REQUEST_TIMEOUT}),d.callback()},o.BARRIER_TIMEOUT):d.callback()}function a(e){for(var t=0;t<d.requests.length;t++)if(e===d.requests[t])return d.requests.splice(t,1),!0;return!1}var s=t.get("Hammerhead"),l=s.Util,c=n("Shared.Errors"),E=300,u=100,_=50,f=100;o.BARRIER_TIMEOUT=3e3,o.XHR_BARRIER_ERROR="error",o.GLOBAL_START_XHR_BARRIER="tc-gsxb-d1417385",o.GLOBAL_WAIT_XHR_BARRIER="tc-gwxb-d1417385";var d=null,T=null,S=new l.EventEmitter;o.events=S,o.init=function(){function t(e){a(e)&&d.reqCount--,d.collectingReqs||d.reqCount||d.callback()}T=!1,i(function(){T=!0}),s.on(s.XHR_SEND,function(e){d&&(d.reqCount++,d.requests.push(e.xhr))}),s.on(s.XHR_ERROR,function(n){e.console&&e.console.log&&e.console.log("TestCafe encountered XHR error on page: "+n.err),o.events.emit(o.XHR_BARRIER_ERROR,n.err),t(n.xhr)}),s.on(s.XHR_COMPLETED,function(n){e.setTimeout(function(){t(n.xhr)},u)})},o.waitPageInitialRequests=function(t){r();var n=function(){T?e.setTimeout(t,f):e.setTimeout(n,_)};n()},o.startBarrier=function(e){i(e)},o.waitBarrier=function(){e.setTimeout(r,E)},e[o.GLOBAL_START_XHR_BARRIER]=o.startBarrier,e[o.GLOBAL_WAIT_XHR_BARRIER]=o.waitBarrier}),n.define("TestRunner.API.Actions",function(n,o){function i(e,t){var n={code:e,stepName:m.CURRENT_TEST_STEP_NAME,__sourceIndex:R.currentIndex};t&&S.forEachKey(t,function(e){n[e]=t[e]}),U.onError(n)}function r(t,n,r){var a=!1,s=function(){var e=null;if("function"==typeof t){var o=t();if(e=S.ensureArray(o),o&&(!S.isJQueryObj(o)||o.length)&&e.length)return r(e),!0}else if("string"==typeof t&&(e=S.parseActionArgument(t,n),e&&e.length))return r(e),!0;return!1};if(!s()){var l=e.setInterval(function(){s()&&(a=!0,e.clearInterval(l))},b);e.setTimeout(function(){a||(e.clearInterval(l),i(p.API_EMPTY_FIRST_ARGUMENT,{action:n}))},o.ELEMENT_AVAILABILITY_WAITING_TIMEOUT)}}function a(t,n,r){var a=!1;if(S.isElementVisible(t)||"option"===t.tagName.toLowerCase()||"optgroup"===t.tagName.toLowerCase())return void r();var s=e.setInterval(function(){S.isElementVisible(t)&&(a=!0,e.clearInterval(s),r())},b);e.setTimeout(function(){a||(e.clearInterval(s),i(p.API_INVISIBLE_ACTION_ELEMENT,{element:S.getElementDescription(t),action:n}))},o.ELEMENT_AVAILABILITY_WAITING_TIMEOUT)}function s(e){var t=null,n=function(n,a){if(d.isArray(n))o(n,a);else if("function"==typeof n)r(n,e,function(e){o(e,a)});else if("string"==typeof n)r(n,e,function(e){t(e,a)});else{var s=S.parseActionArgument(n,e);!s||s.length<1?i(p.API_EMPTY_FIRST_ARGUMENT,{action:e}):t(s,a)}},o=function(t,o){t.length?T.forEachSeries(t,function(e,t){n(e,t)},function(){o()}):i(p.API_EMPTY_FIRST_ARGUMENT,{action:e})};return{run:function(e,n,i){c(),t=n,o(e,i)}}}function l(){return{run:function(e,t,n){t(e,n)}}}function c(e){U.onActionTargetWaitingStarted({maxTimeout:o.ELEMENT_AVAILABILITY_WAITING_TIMEOUT,isWaitAction:e})}function E(){U.onActionRun()}function u(t,n){x=e.setInterval(function(){U.callWithSharedDataContext(t)&&n()},F)}function _(){null!==x&&(e.clearInterval(x),x=null)}var f=t.get("Hammerhead"),d=f.$,T=f.async,S=f.Util,A=f.JSProcessor,p=n("Shared.Errors"),I=n("Shared.Const"),m=n("Settings"),R=n("TestRunner.SourceIndexTracker"),g=f.ContentEditableHelper,N=n("Automation"),C=n("Automation.Click.Playback"),h=n("Automation.RClick.Playback"),O=n("Automation.DblClick.Playback"),v=n("Automation.Drag.Playback"),M=n("Automation.Select.Playback"),D=n("Automation.Type.Playback"),P=n("Automation.Press.Playback"),y=n("Automation.Hover.Playback");o.ELEMENT_AVAILABILITY_WAITING_TIMEOUT=1e4;var b=200,L=1e4,F=50,U=null;o.init=function(e){U=e},o.click=function(e,t){var n=!1,o=S.ensureArray(e);U.asyncActionSeries(o,s("click").run,function(e,o,r){a(e,"click",function(){function a(e){i(e.code,{element:e.element,action:"click"})}n||(n=!0,E()),r?r.contentWindow[N.AUTOMATION_RUNNERS].click.playback.run(e,t||{},o,a):C.run(e,t||{},o,a)})})},o.rclick=function(e,t){var n=!1,o=S.ensureArray(e);U.asyncActionSeries(o,s("rclick").run,function(e,o,i){a(e,"rclick",function(){n||(n=!0,E()),i?i.contentWindow[N.AUTOMATION_RUNNERS].rclick.playback.run(e,t||{},o):h.run(e,t||{},o)})})},o.dblclick=function(e,t){var n=!1,o=S.ensureArray(e);U.asyncActionSeries(o,s("dblclick").run,function(e,o,i){a(e,"dblclick",function(){n||(n=!0,E()),i?i.contentWindow[N.AUTOMATION_RUNNERS].dblclick.playback.run(e,t||{},o):O.run(e,t||{},o)})})},o.drag=function(e){var t=!1,n=arguments,o=S.ensureArray(e),r=!isNaN(parseInt(n[1])),l=n.length>2&&r?{dragOffsetX:n[1],dragOffsetY:n[2]}:n[1];if(!l)return void i(p.API_INCORRECT_DRAGGING_SECOND_ARGUMENT);if(S.isJQueryObj(l)){if(l.length<1)return void i(p.API_INCORRECT_DRAGGING_SECOND_ARGUMENT);l=l[0]}else if(!S.isDomElement(l)&&(isNaN(parseInt(l.dragOffsetX))||isNaN(parseInt(l.dragOffsetY))))return void i(p.API_INCORRECT_DRAGGING_SECOND_ARGUMENT);var c=r?n[3]:n[2];U.asyncActionSeries(o,s("drag").run,function(e,n,o){a(e,"drag",function(){t||(t=!0,E()),o?o.contentWindow[N.AUTOMATION_RUNNERS].drag.playback.run(e,l,c||{},n):v.run(e,l,c||{},n)})})},o.select=function(){var e=!1,t=S.ensureArray(arguments[0]),n=d.makeArray(arguments).slice(1),o=null,r={},l=!1,c=null;if(arguments[0]||i(p.API_INCORRECT_SELECT_ACTION_ARGUMENTS),1===n.length)if(S.isJQueryObj(n[0])){if(n[0].length<1)return void i(p.API_INCORRECT_SELECT_ACTION_ARGUMENTS);o=n[0][0]}else o=n[0];return 1===n.length&&(S.isDomElement(o)||S.isTextNode(o))?S.isNotVisibleNode(o)?l=!0:(r.startNode=S.isJQueryObj(t[0])?t[0][0]:t[0],r.endNode=o,S.isContentEditableElement(r.startNode)&&S.isContentEditableElement(r.endNode)?(c=g.getNearestCommonAncestor(r.startNode,r.endNode),c?S.isTextNode(c)?c.parentElement?t=[c.parentElement]:l=!0:t=[c]:l=!0):l=!0):d.each(n,function(e,t){return isNaN(parseInt(t))||n.length>1&&0>t?(l=!0,!1):void 0}),l?void i(p.API_INCORRECT_SELECT_ACTION_ARGUMENTS):void U.asyncActionSeries(t,s("select").run,function(t,o,i){1!==n.length||r.startNode?2===n.length||n.length>2&&"textarea"!==t.tagName.toLowerCase()?r={startPos:n[0],endPos:n[1]}:n.length>2&&(r={startLine:n[0],startPos:n[1],endLine:n[2],endPos:n[3]}):r={offset:n[0]},a(t,"select",function(){e||(e=!0,E()),i?i.contentWindow[N.AUTOMATION_RUNNERS].select.playback.run(t,r,o):M.run(t,r,o)})})},o.type=function(e,t,n){if(!t)return void i(p.API_EMPTY_TYPE_ACTION_ARGUMENT);var o=!1,r=S.ensureArray(e);U.asyncActionSeries(r,s("type").run,function(e,i,r){a(e,"type",function(){o||(o=!0,E()),r?r.contentWindow[N.AUTOMATION_RUNNERS].type.playback.run(e,t,n||{},i):D.run(e,t,n||{},i)})})},o.hover=function(e,t){var n=!1,o=S.ensureArray(e);U.asyncActionSeries(o,s("hover").run,function(e,o,i){a(e,"hover",function(){n||(n=!0,E()),i?i.contentWindow[N.AUTOMATION_RUNNERS].hover.playback.run(e,o):y.run(e,t||{},o)})})},o.press=function(){U.asyncActionSeries(arguments,l().run,function(e,t){S.parseKeysString(e).error?i(p.API_INCORRECT_PRESS_ACTION_ARGUMENT):P.run(e,t)})};var x=null;o.wait=function(t,n){return n="function"==typeof n?n:null,"number"!=typeof t||0>t?void i(p.API_INCORRECT_WAIT_ACTION_MILLISECONDS_ARGUMENT):void U.asyncAction(function(o){U.expectInactivity(t,function(){function i(){e.clearTimeout(r),_(),o()}var r=e.setTimeout(i,t||0);n&&u(n,i)})})},o.waitFor=function(t,n){var o=S.isStringOrStringArray(t,!0),r=!1;return"function"==typeof t||o?("undefined"==typeof n&&(n=L),"number"!=typeof n||0>n?void i(p.API_INCORRECT_WAIT_FOR_ACTION_TIMEOUT_ARGUMENT):(c(!0),void U.asyncAction(function(a){function s(){r||(o&&_(),e.clearTimeout(l),E(),a())}var l=e.setTimeout(function(){o&&_(),r=!0,i(p.API_WAIT_FOR_ACTION_TIMEOUT_EXCEEDED)},n);U.expectInactivity(n,function(){var e=null;o?(e="string"==typeof t?function(){return!!d(t).length}:function(){for(var e=!0,n=0;n<t.length;n++)if(!d(t[n]).length){e=!1;break}return e},u(e,s)):U.callWithSharedDataContext(function(){t.call(this,function(){s()})})})}))):void i(p.API_INCORRECT_WAIT_FOR_ACTION_EVENT_ARGUMENT)},o.navigateTo=function(t){var n=1e3;U.asyncAction(function(o){e[A.SET_PROPERTY_METH_NAME](e,"location",t),e.setTimeout(o,n)})},o.upload=function(e,t){var n=!1,o=S.ensureArray(e);!S.isStringOrStringArray(t)&&t&&i(p.API_UPLOAD_INVALID_FILE_PATH_ARGUMENT),U.asyncActionSeries(o,s("upload").run,function(e,o){S.isFileInput(e)?(n||(n=!0,E()),f.upload(e,t,function(e){if(e.length){var t=e.map(function(e){return e.filePath
});i(p.API_UPLOAD_CAN_NOT_FIND_FILE_TO_UPLOAD,{filePaths:t})}else o()})):i(p.API_UPLOAD_ELEMENT_IS_NOT_FILE_INPUT)})},o.screenshot=function(){U.asyncAction(function(e){U.takeScreenshot(function(){e()},!1)})},R.wrapTrackableMethods(o,I.ACTION_FUNC_NAMES)}),n.define("TestRunner.API.Assertions",function(e){function n(e,t){return{actual:u(e),expected:u(t)}}function o(e){return e instanceof NodeList||e instanceof HTMLCollection}function i(e,t,a,_){if(_||(_={actual:{},expected:{}}),e===t)return null;if(e instanceof Date&&t instanceof Date){var f=e.getTime(),S=t.getTime();return f===S?null:{actual:f,expected:S,isDates:!0}}if("string"==typeof e&&"string"==typeof t)return l(e,t);if(d.isArray(e)||d.isArray(t))return d.isArray(e)&&d.isArray(t)?c(e,t):n(e,t);if(o(e)||o(t)){if(!o(e)||!o(t))return n(e,t);var A=d(e),p=d(t);return c(A.get(),p.get())?n(A,p):null}if(T.isDomElement(e)||T.isDomElement(t))return T.isDomElement(e)&&T.isDomElement(t)&&e===t?null:n(e,t);if(T.isJQueryObj(e)||T.isJQueryObj(t))return T.isJQueryObj(e)&&T.isJQueryObj(t)&&!c(e.get(),t.get())?null:n(e,t);if(null===e||"undefined"==typeof e||null===t||"undefined"==typeof t)return n(e,t);if("function"==typeof e||"function"==typeof t)return"function"!=typeof e||"function"!=typeof t||e!==t?n(e,t):null;if("object"!=typeof e||"object"!=typeof t)return e==t?null:n(e,t);if(e.prototype!==t.prototype)return n(e,t);var I=E(e),m=E(t);I.sort(),m.sort();var R=s(I,m);if(R){var g=R.actual||R.expected;return{key:a?[a,g].join("."):g,actual:u(e[g],!0),expected:u(t[g],!0),isObjects:!0}}for(var N=null,C=null,h=0;h<I.length;h++){N=I[h];var O=a?[a,N].join("."):N;if(r(_.actual,e[N])&&r(_.expected,t[N]))return null;if(_.actual[O]=e[N],_.expected[O]=t[N],C=i(e[N],t[N],O,_))return{key:C.key?C.key:O,actual:C.isArrays?u(e[N]):C.actual,expected:C.isArrays?u(t[N]):C.expected,isObjects:!0,diffType:{isObjects:C.isObjects,isArrays:C.isArrays,isStrings:C.isStrings,isDates:C.isDates}}}return null}function r(e,t){if("object"!=typeof t||null===t)return!1;for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t)return!0;return!1}function a(e,t){for(var n=0;n<Math.min(e.length,t.length);n++)if(i(e[n],t[n]))return n;return e.length!==t.length?Math.min(e.length,t.length):-1}function s(e,t){for(var n=-1,o=0;o<Math.min(e.length,t.length);o++)e[o]!==t[o]&&(n=o);return e.length!==t.length&&(n=Math.min(Math.max(e.length-1,0),Math.max(t.length-1,0))),n>-1?{key:n,actual:u(e[n],!0),expected:u(t[n],!0),isArrays:!0}:null}function l(e,t){for(var n=-1,o=Math.min(e.length,t.length),i=0;o>i;i++)if(e[i]!==t[i]){n=i;break}return 0>n&&e.length!==t.length&&(n=o?o-1:0),n>-1?{key:n,actual:u(e),expected:u(t),isStrings:!0}:null}function c(e,t){var n=a(e,t),o={};return"string"==typeof e[n]&&"string"==typeof t[n]?(o.isStrings=!0,o.diffIndex=l(e[n],t[n]).key):e[n]instanceof Date&&t[n]instanceof Date&&(o.isDates=!0),n>-1?{key:n,actual:o.isDates?e[n].getTime():u(e[n]),expected:o.isDates?t[n].getTime():u(t[n]),isArrays:!0,diffType:o}:null}function E(e){var t=[];return T.forEachKey(e,function(e){t.push(e)}),t}function u(e,t){if("string"==typeof e&&!t)return"'"+e+"'";if(e instanceof Date||/string|number|boolean|function/.test(typeof e))return e.toString();if(d.isArray(e))return _(e);if(T.isJQueryObj(e))return _(d.makeArray(e));if(null===e)return"null";if("undefined"==typeof e)return"undefined";if(T.isDomElement(e))return T.getElementDescription(e);try{return JSON.stringify(e)}catch(n){return e.toString()}}function _(e){for(var t=[],n=0;n<e.length;n++)t.push(u(e[n]));return"["+t.join(", ")+"]"}var f=t.get("Hammerhead"),d=f.$,T=f.Util,S=f.MessageSandbox,A=e("TestRunner.SourceIndexTracker"),p=e("Base.CrossDomainMessages"),I=e("Shared.Errors"),m=e("Shared.Const"),R=e("Settings"),g=this.exports=function(e){this.onAssertionFailed=e};g.prototype._fail=function(e){e.stepName=R.CURRENT_TEST_STEP_NAME,e.__sourceIndex=A.currentIndex,this.onAssertionFailed(e)},g.prototype.ok=function(e,t){e||this._fail({code:I.API_OK_ASSERTION_FAILED,message:t,actual:u(e)})},g.prototype.notOk=function(e,t){e&&this._fail({code:I.API_NOT_OK_ASSERTION_FAILED,message:t,actual:u(e)})},g.prototype.eq=function(e,t,n){var o=i(e,t);o&&this._fail({code:I.API_EQUAL_ASSERTION_FAILED,message:n,actual:o.actual,expected:o.expected,key:o.key,isStrings:o.isStrings,isArrays:o.isArrays,isObjects:o.isObjects,isDates:o.isDates,diffType:o.diffType||{}})},g.prototype.notEq=function(e,t,n,o){var r=i(e,t);r?o&&o():this._fail({code:I.API_NOT_EQUAL_ASSERTION_FAILED,message:n,actual:u(e),callback:o})},g.assert=function(e,t,n,o){function i(e){e.message.cmd===p.ASSERT_RESPONSE_CMD&&(S.off(S.SERVICE_MSG_RECEIVED,i),n(e.message.err))}if(o){S.on(S.SERVICE_MSG_RECEIVED,i);var r={cmd:p.ASSERT_REQUEST_CMD,operator:e,args:t};return void S.sendServiceMsg(r,o)}var a=null,s=new g(function(e){a=e});s[e].apply(s,t),n(a)},A.wrapTrackableMethods(g.prototype,m.ASSERTION_FUNC_NAMES)}),n.define("TestRunner.API.Dialogs",function(n,o){function i(e){_=e?e:{expectAlertCount:0,expectConfirmCount:0,expectPromptCount:0,expectedConfirmRetValues:[],expectedPromptRetValues:[],expectBeforeUnload:!1,alerts:[],confirms:[],prompts:[],beforeUnloadDialogAppeared:!1}}function r(){d.emit(o.DIALOGS_INFO_CHANGED_EVENT,{info:_})}function a(e){_.beforeUnloadDialogAppeared=!!e.prevented,f=!0,_.beforeUnloadDialogAppeared&&r(),_.beforeUnloadDialogAppeared&&!_.expectBeforeUnload&&l("beforeUnload",e.returnValue===!0?"":e.returnValue.toString())}function s(t){i(t),e.alert=function(e){_.alerts.push(e),r(),_.alerts.length>_.expectAlertCount&&l("alert",e)},e.confirm=function(e){var t=_.expectedConfirmRetValues[_.confirms.length];return _.confirms.push(e),r(),_.confirms.length>_.expectConfirmCount&&l("confirm",e),t},e.prompt=function(e){var t=_.expectedPromptRetValues[_.prompts.length];return _.prompts.push(e),r(),_.prompts.length>_.expectPromptCount&&l("prompt",e),t}}function l(e,t){/alert|confirm|prompt/.test(e)&&f||d.emit(o.UNEXPECTED_DIALOG_ERROR_EVENT,{dialog:e,message:t})}function c(e){d.emit(o.WAS_NOT_EXPECTED_DIALOG_ERROR_EVENT,{dialog:e})}var E=t.get("Hammerhead"),u=E.Util.EventEmitter;o.UNEXPECTED_DIALOG_ERROR_EVENT="unexpectedDialogError",o.WAS_NOT_EXPECTED_DIALOG_ERROR_EVENT="wasNotExpectedDialogError",o.DIALOGS_INFO_CHANGED_EVENT="dialogsInfoChangedEvent";var _=null,f=!1,d=new u;o.on=function(e,t){d.on(e,t)},o.init=function(e){E.on(E.BEFORE_UNLOAD_EVENT,a),f=!1,s(e)},o.destroy=function(){E.off(E.BEFORE_UNLOAD_EVENT,a)},o.handleAlert=function(){_.expectAlertCount++,r()},o.handleConfirm=function(e){_.expectConfirmCount++,_.expectedConfirmRetValues.push(!(!e||"Cancel"===e)),r()},o.handlePrompt=function(e){_.expectPromptCount++,_.expectedPromptRetValues.push(e||""===e?e:null),r()},o.handleBeforeUnload=function(){_.expectBeforeUnload=!0,r()},o.resetHandlers=function(){s(),r()},o.hasUnexpectedBeforeUnloadDialog=function(){return _&&_.beforeUnloadDialogAppeared&&!_.expectBeforeUnload},o.checkExpectedDialogs=function(){_.expectAlertCount&&_.alerts.length<_.expectAlertCount&&c("alert"),_.expectConfirmCount&&_.confirms.length<_.expectConfirmCount&&c("confirm"),_.expectPromptCount&&_.prompts.length<_.expectPromptCount&&c("prompt"),_.alerts.length>_.expectAlertCount&&l("alert",_.alerts[_.expectAlertCount]),_.confirms.length>_.expectConfirmCount&&l("confirm",_.confirms[_.expectConfirmCount]),_.prompts.length>_.expectPromptCount&&l("prompt",_.prompts[_.expectPromptCount]),_.expectBeforeUnload&&!_.beforeUnloadDialogAppeared&&c("beforeUnload")}}),n.define("TestRunner.APIv2",function(e,t){var n=e("TestRunner.APIv2.Select");t.REPRODUCE_SELECTION_CHAIN_FUNC_KEY=n.REPRODUCE_SELECTION_CHAIN_FUNC_KEY,t.create=function(e){return{select:new n.SelectOperator(e)}}}),n.define("TestRunner.APIv2.Select",function(e,n){function o(e,t){return function(){for(var n=null,o=0;o<t.length;o++){var i=t[o].type,r=t[o].selector,u="function"==typeof r;i===a?n=u?e("*").filter(r):e(r):i===s?n=n.filter(r):i===l?n=u?n.find("*").filter(r):n.find(r):i===c?n=r:i===E&&(n=n.eq(r))}return n}}var i=t.get("Hammerhead"),r=i.Util;n.REPRODUCE_SELECTION_CHAIN_FUNC_KEY="__#TC_REPRODUCE_SELECTION_CHAIN_FUNC_KEY";var a=0,s=1,l=2,c=3,E=4,u=function(e){this.hostOperator=e};u.prototype.id=function(e){return"string"==typeof e?this.hostOperator.$("#"+e):e instanceof RegExp?this.attr("id",e):this.hostOperator.$("")},u.prototype.tag=function(e){return this.hostOperator.$(e)},u.prototype.class=function(e){return this.hostOperator.$("."+e)},u.prototype.text=function(e){var t=e instanceof RegExp;return this.hostOperator.$("string"==typeof e||t?function(){var n=this,o="",i=n.tagName.toLowerCase();if("script"===i||"style"===i)return!1;for(var r=0;r<n.childNodes.length;r++)3===n.childNodes[r].nodeType&&n.childNodes[r].data&&(o+=n.childNodes[r].data);return t?e.test(o):o.indexOf(e)>-1}:"")},u.prototype.attr=function(e,t){return this.hostOperator.$("string"!=typeof e?"":"string"==typeof t?"["+e+"='"+t+"']":t instanceof RegExp?function(){return this.hasAttribute(e)&&t.test(this.getAttribute(e))}:"["+e+"]")},u.prototype.name=function(e){return"string"==typeof e||e instanceof RegExp?this.attr("name",e):this.hostOperator.$("")};var _=function(e,t,n){this.chainTokens=t||[],this.jQuery=e,this.allowCacheForAndOperator=!0,this.$cachedSelection=n};_.prototype._addSelectorToTokenSequence=null,_.prototype.$=function(e){var t=null,i=this.chainTokens.slice(0);this._addSelectorToTokenSequence(e,i);var r=o(this.jQuery,i);return this.$cachedSelection?(i=[{type:c,selector:this.$cachedSelection}],this._addSelectorToTokenSequence(e,i),t=o(this.jQuery,i)()):t=r(),t.in=new T(this.jQuery,i,t),t.and=new S(this.jQuery,i,this.allowCacheForAndOperator&&t),t[n.REPRODUCE_SELECTION_CHAIN_FUNC_KEY]=r,t};var f=function(e,t,n){_.call(this,e,t,n)};r.inherit(f,_),f.prototype.nth=function(e){var t=this.chainTokens.slice(0);t.splice(0,0,{type:E,selector:e});var n=new this.constructor(this.jQuery,t,null);return n.allowCacheForAndOperator=!1,n};var d=n.SelectOperator=function(e){f.call(this,e),this.by=this.with=new u(this)};r.inherit(d,f),d.prototype._addSelectorToTokenSequence=function(e,t){t.splice(0,0,{type:a,selector:e})};var T=function(e,t,n){f.call(this,e,t,n),this.allowCacheForAndOperator=!1,this.with=this.by=new u(this)};r.inherit(T,f),T.prototype._addSelectorToTokenSequence=function(e,t){for(var n=0;n<t.length;n++)if(t[n].type!==E){t[n].type=l;break}t.splice(0,0,{type:a,selector:e})};var S=function(e,t,n){u.call(this,this),_.call(this,e,t,n),this.with=this.by=this};r.inherit(S,_),r.inherit(S,u),S.prototype._addSelectorToTokenSequence=function(e,t){t.splice(1,0,{type:s,selector:e})}}),n.define("TestRunner.IFrameTestRunner",function(n){var o=t.get("Hammerhead"),i=o.Util,r=o.MessageSandbox,a=n("Base.jQueryExtensions.Selectors"),s=n("TestRunner.API.Dialogs"),l=n("TestRunner.TestRunnerBase"),c=n("Settings"),E=this.exports=function(e){l.apply(this,[e])};i.inherit(E,l),E.prototype._initPageLoadBarrier=function(){},E.prototype._prepareStepsExecuting=function(e){a.init(),e()},E.prototype._onTestComplete=function(t){var n={cmd:l.IFRAME_STEP_COMPLETED_CMD};this._onSetStepsSharedData({stepsSharedData:this.testIterator.getSharedData(),callback:function(){r.sendServiceMsg(n,e.top),t.callback()}})},E.prototype._onNextStepStarted=function(t){var n={cmd:l.IFRAME_NEXT_STEP_STARTED_CMD};r.sendServiceMsg(n,e.top),t.callback()},E.prototype._onActionTargetWaitingStarted=function(){r.sendServiceMsg({cmd:l.IFRAME_ACTION_TARGET_WAITING_STARTED_CMD},e.top)},E.prototype._onActionRun=function(){r.sendServiceMsg({cmd:l.IFRAME_ACTION_RUN_CMD},e.top)},E.prototype._onError=function(t){(!c.PLAYBACK||t.dialog)&&this.testIterator.stop();var n={cmd:l.IFRAME_ERROR_CMD,err:t};r.sendServiceMsg(n,e.top)},E.prototype._onAssertionFailed=function(t){var n={cmd:l.IFRAME_FAILED_ASSERTION_CMD,err:t};this.testIterator.state.needScreeshot=!0,r.sendServiceMsg(n,e.top),c.PLAYBACK&&this.testIterator.stop()},E.prototype._onSetStepsSharedData=function(t){var n={cmd:l.IFRAME_SET_SHARED_DATA_CMD,sharedData:t.stepsSharedData};r.sendServiceMsg(n,e.top),t.callback()},E.prototype._onGetStepsSharedData=function(t){function n(e){e.message.cmd===l.IFRAME_GET_SHARED_DATA_RESPONSE_CMD&&(r.off(r.SERVICE_MSG_RECEIVED,n),t.callback(e.message.sharedData))}var o={cmd:l.IFRAME_GET_SHARED_DATA_REQUEST_CMD};r.sendServiceMsg(o,e.top),r.on(r.SERVICE_MSG_RECEIVED,n)},E.prototype._onExpectInactivity=function(t){var n={cmd:l.IFRAME_EXPECT_INACTIVITY_CMD,duration:t.duration};r.sendServiceMsg(n,e.top),t.callback()},E.prototype._onTakeScreenshot=function(t){function n(e){e.message.cmd===l.IFRAME_TAKE_SCREENSHOT_RESPONSE_CMD&&(r.off(r.SERVICE_MSG_RECEIVED,n),t&&t.callback&&t.callback())}var o={cmd:l.IFRAME_TAKE_SCREENSHOT_REQUEST_CMD,isFailedStep:t.isFailedStep};r.sendServiceMsg(o,e.top),r.on(r.SERVICE_MSG_RECEIVED,n)},E.prototype.onStepCompleted=function(){s.checkExpectedDialogs()},E.prototype._onDialogsInfoChanged=function(t){var n={cmd:l.IFRAME_NATIVE_DIALOGS_INFO_CHANGED_CMD,info:t};r.sendServiceMsg(n,e.top)},E.prototype._onBeforeUnload=function(){function t(o){o.message.cmd===l.IFRAME_BEFORE_UNLOAD_RESPONSE_CMD&&(r.off(r.SERVICE_MSG_RECEIVED,t),o.message.res&&(n.testIterator.state.stepDelayTimeout&&(e.clearTimeout(n.testIterator.state.stepDelayTimeout),n.testIterator.state.stepDelayTimeout=null),n.testIterator.state.pageUnloading=!1,n.testIterator._runStep()))}var n=this,o={cmd:l.IFRAME_BEFORE_UNLOAD_REQUEST_CMD};r.on(r.SERVICE_MSG_RECEIVED,t),r.sendServiceMsg(o,e.top)}}),function(){var e="undefined"!=typeof module&&module.exports?exports:n;e.UNCAUGHT_JS_ERROR="CLIENT_UNCAUGHT_JS_ERROR",e.UNCAUGHT_JS_ERROR_IN_TEST_CODE_STEP="CLIENT_UNCAUGHT_JS_ERROR_IN_TEST_CODE_STEP",e.STORE_DOM_NODE_OR_JQUERY_OBJECT="CLIENT_STORE_DOM_NODE_OR_JQUERY_OBJECT",e.TEST_INACTIVITY="CLIENT_TEST_INACTIVITY",e.API_EMPTY_FIRST_ARGUMENT="CLIENT_API_EMPTY_FIRST_ARGUMENT",e.API_INVISIBLE_ACTION_ELEMENT="CLIENT_API_INVISIBLE_ACTION_ELEMENT",e.API_INCORRECT_DRAGGING_SECOND_ARGUMENT="CLIENT_API_INCORRECT_DRAGGING_SECOND_ARGUMENT",e.API_OK_ASSERTION_FAILED="CLIENT_API_OK_ASSERTION_FAILED",e.API_EQUAL_ASSERTION_FAILED="CLIENT_API_EQUAL_ASSERTION_FAILED",e.API_NOT_OK_ASSERTION_FAILED="CLIENT_API_NOT_OK_ASSERTION_FAILED",e.API_NOT_EQUAL_ASSERTION_FAILED="CLIENT_API_NOT_EQUAL_ASSERTION_FAILED",e.API_INCORRECT_PRESS_ACTION_ARGUMENT="CLIENT_API_INCORRECT_PRESS_ACTION_ARGUMENT",e.API_EMPTY_TYPE_ACTION_ARGUMENT="CLIENT_API_EMPTY_TYPE_ACTION_ARGUMENT",e.API_UNEXPECTED_DIALOG="CLIENT_API_UNEXPECTED_DIALOG",e.API_EXPECTED_DIALOG_DOESNT_APPEAR="CLIENT_API_EXPECTED_DIALOG_DOESNT_APPEAR",e.API_INCORRECT_SELECT_ACTION_ARGUMENTS="CLIENT_API_INCORRECT_SELECT_ACTION_ARGUMENTS",e.API_INCORRECT_WAIT_ACTION_MILLISECONDS_ARGUMENT="CLIENT_API_INCORRECT_WAIT_ACTION_FIRST_ARGUMENT",e.API_INCORRECT_WAIT_FOR_ACTION_EVENT_ARGUMENT="CLIENT_API_INCORRECT_WAIT_FOR_ACTION_EVENT_ARGUMENT",e.API_INCORRECT_WAIT_FOR_ACTION_TIMEOUT_ARGUMENT="CLIENT_API_INCORRECT_WAIT_FOR_ACTION_TIMEOUT_ARGUMENT",e.API_WAIT_FOR_ACTION_TIMEOUT_EXCEEDED="CLIENT_API_WAIT_FOR_ACTION_TIMEOUT_EXCEEDED",e.API_EMPTY_IFRAME_ARGUMENT="CLIENT_API_EMPTY_IFRAME_ARGUMENT",e.API_IFRAME_ARGUMENT_IS_NOT_IFRAME="CLIENT_API_IFRAME_ARGUMENT_IS_NOT_IFRAME",e.API_MULTIPLE_IFRAME_ARGUMENT="CLIENT_API_MULTIPLE_IFRAME_ARGUMENT",e.API_INCORRECT_IFRAME_ARGUMENT="CLIENT_API_INCORRECT_IFRAME_ARGUMENT",e.API_UPLOAD_CAN_NOT_FIND_FILE_TO_UPLOAD="CLIENT_API_UPLOAD_CAN_NOT_FIND_FILE_TO_UPLOAD",e.API_UPLOAD_ELEMENT_IS_NOT_FILE_INPUT="CLIENT_API_UPLOAD_ELEMENT_IS_NOT_FILE_INPUT",e.API_UPLOAD_INVALID_FILE_PATH_ARGUMENT="CLIENT_API_UPLOAD_INVALID_FILE_PATH_ARGUMENT",e.IFRAME_LOADING_TIMEOUT="CLIENT_IFRAME_LOADING_TIMEOUT",e.IN_IFRAME_TARGET_LOADING_TIMEOUT="CLIENT_IN_IFRAME_TARGET_LOADING_TIMEOUT",e.XHR_REQUEST_TIMEOUT="CLIENT_XHR_REQUEST_TIMEOUT",e.hasErrorStepName=function(t){return t.code!==e.UNCAUGHT_JS_ERROR&&t.code!==e.XHR_REQUEST_TIMEOUT&&t.code!==e.IFRAME_LOADING_TIMEOUT&&t.code!==e.TEST_INACTIVITY},"undefined"!=typeof module&&module.exports?module.exports=e:n.define("Shared.Errors",function(){this.exports=e})}(),function(){var e={};e.IFRAME_WATCH_PROPERTY="tc_iwp_cf65bc15",e.OLD_ATTR_VALUES="tc-1b082-oldAttrValues",e.UPLOADED_FILES_PATH="./uploads/",e.PROPERTY_PREFIX="tc-1b082a6cec-51966-",e.ACTION_FUNC_NAMES=["click","rclick","dblclick","drag","type","wait","waitFor","hover","press","select","navigateTo","upload","screenshot"],e.ASSERTION_FUNC_NAMES=["ok","notOk","eq","notEq"],"undefined"!=typeof module&&module.exports?module.exports=e:n.define("Shared.Const",function(){this.exports=e})}(),function(){var e={TEST_FAIL:"CMD_TEST_FAIL",ASSERTION_FAILED:"CMD_ASSERTION_FAILED",TEST_COMPLETE:"CMD_TEST_COMPLETE",INACTIVITY_EXPECTED:"CMD_INACTIVITY_EXPECTED",SET_STEPS_SHARED_DATA:"CMD_SET_STEPS_SHARED_DATA",GET_STEPS_SHARED_DATA:"CMD_GET_STEPS_SHARED_DATA",STEPS_INFO_GET:"CMD_STEPS_INFO_GET",STEPS_INFO_SET:"CMD_STEPS_INFO_SET",WERE_ACTIONS_RECORDED:"CMD_WERE_ACTIONS_RECORDED",SET_NEXT_STEP:"CMD_SET_NEXT_STEP",SET_ACTION_TARGET_WAITING:"CMD_SET_ACTION_TARGET_WAITING",SET_TEST_ERROR:"CMD_SET_TEST_ERROR",TOOLBAR_POSITION_SET:"CMD_TOOLBAR_POSITION_SET",CHANGE_SHOW_STEPS:"CMD_CHANGE_SHOW_STEPS",SET_HAS_UNSAVED_CHANGES:"CMD_SET_HAS_UNSAVED_CHANGES",RESTART_RECORDING:"CMD_RESTART_RECORDING",GET_AND_UNCHECK_FILE_DOWNLOADING_FLAG:"GET_AND_UNCHECK_FILE_DOWNLOADING_FLAG",UNCHECK_FILE_DOWNLOADING_FLAG:"CMD_UNCHECK_FILE_DOWNLOADING_FLAG",SAVE_TEST:"CMD_SAVE_TEST",EXIT_RECORDING:"CMD_EXIT_RECORDING",START_PLAYBACK:"CMD_START_PLAYBACK",CANCEL_AUTHENTICATION:"CMD_CANCEL_AUTHENTICATION",FAILED_STEP_IN_PLAYBACK:"CMD_FAILED_STEP_IN_PLAYBACK",END_PLAYBACK:"CMD_END_PLAYBACK",SET_NEXT_STEP_PLAYBACK:"CMD_SET_NEXT_STEP_PLAYBACK",SET_ACTION_TARGET_WAITING_PLAYBACK:"CMD_SET_ACTION_TARGET_WAITING_PLAYBACK",AUTH_CREDENTIALS_SET:"CMD_AUTH_CREDENTIALS_SET",UXLOG:"CMD_UXLOG",TAKE_SCREENSHOT:"CMD_TAKE_SCREENSHOT",NATIVE_DIALOGS_INFO_SET:"CMD_NATIVE_DIALOGS_INFO_SET",SET_NATIVE_DIALOGS_QUEUE:"CMD_SET_NATIVE_DIALOGS_QUEUE"};"undefined"!=typeof module&&module.exports?module.exports=e:n.define("Shared.ServiceCommands",function(){this.exports=e})}()},window.initTestCafeClientCore(window)}();