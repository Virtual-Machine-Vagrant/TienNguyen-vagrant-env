!function(){window.initTestCafeRecorder=function(e){var t=e.HammerheadClient,n=e.TestCafeClient,r=e.document;n.define("Recorder.ElementPicker",function(n,i){function o(e){var t=e.target;return x&&x[0]&&e.target===x[0]&&(x.css("visibility","hidden"),t=T.getElementFromPoint(e.clientX,e.clientY,null,!0),x.css("visibility","visible")),t}function s(e,t){var n={clientX:e.clientX,clientY:e.clientY,which:T.isWebKit?T.WHICH_PARAMETER.NO_BUTTON:1,buttons:T.BUTTONS_PARAMETER.NO_BUTTON},r=!0;try{r=t!==V}catch(e){V=null,r=!0}r&&V&&R.mouseout(V,A.extend({relatedTarget:t},n));var i=T.hasTouchEvents?"touchmove":"mousemove";T.isIE&&t&&R[i](t,n),r&&(t&&R.mouseover(t,A.extend({relatedTarget:V},n)),V=t),!T.isIE&&t&&R[i](t,n)}function a(e,t){var n=T.getOffsetPosition(e);return{x:t.x>n.left?t.x-n.left:0,y:t.y>n.top?t.y-n.top:0}}function l(t,n,a){var l=o(t),c=x&&x[0]&&t.target===x[0];if(l&&!T.isShadowUIElement(l)){var u=T.getElementRectangleForMarking(l,B,B);if(z){var d=T.getElementScroll(A(r));u.top-=d.top,u.left-=d.left,y.sendServiceMsg({cmd:Y,rect:u},e.top)}else if(!l.tagName||"iframe"!==l.tagName.toLowerCase()||J&&J!==l.contentWindow)J||(c&&s(t,l),g(u),D.emit(i.ELEMENT_HOVERED_EVENT,{element:l}));else{c&&s(t,l);var f=T.getFixedPositionForIFrame({x:t.pageX,y:t.pageY},l.contentWindow);T.isIE&&x&&x[0]&&x.css("visibility","hidden"),y.sendServiceMsg({cmd:W,point:f,needEmulate:c,clientX:t.clientX,clientY:t.clientY},l.contentWindow)}c&&a()}}function c(t,n,r){var i=o(t);if(i&&!T.isShadowUIElement(i)){var s={ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey};if(z||!i.tagName||"iframe"!==i.tagName.toLowerCase()||J&&J!==i.contentWindow){var l=a(i,T.getEventAbsoluteCoordinates(t));s.offsetX=l.x,s.offsetY=l.y,z?(T.isIE||C.addInternalEventListener(e,["mouseover"],p),y.sendServiceMsg({cmd:j,elementSelectors:M.generate(A(i)),options:s},e.top)):J||(m(),C.addInternalEventListener(e,["mouseover"],p),K(M.generate(A(i)),null,s))}else y.sendServiceMsg({cmd:X,point:T.getFixedPositionForIFrame({x:t.pageX,y:t.pageY},i.contentWindow),iFrameSelectors:M.generate(A(i)),options:s},i.contentWindow);r()}}function u(t,n,r){t.keyCode===T.KEYS_MAPS.SPECIAL_KEYS.esc&&(m(),V&&"iframe"===V.tagName.toLowerCase()?I.bind(A(V.contentWindow),"mouseover",p):C.addInternalEventListener(e,["mouseover"],p),K(null),r())}function d(e,t,n){T.isShadowUIElement(e.target)||n()}function f(e,t,n){x&&e.target===x[0]?(R.mouseout(V,A.extend({relatedTarget:e.relatedTarget},{clientX:e.clientX,clientY:e.clientY,buttons:T.BUTTONS_PARAMETER.NO_BUTTON,which:T.isWebKit?T.WHICH_PARAMETER.NO_BUTTON:1})),n()):!T.isShadowUIElement(e.target)&&e.target===V&&x&&e.relatedTarget===x[0]&&n()}function E(e,t,n){t||x&&e.target===x[0]||T.isShadowUIElement(e.target)||(V=e.target);var r=o(e);T.isIE&&V===r||T.storeElementAttributes(O.OLD_ATTR_VALUES,r),x&&e.target===x[0]&&n()}function p(t,n,r){!n&&V&&r(),C.removeInternalEventListener(e,["mouseover"],p)}function g(e,t){if(G){var n=T.getDocumentElementHeight()<e.top+e.height?T.getDocumentElementHeight()-e.top:e.height,r=T.getDocumentElementWidth()<e.left+e.width?T.getDocumentElementWidth()-e.left:e.width,i=I.select("."+N);T.isIE&&t?(x&&x[0]&&x.css("visibility","hidden"),L&&L.length||(L=A("<div></div>").appendTo(k),I.addClass(L,N)),L.css({top:e.top,left:e.left,width:r,height:B}),w&&w.length||(w=A("<div></div>").appendTo(k),I.addClass(w,N)),w.css({top:e.top+n-B,left:e.left,width:r,height:B}),U&&U.length||(U=A("<div></div>").appendTo(k),I.addClass(U,N)),U.css({top:e.top+B,left:e.left,width:B,height:n-B}),F&&F.length||(F=A("<div></div>").appendTo(k),I.addClass(F,N)),F.css({top:e.top+B,left:e.left+r-B,width:B,height:n-B}),i.css("visibility","visible"),i.bind("mousedown",function(e){T.preventDefault(e)})):(i&&i.length&&i.css("visibility","hidden"),x&&x[0]||(x=A("<div></div>").appendTo(k),I.addClass(x,P),x.bind("mousedown",function(e){T.preventDefault(e)})),x.css({top:e.top,left:e.left,width:r,height:n,visibility:"visible"}))}}function m(){x&&x[0]&&x.remove(),x=null,I.select("."+N).remove(),L=null,w=null,U=null,F=null,H&&H[0]&&H.remove(),H=null}function h(){var e=A(r).find("head");H=A("<style>*{cursor: crosshair !important;}</style>").appendTo(e[0])}function _(e){C.addInternalEventListener(e,["mousemove"],l),C.addInternalEventListener(e,["mouseout"],f),C.addInternalEventListener(e,["mouseover"],E),C.addInternalEventListener(e,["click"],c),C.addInternalEventListener(e,["keydown"],u),C.addInternalEventListener(e,["mousedown","mouseup"],d),T.isIE&&h()}function S(e){C.removeInternalEventListener(e,["mousemove"],l),C.removeInternalEventListener(e,["mouseout"],f),C.removeInternalEventListener(e,["mouseover"],E),C.removeInternalEventListener(e,["click"],c),C.removeInternalEventListener(e,["keydown"],u),C.removeInternalEventListener(e,["mousedown","mouseup"],d)}var v=t.get("Hammerhead"),A=v.$,T=v.Util,C=v.EventSandbox,R=v.EventSimulator,I=v.ShadowUI,y=v.MessageSandbox,D=new T.EventEmitter,b=n("Recorder.Util"),M=n("Recorder.SelectorGenerator"),O=n("Shared.Const"),P=b.ELEMENT_PICKING_CLASSES.elementFrame,N=b.ELEMENT_PICKING_CLASSES.elementFramePart,k=null,x=null,L=null,w=null,U=null,F=null,H=null,V=null,G=!1,K=null,B=2,Y="iFrameElementHovered",W="getElementRectangleRequest",$="getElementRectangleResponse",X="setPreventMouseOverHandlerRequest",Q="setPreventMouseOverHandlerResponse",q="iFrameElementPickedRequest",j="iFrameElementPickedResponse",z=e.top!==e.self;i.ELEMENT_HOVERED_EVENT="elementHovered",i.on=function(){return D.on.apply(D,arguments)},i.off=function(){return D.off.apply(D,arguments)};var J=!1;i.start=function(t,n){G=!0,K=t,J=n,_(e)},i.stop=function(){G=!1,K=null,m(),S(e)},i.setRecorderUI=function(e){k=e},y.on(y.SERVICE_MSG_RECEIVED,function(t){var n=t.message,i=null,o=null,l=null;switch(n.cmd){case W:if(i=T.getElementFromPoint(n.point.x,n.point.y)){o=T.getElementRectangleForMarking(i,B,B);var c=T.getElementScroll(A(r));o.top-=c.top,o.left-=c.left,n.needEmulate&&s({clientX:n.clientX,clientY:n.clientY},i)}y.sendServiceMsg({cmd:$,rect:o},e.top);break;case q:if(i=T.getElementFromPoint(n.point.x,n.point.y)){var u=a(i,n.point);n.options.offsetX=u.x,n.options.offsetY=u.y,K(M.generate(A(i)),n.iFrameSelectors,n.options)}else K(n.iFrameSelectors,n.options);break;case X:C.addInternalEventListener(e,["mouseover"],p),y.sendServiceMsg({cmd:Q,point:n.point,iFrameSelectors:n.iFrameSelectors,options:n.options},e.top);break;case $:o=t.message.rect,o?(l=T.getFixedPosition({x:o.left,y:o.top},t.source),o.left=l.x,o.top=l.y):(i=T.getIFrameByWindow(t.source),o=T.getElementRectangleForMarking(i,B,B)),g(o,!0);break;case Q:m(),y.sendServiceMsg({cmd:q,point:n.point,iFrameSelectors:n.iFrameSelectors,options:n.options},t.source);break;case Y:o=t.message.rect,l=T.getFixedPosition({x:o.left,y:o.top},t.source),o.left=l.x,o.top=l.y,g(o,!0);break;case j:var d=T.getIFrameByWindow(t.source);K(n.elementSelectors,M.generate(A(d)),n.options)}})}),n.define("Recorder.EventListener",function(n,i){function o(e){return h=e,_=g.parseEvent(e),_||S}function s(e,t){if(!t&&m){try{if(h===e)return _||S?(E.preventDefault(e),!1):void 0}catch(n){h=null}return o(e)?(E.preventDefault(e),!1):(_=!1,S?(E.preventDefault(e),!1):void 0)}}function a(e,t,n,r){E.isShadowUIElement(e.target||e.srcElement)&&r()}function l(e,t,n){!E.isShadowUIElement(e.target||e.srcElement)&&m&&s.call(this,e,t)===!1&&n()}function c(){p.addInternalEventListener(e,E.DOM_EVENTS,a),p.addInternalEventListener(e,E.RECORDING_LISTENED_EVENTS,l)}function u(e){p.addInternalEventListener(e,E.DOM_EVENTS,a)}function d(e){e.document&&(p.initElementListening(e.document,E.RECORDING_LISTENED_EVENTS),u(e.document))}var f=t.get("Hammerhead"),E=f.Util,p=f.EventSandbox,g=n("Recorder.EventParser"),m=!1,h=null,_=!1,S=!1,v=null;f.on(f.DOM_DOCUMENT_CLEARED,d),i.start=function(e,t){c(),u(r),m=!0,v=function(t){e(t)},g.init(v,t)},i.stop=function(){m=!1,g.destroy()},i.pause=function(){m=!1,g.resetParsing()},i.resume=function(){m=!0},i.reset=function(){g.destroy(!0),g.init(v)},i.createAllDeferred=function(){g.createAllDeferred()},i.setPreventingMode=function(e){S=e},i.checkActionsBeforeAdditionNativeDialogHandler=function(){g.checkActionsBeforeAdditionNativeDialogHandler()}}),n.define("Recorder.EventParser",function(n,i){function o(e,t){var n=l.getEventPageCoordinates(e),r=/MSPointer(Down|Move|Up)/.test(e.type),i=r?e.type.replace("MSPointer",""):"";return{target:t,type:r?"pointer"+i.toLowerCase():e.type,ctrlKey:e.ctrlKey,altKey:e.altKey,shiftKey:e.shiftKey,metaKey:e.metaKey,pageX:n.x,pageY:n.y}}var s=t.get("Hammerhead"),a=s.$,l=s.Util,c=s.EventSandbox,u=n("Shared.Const"),d=s.TextSelection,f=s.ContentEditableHelper,E=n("Recorder.SelectorGenerator"),p=s.PageState,g=n("Recorder.KeyEventParser"),m=n("Automation"),h=500,_=function(){function t(t){s[t].timeoutId&&(e.clearTimeout(s[t].timeoutId),s[t].timeoutId=null),s[t].isWaitingDblClick=!1,s[t].actionCreator=null,s[t].element=null,s[t].actionDescriptor=null}function n(){s=[]}function r(e,t,n,r){return{type:e,actionCreator:t,element:n,elementParent:l.isContentEditableElement(n)?f.findContentEditableParent(n):null,actionDescriptor:r,index:s.length}}function i(e){var n=s[e];n.actionCreator&&n.actionCreator.call(),"type"===n.type?U.resetTyping():w.resetLastElementSelectors(),t(e)}function o(){a.each(s,function(e){i(e)}),n()}var s=[];return{init:function(){s=[]},push:function(n,i,a,c){var u=r(n,i,a,c),d=s[u.index-1];if("click"===n){if(d&&d.actionCreator){if(d.isWaitingDblClick&&d.element===a)return void t(u.index-1);o()}u.isWaitingDblClick=!0,u.timeoutId=e.setTimeout(function(){u.isWaitingDblClick=!1,u.timeoutId=null,l.isEditableElement(u.element)||o()},h)}else d&&d.actionCreator&&(d.element===a||l.isContentEditableElement(a)&&d.elementParent===a?t(u.index-1):o());s.push(u)},removeAll:n,createAll:o,getLastActionType:function(){return s.length?s[s.length-1].type:""},getLastActionDescriptor:function(){return s.length?s[s.length-1].actionDescriptor:null},isWaitingDblClick:function(){return s.length?s[s.length-1].isWaitingDblClick:!1}}}(),S=null,v=null,A=null,T=null,C=null,R=!1,I=!1,y="",D=null,b=null,M=null,O=null,P=!1,N=!1,k=!1,x=!1,L=null,w=function(){function t(e){var t="",n=e;for(t in g)g.hasOwnProperty(t)&&(n=n.replace(new RegExp("\\b"+t+"\\b","g"),g[t]));return new RegExp(n)}function n(t,n,r,i){var o=r.element||t.target,s=l.isTextEditableElement(o),c=r.offset,u=r.selectors,p=r.startPosition,g=null,h=null,_=null,S=n?n:t.type,v=null,T=null,C=null,R=null,I=null,D="drag"===n,b=null;if(A.lastActionType=S,D){if(v="touchend"===t.type||l.isIE&&e.navigator.msMaxTouchPoints>0?A.lastPressedElement:A.startDragElement||o,l.isEditableElement(v)&&"touchend"!==t.type)b=a.extend(!0,{},m.defaultSelectActionDescriptor),l.isContentEditableElement(v)&&!d.hasElementContainsSelection(v)&&(v=f.getElementBySelection(d.getSelectionByElement(v))),S="select",y="select",T=d.hasInverseSelection(v),C=d.getSelectionStart(v),R=d.getSelectionEnd(v),b.apiArguments.startPos=T?R:C,b.apiArguments.endPos=T?C:R;else{if(b=a.extend(!0,{},m.defaultDragActionDescriptor),I=l.getEventAbsoluteCoordinates(t),l.isElementInIframe(o)){var P=l.getIFrameByElement(o);if(P){var N=l.getOffsetPosition(P),k=l.getBordersWidth(a(P)),x=l.getEventPageCoordinates(t);b.apiArguments.dragOffsetX=x.x-(p.x-N.left-k.left),b.apiArguments.dragOffsetY=x.y-(p.y-N.top-k.top)}}else b.apiArguments.dragOffsetX=I.x-p.x,b.apiArguments.dragOffsetY=I.y-p.y;I=l.getEventAbsoluteCoordinates(t),b.startPosition=r.startPosition,b.endPosition=I}g=E.generate(a(v)),A.startDragElement=null}else b=a.extend(!0,{},m.defaultMouseActionDescriptor,{type:S}),g=u||E.generate(a(o));return c&&/click|drag/.test(S)&&(b.apiArguments.options.offsetX=c.x,b.apiArguments.options.offsetY=c.y,b.serviceInfo.useOffsets=D),O=M,/click|drag/.test(S)&&(b.apiArguments.options.ctrl=t.ctrlKey,b.apiArguments.options.alt=t.altKey,b.apiArguments.options.shift=t.shiftKey,b.apiArguments.options.meta=t.metaKey),!s&&!l.isContentEditableElement(o)||/drag|select/.test(S)||(h=d.getSelectionStart(o),_=s?o.value.length:f.getContentEditableValue(o).length,b.apiArguments.options.caretPos=h===_?"":h),a.extend(!0,{},b,{element:v||o,selector:g[0].selector,serviceInfo:{selectors:g,prevPageState:M,isDeferred:i}})}function r(e,t){function n(){(u===h.MOUSEMOVE_POINTERMOVE||u===h.POINTERMOVE_MOUSEMOVE)&&(c=Math.floor(c/2)),c>0&&2>=c?o.push(g.shortmove):c>2&&6>=c?o.push(g.mediummove):c>6&&o.push(g.longmove),c=0,u=h.NONE}var r=R.getState().join(",");if("drag"===A.lastActionType&&(r===g.click+""||r===g.mouseup+""))return void R.clear();for(var i=R.getState(),o=[],s="",l="",c=0,u=h.NONE,d=0;d<i.length;d++)switch(l=i[d]){case g.mousemove:case g.touchmove:u===h.NONE?u=h.MOUSEMOVE:u===h.POINTERMOVE&&(u=h.POINTERMOVE_MOUSEMOVE),c++;break;case g.pointermove:u===h.NONE?u=h.POINTERMOVE:u===h.MOUSEMOVE&&(u=h.MOUSEMOVE_POINTERMOVE),c++;break;default:u!==h.NONE&&n(),o.push(l)}u!==h.NONE&&n(),s=o.join(","),a.each(I,function(n,r){return r.test(s)?(D[n](e,t),!1):void 0})}function i(){A.mousePressed=!1,A.lastActionType="",A.lastHoveredElement=null,A.lastHoveredElementSelectors=null,A.startDragElement=null,A.lastPressedElement=null,A.lastMouseDownOffset=null,A.lastMouseDownPosition=null,A.lastMouseDownButton=null,A.clickEditorStateChangedTimeoutId=null}function s(t,r,i){var o="click"===t.type&&l.isEditableElement(t.target),s=n(t,r,{element:A.lastPressedElement,offset:A.lastMouseDownOffset,selectors:A.lastHoveredElementSelectors,startPosition:A.lastMouseDownPosition},o);if(i){var a=function(){o&&"function"==typeof C&&C.call(this,!1),S(s)};o&&"function"==typeof C&&(A.clickEditorStateChangedTimeoutId=e.setTimeout(function(){C.call(this,!0,function(){_.createAll()})},0)),_.push("click",a,A.lastPressedElement,s)}else"dblclick"===t.type&&l.isEditableElement(t.target)&&"function"==typeof C&&(A.clickEditorStateChangedTimeoutId&&(e.clearTimeout(A.clickEditorStateChangedTimeoutId),A.clickEditorStateChangedTimeoutId=null),C.call(this,!1)),_.createAll(),S(s);R.clear()}function c(e,t){s(e,t,!0)}var g={others:0,mousedown:1,pointerdown:1,touchstart:1,mouseup:2,pointerup:2,touchend:2,mousemove:"m",pointermove:"p",click:3,dblclick:4,contextmenu:5,touchmove:6,shortmove:7,mediummove:8,longmove:9},h={NONE:0,MOUSEMOVE:1,POINTERMOVE:2,MOUSEMOVE_POINTERMOVE:3,POINTERMOVE_MOUSEMOVE:4},v=["click","dblclick","contextmenu","mouseup","touchend","pointerup"],A={mousePressed:!1,lastActionType:"",lastHoveredElement:null,lastHoveredElementSelectors:null,startDragElement:null,lastPressedElement:null,lastMouseDownOffset:null,lastMouseDownPosition:null,lastMouseDownButton:null,clickEditorStateChangedTimeoutId:null},T=t("mousedown(,mouseup)?$"),R=function(){var e=[],t="";return{add:function(n){var r=n.type;if("mousedown"===r||"pointerdown"===r||"touchstart"===r){if(r="mousedown","mousedown"===t)return}else if(("mouseup"===r||"pointerup"===r||"touchend"===r)&&(r="mouseup","mouseup"===t))return;e.push(g[r]||g.others),t=r},clear:function(){e=[],t=""},getState:function(){return e}}}(),I={preclick:t("mousedown,(shortmove,|mediummove,)?mouseup$"),click:t("mousedown,(shortmove,|mediummove,)?mouseup,click$"),dblclick:t("(mousedown,)?(shortmove,)?(mouseup,)?(click,)?dblclick$"),rclick:t("mousedown,(shortmove,)?(mouseup),contextmenu$"),drag:t("mousedown,longmove,mouseup(,click)?$")},D={preclick:function(e){e.target!==A.lastPressedElement&&(e.type="click",D.click(e,!0))},click:function(e,t){y="click",c(e),t&&_.createAll(),R.clear()},dblclick:function(e){y="dblclick",s(e)},rclick:function(e){y="rclick",s(e,"rclick")},drag:function(e){y="drag",s(e,"drag")}},b=function(){function t(){n=e.innerHeight,r=e.innerWidth,i=s.scrollTop(),o=s.scrollLeft()}var n=null,r=null,i=null,o=null,s=a(e);return{save:t,check:function(){var a=e.innerHeight!==n||e.innerWidth!==r||s.scrollLeft()!==o||s.scrollTop()!==i;return t(),a}}}(),P=function(){t("^mousedown(,mouseup)?$").test(R.getState().join(","))&&S(n({},"click",{element:A.lastPressedElement}))};return{init:function(){},destroy:function(e){e?_.removeAll():(_.createAll(),P()),R.clear(),i()},parse:function(e){if(e.button!==l.BUTTON.MIDDLE){var t=e.target||e.srcElement,n=null,i=null,s=null;if(!(l.isMozilla&&"click"===e.type&&e.button===l.BUTTON.RIGHT||/mousemove|touchmove|pointmove|MSPointerMove/.test(e.type)&&!A.mousePressed||/mouseout|pointerout|MSPointerOut/.test(e.type))){if(l.isSafari&&"click"===e.type&&l.isSelectElement(t)&&L&&t===L)return S(w.createMouseActionDescriptor({},"click",{element:L,selectors:A.lastHoveredElementSelectors})),S(w.createMouseActionDescriptor({},"click",{element:a(L).find("option")[L.selectedIndex]})),L=null,void R.clear();if(/pointerdown|MSPointerDown/.test(e.type)||(!l.isIE||9===l.browserVersion)&&/mousedown|touchstart/.test(e.type)||l.isIE&&"click"===e.type&&"option"===e.target.tagName.toLowerCase()){A.lastPressedElement=e.target||e.srcElement,A.lastMouseDownButton=e.button,A.lastHoveredElementSelectors=E.generate(A.lastPressedElement===A.lastHoveredElement?a(A.lastHoveredElement):a(A.lastPressedElement));var c=e.target||e.srcElement,d=l.getOffsetPosition(c);if(A.lastMouseDownPosition=l.getEventAbsoluteCoordinates(e),l.isWebKit&&"option"===c.tagName.toLowerCase()){var f=l.getSelectParent(a(c));f?(n=a(f),i=l.getOffsetPosition(n[0]),s=l.getChildVisibleIndex(n,c),d.left=i.left,d.top=i.top+s*l.getOptionHeight(n)):(d.left=0,d.top=0)}if((/pointerdown|MSPointerDown/.test(e.type)||(!l.isIE||9===l.browserVersion)&&/mousedown|touchstart/.test(e.type))&&(l.isSelectElement(e.target)?p.addAffectedElement(M,e.target):"option"===e.target.tagName.toLowerCase()&&l.getSelectParent(a(e.target))&&p.addAffectedElement(M,l.getSelectParent(a(e.target)))),A.lastMouseDownOffset={x:A.lastMouseDownPosition.x>d.left?A.lastMouseDownPosition.x-d.left:0,y:A.lastMouseDownPosition.y>d.top?A.lastMouseDownPosition.y-d.top:0},l.isElementInIframe(c)){var g=l.getIFrameByElement(c);g&&(A.lastMouseDownOffset.x-=a(g.contentWindow).scrollLeft(),A.lastMouseDownOffset.y-=a(g.contentWindow).scrollTop())}if(l.isMozilla||l.isIE&&l.isSelectElement(c)&&l.getSelectSizeValue(a(c))>1){var m=l.getClientDimensions(c);if(l.hasScroll(c)){if(c.scrollWidth>c.clientWidth&&A.lastMouseDownOffset.y>=m.height-m.border.bottom-l.getScrollbarSize())return;if(c.scrollHeight>c.clientHeight&&A.lastMouseDownOffset.x>=m.width-m.border.right-l.getScrollbarSize())return}else if(l.isMozilla&&l.isSelectElement(c)&&l.getSelectVisibleChildren(a(c)).length>l.MAX_OPTION_LIST_LENGTH&&A.lastMouseDownOffset.y>m.height+m.border.top+m.border.bottom&&A.lastMouseDownOffset.x>=m.width-m.border.right-l.getScrollbarSize())return}(e.button===l.BUTTON.LEFT||l.hasTouchEvents)&&(A.mousePressed=!0)}if(/touchstart/.test(e.type)&&b.save(),/touchend/.test(e.type)&&b.check())return void R.clear();if(/mouseup|touchend|pointerup|MSPointerUp/.test(e.type)&&(e.button===l.BUTTON.LEFT||l.hasTouchEvents)){if(!A.mousePressed)return;A.mousePressed=!1}if(l.isIE&&l.isSelectElement(t)&&l.getSelectSizeValue(a(t))>1&&"click"===e.type){n=a(t),i=l.getOffsetPosition(n[0]);var h=l.getSelectVisibleChildren(n),T=l.getEventAbsoluteCoordinates(e),C=l.getBordersWidth(n),I=l.getOptionHeight(n);T.x=T.x-i.left-C.left+n.scrollLeft(),T.y=T.y-i.top-C.top+n.scrollTop(),s=Math.floor(T.y/I),t=h[s];var y=s*I;A.lastPressedElement=t,A.lastHoveredElementSelectors=E.generate(a(t)),A.lastMouseDownOffset.x=T.x>0?T.x:0,A.lastMouseDownOffset.y=T.y>y?T.y-y:0}var D=o(e,t);if("dblclick"===D.type&&_.removeAll(),!/pointerover|MSPointerOver/.test(D.type)&&(l.isIE&&9!==l.browserVersion||"mouseover"!==D.type)){if("mouseover"!==D.type&&R.add(D),a.inArray(D.type,v)>-1){var O="click"===D.type&&D.target.tagName&&"a"===D.target.tagName.toLocaleLowerCase()&&D.target.href;r(D,O)}}else if(A.lastHoveredElement=D.target,l.storeElementAttributes(u.OLD_ATTR_VALUES,A.lastHoveredElement),!A.mousePressed){if(l.isIE&&"iframe"===A.lastHoveredElement.tagName.toLowerCase()&&A.startDragElement&&l.getIFrameByElement(A.startDragElement)===A.lastHoveredElement)return;A.startDragElement=A.lastHoveredElement}}}},resetLastElementSelectors:function(){A.lastHoveredElementSelectors=null},createMouseActionDescriptor:n,checkActionsBeforeAdditionNativeDialogHandler:function(){T.test(R.getState().join(","))&&(S(n({},A.lastMouseDownButton===l.BUTTON.RIGHT?"rclick":"click",{element:A.lastPressedElement})),R.clear())}}}(),U=function(){function t(e){var t=e.replace(/^\+/g,"plus").replace(/\+\+/g,"+plus").split("+");a.map(t,function(e,n){t[n]=e.replace("plus","+")});for(var n=0;n<t.length;n++)if(t[n].length>1&&"shift"!==t[n]&&"space"!==t[n])return!1;return!0}function n(){I.typedSymbols=[],I.inTyping=!1,I.currentElement=null,I.currentElementSelectors=null,I.initialElementValue=null,I.lastEventType=null}function r(e){var t=a.extend(!0,{},m.defaultPressActionDescriptor,{apiArguments:{keysCommand:e}});y="press",_.createAll(),t.serviceInfo.prevPageState=M,O=M,S(t)}function i(e){var t=null,n=null,r=a.extend(!0,{},m.defaultTypeActionDescriptor,{element:e}),i=P&&!N,o=i||!(("click"===b||"type"===b)&&e===D);o&&(O=M);var s=o?M:O;I.inTyping&&I.isFirstTypeSymbol&&p.addAffectedElement(s,e),r.apiArguments.text=I.typedSymbols.join(""),r.serviceInfo.prevPageState=s;var c=_.getLastActionDescriptor();if(c){var u=c.apiArguments.options;u&&(r.apiArguments.options=u),r.element=c.element}else t=d.getSelectionStart(e),n=l.isTextEditableElement(e)?e.value.length:f.getContentEditableValue(e).length,r.apiArguments.options.caretPos=t===n?"":t;return r.serviceInfo.selectors=c?c.serviceInfo.selectors:E.generate(a(I.lastHoveredElement)),r.selector=r.serviceInfo.selectors[0].selector,r}function o(t,n){y="type";var r=i(t),o=!1,s=!1;if(n){var a=function(){s=!0,I.initialElementValue=null,"function"==typeof T&&(o?T.call(this,!1):T.call(this,!0)),S(r),P=!0};"function"==typeof T&&e.setTimeout(function(){s?T.call(this,!1):(o=!0,T.call(this,!0,function(){_.createAll()}))},0),_.push("type",a,t,r)}else _.createAll()}function s(e,t){I.createOnKeyPress||(l.isEditableElement(t)?(I.isFirstTypeSymbol=!I.inTyping,I.inTyping=!0,I.typedSymbols.push(String.fromCharCode(e)),I.currentElement=t,o(t,!0)):(I.inTyping=!1,I.isFirstTypeSymbol=!1))}function h(e,n){!n&&I.inTyping&&t(e)||(I.typedSymbols.length&&o(I.currentElement),"ctrl"!==e&&"shift"!==e&&r(e.replace(/\n/g,"enter")))}var C=null,I={typedSymbols:[],inTyping:!1,isFirstTypedSymbol:!1,currentElement:null,currentElementSelectors:null,initialElementValue:null,lastHoveredElement:null,lastEventType:null};return{init:function(){var e={symbolPressed:s,keysPressed:h,shortcutHandlers:{}},t=function(e){return{start:function(){R=!0,"function"==typeof v[e].start?v[e].start():"function"==typeof v[e]&&v[e]()},end:function(){R=!0,"function"==typeof v[e].end&&v[e].end()},multiple:!1}};for(var n in v)v.hasOwnProperty(n)&&(e.shortcutHandlers[n.toLowerCase()]=t(n));var r=[],i=function(){return{start:function(e){R=!1,r.push(e)},end:function(){r&&r.length&&h(r.join(" "),!0),r=[],R=!1}}};if(A)for(var o=0;o<A.length;o++)e.shortcutHandlers[A[o].toLowerCase()]=i();C=new g,C.init(e)},destroy:function(e){C&&(e||(I.typedSymbols.length&&o(I.currentElement),C.inTyping||C.suspend||!C.currentKeysCombination||h(C.currentKeysCombination,!0)),C.clear(),n())},clearState:function(){C.clearState()},parse:function(e){var t=e.target||e.srcElement;I.inTyping||"keydown"!==e.type?l.isSelectElement(t)&&"change"===e.type&&l.isWebKit&&1===l.getSelectSizeValue(a(t))&&(_.createAll(),l.isSafari?L=t:S(w.createMouseActionDescriptor({},"click",{element:a(t).find("option")[t.selectedIndex]}))):(I.lastHoveredElement=t,l.storeElementAttributes(u.OLD_ATTR_VALUES,I.lastHoveredElement),l.isMozilla&&l.isSelectElement(t)&&p.addAffectedElement(M,t)),c.watchElementEditing(t),I.lastEventType=e.type,C.pushEvent(e)},resetTyping:function(){I.inTyping=!1,I.typedSymbols=[]},mouseActionParsed:function(){C.mouseActionParsed()},createTypeAndDeferredActions:function(){I.typedSymbols.length&&o(I.currentElement),_.createAll()},checkActionsBeforeAdditionNativeDialogHandler:function(){"keydown"===I.lastEventType&&(C.symbolPressed&&(I.createOnKeyPress=!0),C.endKeyPressing())}}}();i.init=function(e,t){S=e,t&&(v=t.executableShortcuts||{},A=t.recordableShortcutList||[],T=t.typingStateChangedCallback||null,C=t.clickEditorStateChangedCallback||null),I=!0,a(r).ready(function(){M=p.saveState(),O=M}),w.init(),U.init({}),_.init()},i.destroy=function(e){I=!1,U.destroy(e),w.destroy(e),S=null,y="",M=null,O=null,D=null,b=null,P=!1,N=!1},i.resetParsing=function(){I&&(I=!1,U.clearState())},i.parseEvent=function(e){I=!0;var t=l.isEditableElement(e.target||e.srcElement,!0);(k||x&&!_.isWaitingDblClick()&&("dblclick"!==e.type||!t))&&(M=p.saveState(),k=!1,x=!1),/(^mouse\w+$)|(^touch\w+$)|(^pointer\w+$)|(^MSPointer\w+$)|^(dbl)?click$|^contextmenu$/.test(e.type)&&w.parse(e),/^key\w+$|^change$|^input$/.test(e.type)&&U.parse(e);var n=y;y&&(D=e.target||e.srcElement,b=y,P&&!N?N=!0:P&&N&&(N=!1,P=!1),"click"!==_.getLastActionType()?k=!0:x=!0,/click|drag|select/.test(y)&&U.mouseActionParsed(),y="");var r=R||l.isWebKit&&D&&l.isSelectElement(D)&&"click"===e.type&&""===n&&"click"===b&&D===(e.target||e.srcElement);return R=!1,r},i.createAllDeferred=function(){U.createTypeAndDeferredActions()},i.checkActionsBeforeAdditionNativeDialogHandler=function(){I&&(_.createAll(),w.checkActionsBeforeAdditionNativeDialogHandler(),U.checkActionsBeforeAdditionNativeDialogHandler())}}),n.define("Recorder.KeyEventParser",function(){function n(e){return e.ctrl||e.alt||e.meta||!e.shift?e.ctrl||e.alt||e.shift||e.meta:!1}function r(e){var t=u.getActiveElement();return e!==u.KEYS_MAPS.SPECIAL_KEYS.enter||u.isShadowUIElement(t)||"textarea"!==t.tagName.toLowerCase()?e===u.KEYS_MAPS.SPECIAL_KEYS.space?u.KEYS_MAPS.REVERSED_SPECIAL_KEYS[e]:u.isCharByKeyCode(e)?String.fromCharCode(u.KEYS_MAPS.SYMBOLS_KEYS_CHAR_CODES[e]||e).toLowerCase():u.KEYS_MAPS.REVERSED_SPECIAL_KEYS[e]||u.KEYS_MAPS.REVERSED_MODIFIERS[e]||"":String.fromCharCode(10)}function i(e,t){var n=t;return n&&(n+="+"),n+r(e)}function o(e){return e.replace(/\(|\)|\[|\]|\\|\.|\^|\$|\||\?|\+|\*/,function(e){return"\\"+e})}function s(e,t){if(!e)return t;var n=o(r(e));return t.replace(new RegExp("\\+?"+n+"($|\\+)"),"")}function a(e,t){var n=o(r(e));return new RegExp("(^|\\+)"+n+"($|\\+)").test(t)}var l=t.get("Hammerhead"),c=l.$,u=l.Util,d=u.KEYS_MAPS.SPECIAL_KEYS.tab,f=this.exports=function(){this.symbolPressedCallback=null,this.keysPressedCallback=null,this.shortcutHandlers={},this.modifiersState={ctrl:!1,alt:!1,shift:!1,meta:!1},this.currentKeysCombination="",this.savedKeysCombinations=[],this.pressedKeys=[],this.symbolPressed=!1,this.currentStartShortcutHandler=null,this.suspend=!1;var t=this;c(e).bind("blur",function(n){(n.target||n.srcElement)===e&&t.clearState()})},E=null,p=!1;f.prototype._keyDownHandler=function(e){var t=e.keyCode;if(this.currentEndShortcutHandler=null,this.currentStartShortcutHandler)if(a(t,this.currentKeysCombination)){if(!this.currentStartShortcutHandler.multiple)return;this.currentKeysCombination=s(t,this.currentKeysCombination),E=null}else{var r=i(t,this.currentKeysCombination),o=i(t,s(E,this.currentKeysCombination)),l=this.shortcutHandlers[r],f=this.shortcutHandlers[o];!f||!f.start||r!==o&&l&&l?this.shortcutHandlers[i(t,"")]&&this.shortcutHandlers[i(t,"")].start&&(this.currentKeysCombination=""):this.currentKeysCombination=s(E,this.currentKeysCombination)}if(this.currentStartShortcutHandler=null,u.KEYS_MAPS.REVERSED_MODIFIERS[t]){if(this.modifiersState[u.KEYS_MAPS.REVERSED_MODIFIERS[t]])return;this.modifiersState[u.KEYS_MAPS.REVERSED_MODIFIERS[t]]=!0}this.symbolPressed=u.isCharByKeyCode(t),!this.symbolPressed&&this.inTyping&&(this.inTyping=!1,this.currentKeysCombination=""),this.symbolPressed&&!n(this.modifiersState)||E!==t?(this.currentKeysCombination=i(t,this.currentKeysCombination),p=!1):(this.savedKeysCombinations.length||this.savedKeysCombinations.push(this.currentKeysCombination),this.savedKeysCombinations.push(this.currentKeysCombination),p=!0),E=t;var g=u.getShortcutHandlerByKeyCombination(this.shortcutHandlers,this.currentKeysCombination);if(g)this.currentStartShortcutHandler=g,this.inTyping&&(this.currentKeysCombination=u.getShortcutsByKeyCombination(this.shortcutHandlers,this.currentKeysCombination)[0]),g.start&&g.start(this.currentKeysCombination),this.inTyping=!1;else if(!u.isMozilla&&!c.browser.opera&&t===d&&"tab"===this.currentKeysCombination&&"body"===u.getNextFocusableElement(u.getActiveElement()).tagName.toLowerCase())return this.keysPressedCallback&&this.keysPressedCallback(this.currentKeysCombination),this.currentKeysCombination="",void(this.pressedKeys=[]);this.pressedKeys.push(t)},f.prototype._keyPressHandler=function(e){if(this.lastCharCode=e.charCode||e.keyCode||this.lastCharCode,this.symbolPressed&&!this.currentStartShortcutHandler){if("input"===e.type){if(!this.keyPressStoppedFromModifiers)return;this.keyPressStoppedFromModifiers=!1,this.currentKeysCombination=""}else if(n(this.modifiersState))return void(this.keyPressStoppedFromModifiers=!0);this.inTyping=!0,this.symbolPressedCallback&&this.symbolPressedCallback(this.lastCharCode,e.target||e.srcElement)}},f.prototype._keyUpHandler=function(e){var t=e.keyCode;u.KEYS_MAPS.REVERSED_MODIFIERS[t]&&(this.modifiersState[u.KEYS_MAPS.REVERSED_MODIFIERS[t]]=!1);var r=u.getShortcutHandlerByKeyCombination(this.shortcutHandlers,this.currentKeysCombination);return!this.suspend&&r&&r.end&&this.currentEndShortcutHandler!==r&&(this.currentEndShortcutHandler=r,r.end()),this.currentStartShortcutHandler&&this.currentStartShortcutHandler.start&&(this.currentKeysCombination=s(t,this.currentKeysCombination)),this.pressedKeys=c.map(this.pressedKeys,function(e){return e===t?null:e}),this.currentKeysCombination.length?void(this.pressedKeys.length?(!u.isCharByKeyCode(t)||n(this.modifiersState))&&(E===t&&(E=null),this.lastKeysCombination===this.currentKeysCombination||p||this.currentStartShortcutHandler||this.savedKeysCombinations.push(this.currentKeysCombination),p=!1,this.currentKeysCombination=s(t,this.currentKeysCombination),this.lastKeysCombination=this.currentKeysCombination):(this.suspend?this.suspend=!1:this.keysPressedCallback&&this.keysPressedCallback(this.savedKeysCombinations.length?this.savedKeysCombinations.join(" "):this.currentKeysCombination),this.currentKeysCombination="",this.savedKeysCombinations=[],E=null)):(this.savedKeysCombinations=[],E=null,void(this.suspend=!1))},f.prototype.init=function(e){var t=this;e&&(e.symbolPressed&&(t.symbolPressedCallback=e.symbolPressed),e.keysPressed&&(t.keysPressedCallback=e.keysPressed),e.shortcutHandlers&&c.each(e.shortcutHandlers,function(e,n){t.shortcutHandlers[e]=n instanceof Function?{start:n,multiple:!0}:{start:n.start,end:n.end,multiple:"undefined"==typeof n.multiple?!0:n.multiple}}))},f.prototype.clearState=function(){this.pressedKeys=[],this.currentKeysCombination="",this.modifiersState={ctrl:!1,alt:!1,shift:!1,meta:!1},this.savedKeysCombinations=[],this.symbolPressed=!1,this.currentStartShortcutHandler=null,E=null,p=!1},f.prototype.clear=function(){var e=this;e.clearState(),e.symbolPressedCallback=null,e.keysPressedCallback=null,e.shortcutHandlers={}},f.prototype.pushEvent=function(e){"keydown"!==e.type||this.suspend||this._keyDownHandler(e),"keypress"!==e.type&&"input"!==e.type||this.suspend||this._keyPressHandler(e),"keyup"===e.type&&this._keyUpHandler(e)},f.prototype.mouseActionParsed=function(){E&&(this.suspend=!0)},f.prototype.endKeyPressing=function(){var e=this;this.pressedKeys.forEach(function(t){e._keyUpHandler({keyCode:t})})}}),n.define("Recorder.PlaybackRunner",function(e){var n=t.get("Hammerhead"),r=n.Util,i=e("Base.Transport"),o=e("Shared.ServiceCommands"),s=e("TestRunner.TestRunnerBase"),a=this.exports=function(){s.apply(this)};r.inherit(a,s),a.prototype.TEST_FAILED_EVENT="testFailed",a.prototype._onTestComplete=function(e){a.base._destroy.call(this),a.base._onTestComplete.call(this,e)},a.prototype._onError=function(e){e.pageError||this.testIterator.stop(),s.prototype._onError.call(this,e)},a.prototype.skipStep=function(e,t,n){"undefined"!=typeof n&&(this.testIterator.state.step=n),this.testIterator.state.stepNames=e,this.testIterator.state.testSteps=t,this.testIterator.runNext()
},a.prototype.resumePlayback=function(e,t){this.testIterator.state.stepNames=e,this.testIterator.state.testSteps=t,this.testIterator.runLast()},a.prototype._onAssertionFailed=function(e){this.testIterator.stop(),this.eventEmitter.emit(this.TEST_FAILED_EVENT,e)},a.prototype._onNextStepStarted=function(e){var t={cmd:o.SET_NEXT_STEP_PLAYBACK,nextStep:e.nextStep};this.eventEmitter.emit(this.NEXT_STEP_STARTED_EVENT,e),i.asyncServiceMsg(t,e.stop?null:e.callback)},a.prototype._onActionTargetWaitingStarted=function(e){s.prototype._onActionTargetWaitingStarted.apply(this,[e]),i.asyncServiceMsg({cmd:o.SET_ACTION_TARGET_WAITING_PLAYBACK,value:!0})},a.prototype._onActionRun=function(){s.prototype._onActionRun.apply(this,[]),i.asyncServiceMsg({cmd:o.SET_ACTION_TARGET_WAITING_PLAYBACK,value:!1})},a.prototype._onDialogsInfoChanged=function(e){i.asyncServiceMsg({cmd:o.NATIVE_DIALOGS_INFO_SET,info:e,timeStamp:Date.now()})}}),n.define("Recorder.PropertyListGenerator",function(e,n){function r(){return[{name:"exists",isSuitable:function(){return!0},getValue:function(e){return e.length>0},generateGetter:function(e){return e+".length > 0"},isDefault:!0},{name:"text",isSuitable:function(e){return!!e.length},getValue:function(e){return e.text()},generateGetter:function(e){return e+".text()"}},{name:"value",isSuitable:function(e){return 1===e.length&&s(e[0])},getValue:function(e){return e.val()},generateGetter:function(e){return e+".val()"}},{name:"selectedIndex",isSuitable:function(e){return 1===e.length&&l(e[0])},getValue:function(e){return e[0].selectedIndex},generateGetter:function(e){return e+"[0].selectedIndex"}},{name:"checked",isSuitable:function(e){return 1===e.length&&a(e[0])},getValue:function(e){return e[0].checked},generateGetter:function(e){return e+"[0].checked"}},{name:"visible",isSuitable:function(){return!0},getValue:function(e){return e.is(":visible")},generateGetter:function(e){return e+'.is(":visible")'}},{name:"class",isSuitable:function(e){return 1===e.length},getValue:function(e){return e.attr("class")},generateGetter:function(e){return e+'.attr("class")'}},{name:"matching element count",isSuitable:function(){return!0},getValue:function(e){return e.length},generateGetter:function(e){return e+".length"}},{name:"child element count",isSuitable:function(e){return!!e.length},getValue:function(e){return e.children().length},generateGetter:function(e){return e+".children().length"}},{name:"width",isSuitable:function(e){return 1===e.length},getValue:function(e){return e.outerWidth()},generateGetter:function(e){return e+".outerWidth()"}},{name:"height",isSuitable:function(e){return 1===e.length},getValue:function(e){return e.outerHeight()},generateGetter:function(e){return e+".outerHeight()"}},{name:"left",isSuitable:function(e){return 1===e.length},getValue:function(e){return e.offset().left},generateGetter:function(e){return e+".offset().left;"}},{name:"top",isSuitable:function(e){return 1===e.length},getValue:function(e){return e.offset().top},generateGetter:function(e){return e+".offset().top"}}]}function i(){return[{name:"exists",isSuitable:function(){return!0},getValue:function(){return!0},generateGetter:function(e){return"!!("+e+")"},isDefault:!0},{name:"text",isSuitable:function(){return!0},getValue:function(e){return e.textContent},generateGetter:function(e){return e+".textContent"}},{name:"value",isSuitable:function(e){return s(e)},getValue:function(e){return e.value},generateGetter:function(e){return e+".value"}},{name:"selectedIndex",isSuitable:function(e){return l(e)},getValue:function(e){return e.selectedIndex},generateGetter:function(e){return e+".selectedIndex"}},{name:"checked",isSuitable:function(e){return a(e)},getValue:function(e){return e.checked},generateGetter:function(e){return e+".checked"}},{name:"visible",isSuitable:function(){return!0},getValue:function(e){return E(e).is(":visible")},generateGetter:function(e){return"$("+e+').is(":visible")'}},{name:"class",isSuitable:function(){return!0},getValue:function(e){return e.className},generateGetter:function(e){return e+".className"}},{name:"child element count",isSuitable:function(){return!0},getValue:function(e){return e.childElementCount},generateGetter:function(e){return e+".childElementCount"}},{name:"width",isSuitable:function(){return!0},getValue:function(e){return e.offsetWidth},generateGetter:function(e){return e+".offsetWidth"}},{name:"height",isSuitable:function(){return!0},getValue:function(e){return e.offsetHeight},generateGetter:function(e){return e+".offsetHeight"}},{name:"left",isSuitable:function(){return!0},getValue:function(e){return E(e).offset().left},generateGetter:function(e){return"$("+e+").offset().left"}},{name:"top",isSuitable:function(){return!0},getValue:function(e){return E(e).offset().top},generateGetter:function(e){return"$("+e+").offset().top"}}]}function o(){return[{name:"length",isSuitable:function(){return!0},getValue:function(e){return e.length},generateGetter:function(e){return e+".length"},isDefault:!0}]}function s(e){return"input"===e.tagName.toLowerCase()||"button"===e.tagName.toLowerCase()||"select"===e.tagName.toLowerCase()}function a(e){return"input"===e.tagName.toLowerCase()&&"checkbox"===e.getAttribute("type")}function l(e){return"select"===e.tagName.toLowerCase()}function c(e,t,n,s){function a(e){e.message.cmd===m.GENERATE_GENERAL_PROPERTIES_IN_IFRAME_RESPONSE_CMD&&(n(e.message.properties),g.off(g.SERVICE_MSG_RECEIVED,a))}if(s){g.on(g.SERVICE_MSG_RECEIVED,a);var l={cmd:m.GENERATE_GENERAL_PROPERTIES_IN_IFRAME_REQUEST_CMD,selector:t};return void g.sendServiceMsg(l,s)}e||(e=h.parseSelectorSync(t).evalResults);var c,u=[];if(p.isJQueryObj(e))c=r();else if(p.isDomElement(e))c=i();else{if(!(E.isArray(e)||e instanceof NodeList||e instanceof HTMLCollection))return void n(u);c=o()}for(var d=0;d<c.length;d++)c[d].isSuitable(e)&&u.push({name:c[d].name,value:c[d].getValue(e),getter:c[d].generateGetter(t),isDefault:c[d].isDefault||!1});n(u)}function u(e,t,n,r){function i(e){e.message.cmd===m.GENERATE_CSS_PROPERTIES_IN_IFRAME_RESPONSE_CMD&&(n(e.message.properties),g.off(g.SERVICE_MSG_RECEIVED,i))}if(r){g.on(g.SERVICE_MSG_RECEIVED,i);var o={cmd:m.GENERATE_CSS_PROPERTIES_IN_IFRAME_REQUEST_CMD,selector:t};return void g.sendServiceMsg(o,r)}e||(e=h.parseSelectorSync(t).evalResults);var s,a,l=[],c=[];if(p.isJQueryObj(e)&&e.length)a=e,s=function(e,t){return e+'.css("'+t+'")'};else{if(!p.isDomElement(e))return void n(c);a=E(e),s=function(e,t){return"$("+e+').css("'+t+'")'}}for(var u in a[0].style)/[^a-z\-]/i.test(u)||l.push(u);l.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())});for(var d=0;d<l.length;d++){var f=a.css(l[d]);"object"!=typeof f&&c.push({name:l[d],value:f,getter:s(t,l[d])})}n(c)}function d(e,t,n,r){function i(e){e.message.cmd===m.GENERATE_ATTRIBUTES_IN_IFRAME_RESPONSE_CMD&&(n(e.message.properties),g.off(g.SERVICE_MSG_RECEIVED,i))}if(r){g.on(g.SERVICE_MSG_RECEIVED,i);var o={cmd:m.GENERATE_ATTRIBUTES_IN_IFRAME_REQUEST_CMD,selector:t};return void g.sendServiceMsg(o,r)}e||(e=h.parseSelectorSync(t).evalResults);var s=[],a=f.getOriginElementAttributes(e[0]);if(a){for(var l=0;l<a.length;l++)s.push({name:a[l].name,value:e[0].getAttribute(a[l].name),getter:t+'.attr("'+a[l].name+'")'});n(s)}else n(null)}var f=t.get("Hammerhead"),E=f.$,p=f.Util,g=f.MessageSandbox,m=e("Base.CrossDomainMessages"),h=e("Base.JavascriptExecutor");n.getGeneralProperties=c,n.getCssProperties=u,n.getAttributes=d}),n.define("Recorder.Recorder",function(n){function r(e){return{start:function(){u.setPreventingMode(!0)},end:function(){p.Shortcuts[e](),u.setPreventingMode(!1)},multiple:!1}}var i=t.get("Hammerhead"),o=i.$,s=i.MessageSandbox,a=i.Util,l=n("Automation"),c=n("Recorder.ElementPicker"),u=n("Recorder.EventListener"),d=n("Base.JavascriptExecutor"),f=n("UI.ModalBackground"),E=n("Recorder.RecorderBase"),p=n("UI.Recorder"),g=n("Recorder.Util"),m=n("Recorder.SelectorGenerator"),h=n("Shared.ServiceCommands"),_=n("Settings"),S=n("Shared.Const"),v=n("UI.RecorderWidgets.Tooltip"),A=n("Base.Transport"),T=n("UI.UXLog"),C=1e3,R="The file input was cleared.",I="Cannot copy a file to the test folder. Probably, TestCafe does not have rights to do this or the hard disk is full.",y=750,D="The following files have been copied to the test folder:<br><br>%s",b=this.exports=function(e){var t=this;E.apply(this,[e]),this.stepsInfo=[],this.hasUnsavedChanges=!1,this.testSaved=!1,this.uploadingInProcess=!1,this.elementPickingInProcess=!1,this.paused=!1,this.nativeDialogQueue=_.NATIVE_DIALOGS_QUEUE||[],p.isInitialized()||p.init(function(){return t.stepsInfo},function(){return t.hasUnsavedChanges},function(){return t.testSaved},_.SHOW_STEPS),p.events.on(p.START_PICKING_ELEMENT_EVENT,function(e){t._startPickingElement(function(t,n){e.callback(t,n)},e.iFrameContext)}),p.events.on(p.STOP_PICKING_ELEMENT_EVENT,function(){p.onStopPickElement()})};a.inherit(b,E),b.prototype.loadStepsInfo=function(e){var t=this;A.asyncServiceMsg({cmd:h.STEPS_INFO_GET},function(n){t.stepsInfo=[];for(var r=n.stepsInfo||[],i=0;i<r.length;i++)t.stepsInfo.push(g.parseServerCompatibleStepInfo(r[i]));t.hasUnsavedChanges=n.hasUnsavedChanges||!1,t.testSaved=n.testSaved||!1,e(t.stepsInfo,t.hasUnsavedChanges)})},b.prototype.start=function(e){T.write("Recording started"),b.base.start.call(this,e),this._checkNativeDialogsQueue()},b.prototype._parseAndSendStepsInfo=function(e){o.each(this.stepsInfo,function(e,t){g.parseStepArguments(t)}),g.sendStepsInfo(this.stepsInfo,this.hasUnsavedChanges,e)},b.prototype._setDialogHandler=function(e,t,n){this._setHasUnsavedChanges(!0),e.nativeDialogHandlers||(e.nativeDialogHandlers=[]);var r=g.BROWSER_DIALOG_INDEXES[t],i={dialog:t,retValue:n};e.nativeDialogHandlers[r]&&e.nativeDialogHandlers[r].length?e.nativeDialogHandlers[r].push(i):e.nativeDialogHandlers[r]=[i],g.sendStepsInfo(this.stepsInfo,!0),p.handlerAdded(t)},b.prototype._saveDialogHandler=function(e,t){function n(e,t,n){var r=i.stepsInfo[e];if(r)i._setDialogHandler(r,t,n);else{var o=g.BROWSER_DIALOG_INDEXES[t],s={dialog:t,retValue:n};i.nativeDialogQueue[o]&&i.nativeDialogQueue[o].length?i.nativeDialogQueue[o].push(s):i.nativeDialogQueue[o]=[s],A.asyncServiceMsg({cmd:h.SET_NATIVE_DIALOGS_QUEUE,queue:i.nativeDialogQueue})}}function r(){var e=i.stepsInfo.length;return i.uploadingInProcess||i.elementPickingInProcess?e:e?e-1:0}var i=this;/alert|confirm|prompt/.test(e)&&this.beforeUnloadEventWasRaised||(a.isMozilla&&"beforeUnload"===e?i._setDialogHandler(i.stepsInfo[i.stepsInfo.length-1],"beforeUnload"):n(r(),e,t))},b.prototype._checkNativeDialogsQueue=function(){var e=this;o.each(this.nativeDialogQueue,function(t,n){n&&o.each(n,function(t,n){var r=e.stepsInfo[e.stepsInfo.length-1];r&&e._setDialogHandler(r,n.dialog,n.retValue)})}),this.nativeDialogQueue=[]},b.prototype._setHasUnsavedChanges=function(e,t){if(this.hasUnsavedChanges=e,p.updateToolbarButtons(),t){var n={cmd:h.SET_HAS_UNSAVED_CHANGES,hasUnsavedChanges:e};A.asyncServiceMsg(n,function(){p.updateToolbarButtons()})}},b.prototype._saveStep=function(e,t){g.parseStepArguments(e),this._checkNativeDialogsQueue(),t?this.stepsInfo[this.stepsInfo.length-1]=e:this.stepsInfo.splice(this.stepsInfo.length,0,e),this._setHasUnsavedChanges(!0),g.sendStepsInfo(this.stepsInfo,this.hasUnsavedChanges),t||p.stepAdded(e),T.write(e.isAssertion?"Assertion is saved":"Action is saved: "+e.actionDescriptor.type)},b.prototype._startPickingElement=function(e,t){var n=this;this.elementPickingInProcess=!0,b.base._startPickingElement.call(this),this.elementPickCallback=function(t,r,i){n._stopPickingElement(),e(t,r,i)},c.start(this.elementPickCallback,t),p.onStartPickElement();var r={cmd:E.IFRAME_START_PICKING_ELEMENT_CMD};t?s.sendServiceMsg(r,t):this._sendMessageToAllIFrame(r)},b.prototype._stopPickingElement=function(){this.elementPickingInProcess=!1,b.base._stopPickingElement.call(this),this._sendMessageToAllIFrame({cmd:E.IFRAME_STOP_PICKING_ELEMENT_CMD})},b.prototype._exitRecording=function(){var t=this;this.recording=!1,A.asyncServiceMsg({cmd:h.EXIT_RECORDING},function(n){var r=n.fixtureFilename;n.err||(t.recording=!1,e.location.href=_.RETURN_URL+_.FIXTURE_FILE_NAME_PARAM+r)})},b.prototype._initUi=function(){if(p.activateRecordingMode(),this.recordingManagerOptions.typingStateChangedCallback=p.onTypingStateChanged,this.recordingManagerOptions.clickEditorStateChangedCallback=p.onClickEditorStateChanged,p.Shortcuts)for(var e in p.Shortcuts)p.Shortcuts.hasOwnProperty(e)&&(this.recordingManagerOptions.executableShortcuts[e]=r(e));else this.recordingManagerOptions.executableShortcuts={}},b.prototype._initRecordingUiEventHandling=function(){function t(){i||(i=!0,u.pause())}function n(){i&&(i=!1,u.resume())}var r=this,i=!1;p.events.on(p.ADD_HOVER_ACTION_EVENT,function(){u.setPreventingMode(!0),r._createAllDeferred(),r._sendMessageToAllIFrame({cmd:E.IFRAME_CREATE_ALL_DEFERRED_ACTIONS_CMD}),u.pause(),r._startPickingElement(function(e,t,n){if(p.onStopPickElement(),u.resume(),e)if(t){var i=d.parseSelectorSync(t[0].selector).$elements[0];s.sendServiceMsg({cmd:E.IFRAME_HOVER_ACTION_RECORDED_CMD,elementSelectors:e,iFrameSelectors:t,options:n},i.contentWindow)}else{var a=o.extend(l.defaultMouseActionDescriptor,{type:"hover",element:d.parseSelectorSync(e[0].selector).$elements[0],apiArguments:{options:n},selector:e[0].selector,serviceInfo:{selectors:e}});r._onActionParsed(a)}}),u.setPreventingMode(!1)}),p.events.on(p.ADD_WAIT_ACTION_EVENT,function(){u.setPreventingMode(!0),r._createAllDeferred(),r._sendMessageToAllIFrame({cmd:E.IFRAME_CREATE_ALL_DEFERRED_ACTIONS_CMD});var e=o.extend(l.defaultWaitActionDescriptor,{apiArguments:{ms:C}});r._onActionParsed(e,!0),u.setPreventingMode(!1)}),p.events.on(p.ADD_SCREENSHOT_ACTION_EVENT,function(){u.setPreventingMode(!0),r._createAllDeferred(),r._sendMessageToAllIFrame({cmd:E.IFRAME_CREATE_ALL_DEFERRED_ACTIONS_CMD}),r._onActionParsed(l.defaultScreenshotActionDescriptor),u.setPreventingMode(!1)}),p.events.on(p.ADD_ASSERTIONS_STEP_EVENT,function(){var e=r.stepsInfo.length&&r.stepsInfo[r.stepsInfo.length-1].isAssertion,t=e?r.stepsInfo.length:r.stepsInfo.length+1,n=e?r.stepsInfo[r.stepsInfo.length-1]:g.getAssertionsStepInfo();p.confirmAction(t,n,function(t,n){t&&r._saveStep(n,e)})}),p.events.on(p.RUN_PLAYBACK_EVENT,function(){p.hideToolbar(),f.show(),f.showLoadingIcon(),r.recording=!1,A.asyncServiceMsg({cmd:h.START_PLAYBACK},function(t){t.err?e.location.href=_.RETURN_URL:A.switchToStartRecordingUrl(t.recordingUrl)})}),p.events.on(p.SAVE_TEST_EVENT,function(e){r.recording=!1,A.asyncServiceMsg({cmd:h.SAVE_TEST,testName:e.testName},function(t){var n=t.err;n||r._setHasUnsavedChanges(!1,!0),e.callback(n),n||(r.recording=!0,r.testSaved=!0,e.complete&&r._exitRecording())})}),p.events.on(p.EXIT_RECORDING_EVENT,function(e){return e&&e.skipCheckChanges?void r._exitRecording():(u.createAllDeferred(),void(r.hasUnsavedChanges?p.openChangesWarningDialog(e&&e.hasErrors):r._exitRecording()))}),p.events.on(p.RESTART_RECORDING_EVENT,function(){r.recording=!1,A.asyncServiceMsg({cmd:h.RESTART_RECORDING},function(t){t.err?e.location.href=_.RETURN_URL:A.switchToStartRecordingUrl(t.recordingUrl)})}),p.events.on(p.SEND_STEPS_INFO_EVENT,function(){r._setHasUnsavedChanges(!!r.stepsInfo.length),r._parseAndSendStepsInfo()}),p.events.on(p.POPUP_DIALOG_OPENING_EVENT,t),p.events.on(p.POPUP_DIALOG_CLOSED_EVENT,function(e){e.needSendStepsInfo&&r._parseAndSendStepsInfo(),n()}),p.events.on(p.STEP_EDITING_STARTED,t),p.events.on(p.STEP_EDITING_FINISHED,n)},b.prototype._startUpload=function(t,n){var r=!1,i=null;f.show(),f.showLoadingIcon(),p.hideToolbar();var o=e.setTimeout(function(){o=null,r&&t(i)},y);n(function(e){r=!0,i=!!e.length,o||t(i)})},b.prototype._uploadCompleted=function(e,t,n){var r=n?I:D.replace("%s",t.join("<br>"));r=n?I:t.join("")?D.replace("%s",t.join("<br>")):R,p.showToolbar(),f.hideLoadingIcon(),f.hide(),v.show(r)},b.prototype._initHammerheadEventHandling=function(){var e=this;i.on(i.FILE_UPLOADING_EVENT,function(t,n,r){e.uploadingInProcess=!0;var i=m.generate(o(n));e._startUpload(function(n){e.uploadingInProcess=!1;var r=t.map(function(e){return S.UPLOADED_FILES_PATH+e});e._uploadCompleted(t,r,n),e._onActionParsed({type:"upload",apiArguments:{files:r},serviceInfo:{selectors:i,fileNames:t}})},r)})},b.prototype._onUploadRequested=function(e,t,n){var r=this,i=e.map(function(e){return S.UPLOADED_FILES_PATH+e});r._startUpload(function(t){r._uploadCompleted(e,i,t)},function(e){s.sendServiceMsg({cmd:E.IFRAME_UPLOAD_ALLOWED_CMD},n);var t=function(n){n.message.cmd===E.IFRAME_UPLOAD_COMPLETED_CMD&&(s.off(s.SERVICE_MSG_RECEIVED,t),e(n.message.errs))};s.on(s.SERVICE_MSG_RECEIVED,t)})},b.prototype._confirmAction=function(e,t){p.confirmAction(this.stepsInfo.length+1,e,t)}}),n.define("Recorder.RecorderBase",function(n){function r(e,t){var n=s.getIFrameByWindow(e);return t=E.parseStepInfo(t),t.iFrameSelectors=p.generate(o(n)),t}var i=t.get("Hammerhead"),o=i.$,s=i.Util,a=i.MessageSandbox,l=n("Settings"),c=n("Recorder.EventListener"),u=n("Automation"),d=n("Automation.IFrameBehavior"),f=n("Base.JavascriptExecutor"),E=n("Recorder.Util"),p=n("Recorder.SelectorGenerator"),g=n("UI.Cursor"),m=n("Recorder.ElementPicker"),h=n("Base.CrossDomainMessages"),_=n("Recorder.PropertyListGenerator"),S=n("TestRunner.API.Assertions"),v=n("UI.RecorderWidgets.ObjectViewer"),A=this.exports=function(e){this.eventEmitter=new s.EventEmitter,this.waitingIframeRecorders=[],this.iFrameListeners=[],this.recordingManagerOptions={recordableShortcutList:u.SUPPORTED_SHORTCUTS,executableShortcuts:{}},this.elementPickCallback=null,this.beforeUnloadEventWasRaised=!1,this.nativeDialogs=e,this._initIFrameBehavior(),l.PLAYBACK||this.initNativeDialogsHandling()};A.IFRAME_RECORDER_INITIALIZED_CMD="iframeRecorderInitialized",A.START_IFRAME_RECORDER_CMD="startIframeRecorder",A.IFRAME_SAVE_STEP_REQUEST_CMD="saveStepRequest",A.IFRAME_SAVE_STEP_RESPONSE_CMD="saveStepResponse",A.IFRAME_UPLOAD_ALLOWED_CMD="iframeUploadAllowed",A.IFRAME_UPLOAD_COMPLETED_CMD="iframeUploadCompleted",A.IFRAME_UPLOAD_REQUEST_TO_UPLOAD_CMD="iframeRequestToUpload",A.IFRAME_CONFIRM_ACTION_REQUEST_CMD="confirmActionRequest",A.IFRAME_CONFIRM_ACTION_RESPONSE_CMD="confirmActionResponse",A.IFRAME_TYPING_STATE_CHANGED_REQUEST_CMD="typingStateChangedRequest",A.IFRAME_TYPING_STATE_CHANGED_RESPONSE_CMD="typingStateChangedResponse",A.IFRAME_CLICK_EDITOR_STATE_CHANGED_REQUEST_CMD="clickEditorStateChangedRequest",A.IFRAME_CLICK_EDITOR_STATE_CHANGED_RESPONSE_CMD="clickEditorStateChangedResponse",A.IFRAME_SHORTCUT_PRESSED_START_CMD="shortcutPressedStart",A.IFRAME_SHORTCUT_PRESSED_END_CMD="shortcutPressedEnd",A.IFRAME_SAVE_DIALOG_HANDLER_CMD="saveDialogHandler",A.IFRAME_START_PICKING_ELEMENT_CMD="iFrameStartPickingElement",A.IFRAME_STOP_PICKING_ELEMENT_CMD="iFrameStopPickingElement",A.IFRAME_ELEMENT_PICKED_CMD="iFrameElementPicked",A.IFRAME_HOVER_ACTION_RECORDED_CMD="iFrameHoverActionRecorded",A.IFRAME_CREATE_ALL_DEFERRED_ACTIONS_CMD="iFrameCreateAllDeferredActions",A.prototype.on=function(){return this.eventEmitter.on.apply(this.eventEmitter,arguments)},A.prototype._initIFrameBehavior=function(){var e=this;d.init(),a.on(a.SERVICE_MSG_RECEIVED,function(t){var n=t.message,i=t.source,l=null,c=null,u=null;switch(n.cmd){case A.IFRAME_UPLOAD_REQUEST_TO_UPLOAD_CMD:e._onUploadRequested(n.fileNames,n.selectors,i);break;case A.IFRAME_RECORDER_INITIALIZED_CMD:e.started?a.sendServiceMsg({cmd:A.START_IFRAME_RECORDER_CMD},i):e.waitingIframeRecorders.push(i),o.inArray(i,e.iFrameListeners)<0&&e.iFrameListeners.push(i);break;case A.IFRAME_SAVE_STEP_REQUEST_CMD:e._saveStep(r(i,n.stepInfo)),a.sendServiceMsg({cmd:A.IFRAME_SAVE_STEP_RESPONSE_CMD},i);break;case A.IFRAME_CONFIRM_ACTION_REQUEST_CMD:e._confirmAction(r(i,n.stepInfo),function(e,t){l={cmd:A.IFRAME_CONFIRM_ACTION_RESPONSE_CMD,confirmed:e,stepInfo:t?E.serializeStepInfo(t):null},a.sendServiceMsg(l,i)});break;case A.IFRAME_TYPING_STATE_CHANGED_REQUEST_CMD:n.isTypingStarted&&(c=s.getFixedPosition({x:n.rect.left,y:n.rect.top},i),u={left:c.x,top:c.y,width:n.rect.width,height:n.rect.height}),e.recordingManagerOptions.typingStateChangedCallback(n.isTypingStarted,function(){a.sendServiceMsg({cmd:A.IFRAME_TYPING_STATE_CHANGED_RESPONSE_CMD},i)},u);break;case A.IFRAME_CLICK_EDITOR_STATE_CHANGED_REQUEST_CMD:n.isClickOnEditorStarted&&(c=s.getFixedPosition({x:n.rect.left,y:n.rect.top},i),u={left:c.x,top:c.y,width:n.rect.width,height:n.rect.height}),e.recordingManagerOptions.clickEditorStateChangedCallback(n.isClickOnEditorStarted,function(){a.sendServiceMsg({cmd:A.IFRAME_CLICK_EDITOR_STATE_CHANGED_RESPONSE_CMD},i)},u);break;case A.IFRAME_SHORTCUT_PRESSED_START_CMD:"function"==typeof e.recordingManagerOptions.executableShortcuts[n.shortcut].start?e.recordingManagerOptions.executableShortcuts[n.shortcut].start():"function"==typeof e.recordingManagerOptions.executableShortcuts[n.shortcut]&&e.recordingManagerOptions.executableShortcuts[n.shortcut]();break;case A.IFRAME_SHORTCUT_PRESSED_END_CMD:"function"==typeof e.recordingManagerOptions.executableShortcuts[n.shortcut].end&&e.recordingManagerOptions.executableShortcuts[n.shortcut].end();break;case A.IFRAME_SAVE_DIALOG_HANDLER_CMD:e._saveDialogHandler(n.dialog,n.retValue);break;case A.IFRAME_ELEMENT_PICKED_CMD:e.elementPickCallback(n.elementSelector,n.iFrameSelectors,n.options);break;case h.GENERATE_GENERAL_PROPERTIES_IN_IFRAME_REQUEST_CMD:_.getGeneralProperties(null,n.selector,function(e){l={cmd:h.GENERATE_GENERAL_PROPERTIES_IN_IFRAME_RESPONSE_CMD,properties:e},a.sendServiceMsg(l,i)});break;case h.GENERATE_CSS_PROPERTIES_IN_IFRAME_REQUEST_CMD:_.getCssProperties(null,n.selector,function(e){l={cmd:h.GENERATE_CSS_PROPERTIES_IN_IFRAME_RESPONSE_CMD,properties:e},a.sendServiceMsg(l,i)});break;case h.GENERATE_ATTRIBUTES_IN_IFRAME_REQUEST_CMD:_.getAttributes(null,n.selector,function(e){l={cmd:h.GENERATE_ATTRIBUTES_IN_IFRAME_RESPONSE_CMD,properties:e},a.sendServiceMsg(l,i)});break;case h.ASSERT_REQUEST_CMD:var d=n.args,p=n.operator;d[0]=f.eval(d[0]),("eq"===p||"notEq"===p)&&(d[1]=f.eval(d[1])),S.assert(p,d,function(e){a.sendServiceMsg({cmd:h.ASSERT_RESPONSE_CMD,err:e},i)});break;case h.OBJECT_VIEWER_GET_OBJECT_VIEW_REQUEST_CMD:v.getObjectView(n.stringValue,null,function(e){delete e.parsedValue,a.sendServiceMsg({cmd:h.OBJECT_VIEWER_GET_OBJECT_VIEW_RESPONSE_CMD,objectView:e,stringValue:n.stringValue},i)});break;case h.OBJECT_VIEWER_GET_OBJECT_PROPERTIES_ROWS_REQUEST_CMD:v.getObjectPropertiesRows(n.stringValue,n.getInheritedProperties,null,function(e){a.sendServiceMsg({cmd:h.OBJECT_VIEWER_GET_OBJECT_PROPERTIES_ROWS_RESPONSE_CMD,rows:e,stringValue:n.stringValue},i)})}})},A.prototype.loadStepsInfo=function(){},A.prototype.start=function(e){var t=this;this.recording=!0,this.started=!0,g.init(),this._initUi(),this._initRecordingUiEventHandling(),this._initHammerheadEventHandling(),u.init(),f.init(),c.start(function(e){t._onActionParsed(e)},this.recordingManagerOptions);for(var n=0;n<this.waitingIframeRecorders.length;n++)a.sendServiceMsg({cmd:A.START_IFRAME_RECORDER_CMD,initNativeDialogs:e},this.waitingIframeRecorders[n])},A.prototype._saveDialogHandler=function(){},A.prototype.initNativeDialogsHandling=function(){var t=this,n=this.nativeDialogs||E.getNativeDialogs();e.alert=function(e){return c.checkActionsBeforeAdditionNativeDialogHandler(),t._saveDialogHandler("alert"),n.alert(e)},e.confirm=function(e){c.checkActionsBeforeAdditionNativeDialogHandler();var r=n.confirm(e);return t._saveDialogHandler("confirm",r),r},e.prompt=function(e){c.checkActionsBeforeAdditionNativeDialogHandler();var r=n.prompt(e);return t._saveDialogHandler("prompt",r),r},i.on(i.BEFORE_BEFORE_UNLOAD_EVENT,function(e){e.isFakeIEEvent||(c.createAllDeferred(),t.beforeUnloadEventWasRaised=!0)}),i.on(i.BEFORE_UNLOAD_EVENT,function(e){t.recording&&!l.PLAYBACK&&e.prevented&&!e.isFakeIEEvent&&t._saveDialogHandler("beforeUnload"),t.recording||(t.recording=!0)}),i.on(i.UNLOAD_EVENT,function(){c.stop()})},A.prototype._sendMessageToAllIFrame=function(e){for(var t=0;t<this.iFrameListeners.length;t++)a.sendServiceMsg(e,this.iFrameListeners[t])},A.prototype._startPickingElement=function(){this.isPlayback=l.PLAYBACK,l.PLAYBACK=!1},A.prototype._stopPickingElement=function(){l.PLAYBACK=this.isPlayback,this.elementPickCallback=null,m.stop()},A.prototype._saveStep=function(){},A.prototype._createAllDeferred=function(){c.createAllDeferred()},A.prototype._initUi=function(){},A.prototype._initRecordingUiEventHandling=function(){},A.prototype._initHammerheadEventHandling=function(){},A.prototype._onUploadRequested=function(){},A.prototype._confirmAction=function(){},A.prototype._onActionParsed=function(e,t){var n=this,r=E.getActionStepInfo(e);t?this._confirmAction(r,function(e,t){e&&n._saveStep(t)}):this._saveStep(r)}}),n.define("Recorder.SelectorGenerator.Rules",function(e,n){var r=t.get("Hammerhead"),i=r.$,o=r.Util,s=e("Shared.Const"),a=e("Base.jQueryExtensions.Selectors"),l=null,c=150,u=/_ctl\d+|ctl\d+_|^ctl\d+$/g,d=/\$ctl\d+|ctl\d+\$/g,f=[/^alt$/,/^name$/,/^class$/,/^title$/,/^data-\S+/],E="!!!!!anyNumber!!!!!",p="!!!!!separator!!!!!",g="element whose ",m=", ",h='{0} contains "{1}"',_='{0} is "{1}"',S='{0} attribute value is "{1}"',v='{0} attribute value matches the regular expression "{1}"',A='element that contains text "{0}", ignoring child node text',T="{0} element",C="Searches for an {0}.",R="Searches through descendants of the {1} for an {0}.",I="Searches through descendants of the form {1} for an input {0}.",y="Searches through descendants of the <span>body</span> element for an element at a specific location in the DOM hierarchy: {0}.",D="Searches through descendants of the {1} for an element at a specific location in the DOM hierarchy: {0}.",b="The {0} matching element is returned.";n.ruleIDs={FOR_HTML:"html",FOR_BODY:"body",BY_ID:"id",BY_TEXT:"text",BY_ANCESTOR_AND_TEXT:"id-text",BY_ATTR:"attr",BY_ANCESTOR_AND_ATTR:"id-attr",BY_TAGS_TREE:"dom",BY_ANCESTOR_WITH_TEXT_AND_TAGS_TREE:"text-dom",BY_ANCESTOR_WITH_ATTR_AND_TAGS_TREE:"attr-dom",BY_INPUT_NAME_AND_FORM:"form-input",USER_INPUT:"custom"};var M=function(e,t,n){return e.replace(/{(\d+)}/g,function(e,r){return"undefined"==typeof t[r]?e:n?t[r]:"<span>"+t[r]+"</span>"})},O=function(e,t){var n='$("',r='")',i=').find("',o=/", \$\("[\s|\S]+"\)\.contents\(\)/g;if(!e||0!==e.indexOf(n)||e.lastIndexOf(r)!==e.length-r.length&&!(!t&&new RegExp(o)).test(e))return{};if(t){if(e.indexOf(i)>0){var s=e.substring(n.length,e.lastIndexOf(i)),a=e.substring(e.lastIndexOf(i)+i.length);return a.lastIndexOf(r)!==a.length-r.length?{}:(a=a.substring(0,a.lastIndexOf(r)),new RegExp(o).test(s)?{elementSelector:a,ancestorSelector:s.substring(0,s.search(new RegExp(o))),contextSelector:s.substring(s.search(new RegExp(o)))}:{elementSelector:a,ancestorSelector:s.substring(0,s.lastIndexOf('"'))})}return{}}return new RegExp(o).test(e)?{elementSelector:e.substring(n.length,e.search(new RegExp(o))),contextSelector:e.substring(e.search(new RegExp(o)))}:{elementSelector:e.substring(n.length,e.lastIndexOf(r))}},P=function(e){if(!e)return"";for(var t=":"+a.ATTR_REGEXP_METHOD_NAME+"(",n=a.REGEXP_START_SUBSTR,r=a.REGEXP_END_SUBSTR+")",i="[",o="='",s="']",l=".",c="#",u=null,d=null,f="",E=e,p=function(e){return e.replace(/\\\\/g,"\\")};E;)if(f+=f?m:g,0===E.indexOf(c)){var A=E.substring(c.length);f+=M(_,["id",A]),E=""}else if(0===E.indexOf(l)){var T="",C=E.indexOf(t)>0?E.indexOf(i)>0?Math.min(E.indexOf(t),E.indexOf(i)):E.indexOf(t):E.indexOf(i);if(C>0?(T=E.substring(0,C),E=E.substring(C)):(T=E,E=""),T=T.substring(l.length).replace(/\./g," "),!T)return"";f+=M(h,["class",T])}else if(0===E.indexOf(t)){if(E.indexOf(r)<0)return"";if(u=E.substring(t.length,E.indexOf(r)),u.indexOf(n)<0)return"";E=E.substring(E.indexOf(r)+r.length),d=u.substring(0,u.indexOf(n));var R=u.substring(u.indexOf(n)+n.length);R=p(R),f+=M(v,[d,R])}else{if(0!==E.indexOf(i))return"";if(E.indexOf(s)<0)return"";if(u=E.substring(i.length,E.indexOf(s)),u.indexOf(o)<0)return"";E=E.substring(E.indexOf(s)+s.length),d=u.substring(0,u.indexOf(o));var I=u.substring(u.indexOf(o)+o.length);I=p(I),f+="id"===d?M(_,[d,I]):M(S,[d,I])}return f},N=function(e){var t=":"+a.CONTAINS_OWN_TEXT_METHOD_NAME+"(",n=")";return 0===e.indexOf(t)&&e.indexOf(n)>0?M(A,[e.substring(t.length,e.lastIndexOf(n))]):""},k=function(e){var t=e+1,n="th",r=t%10,i=(t%100-r)/10;return 1!==i&&(1===r?n="st":2===r?n="nd":3===r&&(n="rd")),t.toString()+n},x=function(e){for(var t="",n=e,r=" > ",i=":nth(",o=")";n;){if(n.indexOf(r)<0)return"";n=n.substring(n.indexOf(r)+r.length);var s=n.indexOf(i),a=n.indexOf(o);if(0>s||0>a||s>a)return"";var l=n.substring(0,s),c=n.substring(s+i.length,a);if(!l||!c)return"";n=n.substring(a+o.length),t&&(t+=", then "),t+=M("{0}",[k(parseInt(c))+" "+l])}return t},L=function(e){return e?M(T,[e]):void 0},w=function(e,t,n,r){var i=null,o=null;if(r){if(i=O(e,!0),i.elementSelector&&i.ancestorSelector){var s=r(i.ancestorSelector);if(o=n(i.elementSelector),s&&o)return M(t,[o,s],!0)}}else if(i=O(e,!1),i.elementSelector&&(o=n(i.elementSelector)))return M(t,[o],!0);return e},U=function(e,t,n){return[":",a.ATTR_REGEXP_METHOD_NAME,"(",e,a.REGEXP_START_SUBSTR,"^",t,n?"$":"",a.REGEXP_END_SUBSTR,")"].join("")},F=function(e){return e.parent().closest("[id]")},H=function(e){return[":",a.CONTAINS_OWN_TEXT_METHOD_NAME,"(",a.getOwnTextForSelector(e[0]).substr(0,c),")"].join("")},V=function(e){var t=[];if(e[0][s.OLD_ATTR_VALUES])for(var n in e[0][s.OLD_ATTR_VALUES])e[0][s.OLD_ATTR_VALUES].hasOwnProperty(n)&&G(e,n,e[0][s.OLD_ATTR_VALUES][n])&&t.push(n);else i.each(e[0].attributes,function(n,r){G(e,r.nodeName,r.nodeValue)&&t.push(r.nodeName)});return t},G=function(e,t,n){var i=new RegExp(r.DOM_SANDBOX_STORED_ATTR_POSTFIX+"$","g");if(n)for(var o=0;o<f.length;o++)if(f[o].test(t)&&!i.test(n)&&!i.test(t))return!0},K=function(e,t){var n=function(e,t){return e[0][s.OLD_ATTR_VALUES]?e[0][s.OLD_ATTR_VALUES][t]:e.attr(t)},r="";return i.each(t,function(t,i){var o=n(e,i),s=!1,a=!1;if(o.replace(/\s+/g," ").length>c&&(o=o.substr(0,c),s=!0,a=!0),new RegExp(u).test(o)||new RegExp(d).test(o)){var l=new RegExp(u).test(o)?u:d;o=o.replace(new RegExp(l),function(e){return a=!0,e.replace(/\d+/,E)})}o=o.replace(/\s+/g,function(e){return" "===e?e:(a=!0,p)}),a?(o=B(o),o=o.replace(new RegExp(E,"g"),"\\\\d+"),o=o.replace(new RegExp(p,"g"),"\\\\s+"),r+=U(i,o,!s)):(o=Y(o),r+="class"===i?"."+o.replace(/ +/g,"."):["[",i,"='",o,"']"].join(""))}),r},B=function(e){return e.replace(/'|"|\(|\)|\||\-|\*|\?|\+|\\|\^|\$|\[|\]/g,function(e){return"\\"===e?"\\\\\\\\":"("===e||")"===e?"\\\\S":'"'===e||"'"===e?"\\"+e:"\\\\"+e})},Y=function(e){return e.replace(/'|"|\\/g,function(e){return"\\"===e?"\\\\\\\\":"'"===e?"\\\\"+e:'"'===e?"\\"+e:e})},W=function(e){return e.replace(/\!|"|#|\$|%|&|\'|\(|\||\)|\*|\+|,|\.|\/|:|;|<|=|>|\?|@|\[|\\|\]|\^|`|{|\||}|~/g,function(e){return"\\"===e?"\\\\\\\\":'"'===e?"\\\\\\"+e:"\\\\"+e})},$=function(e,t){var n=function(e){return e.parent().length?" > "+e[0].tagName.toLowerCase()+":nth("+e.parent().find(">"+e[0].tagName).index(e)+")":void 0},r=n(e);return e.parentsUntil(t).each(function(){r=n(i(this))+r}),r},X=function(e){return!e.closest("html").length},Q=function(e){if(e[0][s.OLD_ATTR_VALUES])for(var t in e[0][s.OLD_ATTR_VALUES])if(e[0][s.OLD_ATTR_VALUES].hasOwnProperty(t)&&G(e,t,e[0][s.OLD_ATTR_VALUES][t])&&e[0][s.OLD_ATTR_VALUES][t]!==e.attr(t))return!0;return!1},q=function(){};q.prototype.wasElementChanged=function(e){return X(e)},q.prototype.getDescription=function(e){return e};var j=i.extend(new q,{check:function(e){return!!e.attr("id")},generate:function(e){var t=e.attr("id");if(new RegExp(u).test(t)){var n=B(t);return n=n.replace(new RegExp(u),function(e){return e.replace(/\d+/,"\\\\d+")}),{selector:U("id",n,!0),ancestorExpression:null}}return{selector:"#"+W(t),ancestorExpression:null}},getDescription:function(e){return w(e,C,P)},id:n.ruleIDs.BY_ID}),z=i.extend(new q,{check:function(e){return e.is("html")},generate:function(e){return{selector:e[0].tagName.toLowerCase(),ancestorExpression:null}},getDescription:function(e){return w(e,C,L)
},id:n.ruleIDs.FOR_HTML}),J=i.extend(new q,{check:function(e){return e.is("body")},generate:function(e){return{selector:e[0].tagName.toLowerCase(),ancestorExpression:null}},getDescription:function(e){return w(e,C,L)},id:n.ruleIDs.FOR_BODY}),Z=i.extend(new q,{check:function(e){return!!a.getOwnTextForSelector(e[0])},generate:function(e){return{selector:H(e),ancestorExpression:null}},getDescription:function(e){return w(e,C,N)},id:n.ruleIDs.BY_TEXT}),et=i.extend(new q,{check:function(e){return a.getOwnTextForSelector(e[0])&&F(e).length},generate:function(e){return{selector:H(e),ancestor:{rule:j,$el:F(e)}}},getDescription:function(e){return w(e,R,N,P)},id:n.ruleIDs.BY_ANCESTOR_AND_TEXT}),tt=i.extend(new q,{check:function(e){return!!V(e).length},generate:function(e){var t=V(e);return{selector:K(e,t),ancestorExpression:null}},wasElementChanged:function(e){return X(e)||Q(e)},getDescription:function(e){return w(e,C,P)},id:n.ruleIDs.BY_ATTR}),nt=i.extend(new q,{check:function(e){return V(e).length&&F(e).length},generate:function(e){var t=V(e);return{selector:K(e,t),ancestor:{rule:j,$el:F(e)}}},wasElementChanged:function(e){return X(e)&&Q(e)},getDescription:function(e){return w(e,R,P,P)},id:n.ruleIDs.BY_ANCESTOR_AND_ATTR}),rt=i.extend(new q,{check:function(){return!0},generate:function(e){return{selector:"body"+$(e,i("body",o.findDocument(e[0]))),ancestorExpression:null}},getDescription:function(e){return w(e,y,x)},id:n.ruleIDs.BY_TAGS_TREE}),it=i.extend(new q,{check:function(e){if(/html|body/.test(e[0].tagName.toLowerCase()))return!1;for(var t=e.parentsUntil("body"),n=0;n<t.length;n++)if(Z.check(t.eq(n)))return!0;return!1},generate:function(e){if(/html|body/.test(e[0].tagName.toLowerCase()))return!1;for(var t=e.parentsUntil("body"),n=0;n<t.length;n++)if(Z.check(t.eq(n)))return{selector:$(e,t.eq(n)),ancestor:{rule:Z,$el:t.eq(n)}}},getDescription:function(e){return w(e,D,x,N)},id:n.ruleIDs.BY_ANCESTOR_WITH_TEXT_AND_TAGS_TREE}),ot=i.extend(new q,{check:function(e){if(/html|body/.test(e[0].tagName.toLowerCase()))return!1;for(var t=e.parentsUntil("body"),n=[j,tt],r=0;r<t.length;r++)for(var i=0;i<n.length;i++)if(n[i].check(t.eq(r)))return!0;return!1},generate:function(e){if(/html|body/.test(e[0].tagName.toLowerCase()))return!1;for(var t=e.parentsUntil("body"),n=[j,tt],r=0;r<t.length;r++){for(var i=null,o=t.eq(r),s=0;s<n.length;s++)n[s].check(o)&&(i=n[s]);if(i)return{selector:$(e,t.eq(r)),ancestor:{rule:i,$el:o}}}},getDescription:function(e){return w(e,D,x,P)},id:n.ruleIDs.BY_ANCESTOR_WITH_ATTR_AND_TAGS_TREE}),st=i.extend(new q,{check:function(e){if(e.is("input")&&e.attr("name")){var t=e.closest("form");return t.length&&(j.check(t)||tt.check(t))}return!1},generate:function(e){var t=e.closest("form"),n=null,r=[j,tt];if(t.length){for(var i=0;i<r.length;i++)r[i].check(t)&&(n=r[i]);if(n)return{selector:K(e,["name"]),ancestor:{rule:n,$el:t}}}},getDescription:function(e){return w(e,I,P,P)},id:n.ruleIDs.BY_INPUT_NAME_AND_FORM});n.makeSelectorUnique=function(e,t,n){var r=n.index(t);1===n.length&&r>=0||(0!==n.length||-1!==r)&&(-1===r&&(r=0),e.selector=e.selector+".eq("+r+")",e.description=e.description+" "+M(b,[k(r)]))},n.init=function(){l=[z,J,st,j,et,Z,nt,tt,it,ot,rt]},n.getRules=function(){return l||n.init(),l}}),n.define("Recorder.SelectorGenerator",function(e,n){var r=t.get("Hammerhead"),i=r.$,o=r.Util,s=e("Recorder.SelectorGenerator.Rules"),a=e("Base.JavascriptExecutor"),l=[],c={},u=!1,d=10,f=20,E=function(e,t){if(t>0){for(var n=0;n<l.length;n++)if(c[l[n].id]===t&&l[n]!==this){E(l[n].id,t+1);break}c[e]=t}else c[e]=0},p=function(e){return c[e]||0};n.getRulePriorities=function(){return c};var g=function(){return Math.pow(10,l.length.toString().length)},m=function(){c={},E(s.ruleIDs.FOR_HTML,1),E(s.ruleIDs.FOR_BODY,2),E(s.ruleIDs.BY_ID,3),E(s.ruleIDs.BY_INPUT_NAME_AND_FORM,4),E(s.ruleIDs.BY_TEXT,5),E(s.ruleIDs.BY_ANCESTOR_AND_TEXT,6),E(s.ruleIDs.BY_ATTR,7),E(s.ruleIDs.BY_ANCESTOR_AND_ATTR,8),E(s.ruleIDs.BY_ANCESTOR_WITH_ATTR_AND_TAGS_TREE,g()*d),E(s.ruleIDs.BY_ANCESTOR_WITH_TEXT_AND_TAGS_TREE,p(s.ruleIDs.BY_ANCESTOR_WITH_ATTR_AND_TAGS_TREE)+1),E(s.ruleIDs.BY_TAGS_TREE,g()*f)},h=function(e,t,n){var r=n.wasElementChanged(e);return 1!==t.length||r||t[0]!==e[0]?0===t.length&&r?p(n.id):t.length&&(r||-1!==t.index(e))?p(n.id)+g()*(t.length+(r?1:0)):0:p(n.id)},_=function(e,t){e.sort(function(e,n){return t[e.selector]<t[n.selector]?-1:t[e.selector]>t[n.selector]?1:0})},S=function(e){if(o.isElementInIframe(e[0])){var t=o.getIFrameByElement(e[0]);if(t){var r=n.generate(i(t));if(r.length)return r[0].selector+".contents()"}}return""},v=function(e,t,n){if(n)return[n,'.find("',t,'")'].join("");var r=S(e);return r?['$("',t,'", ',r,")"].join(""):['$("',t,'")'].join("")},A=function(e,t){var n=t.generate(e),r="";return"string"==typeof n?n:(n.ancestor&&(r=A(n.ancestor.$el,n.ancestor.rule)),v(e,n.selector,r))},T=function(){l=s.getRules(),m(),u=!0};n.generate=function(e){u||T();var t=[],n={};if(!e.length)return t;for(var r=0;r<l.length;r++)if(l[r].check(e)){var i=A(e,l[r]),o=a.parseSelectorSync(i).$elements;if(!i||!o)continue;var c=h(e,o,l[r]),d=l[r].getDescription(i),f={id:l[r].id,selector:i,description:d};if(s.makeSelectorUnique(f,e,o),c>0)if(n[f.selector]){if(c<n[f.selector]){n[f.selector]=c;for(var E=0;E<t.length;E++)t[E]=f}}else t.push(f),n[f.selector]=c}return _(t,n),t}}),n.define("Recorder.StepNameGenerator",function(e,n){function r(e){var t=e&&e.tagName?e.tagName.toLowerCase():"",n=e&&e.type?e.type.toLowerCase():"";if(s[t])return s[t];if(-1!==o.inArray(t,a))return"<"+t+">";if("button"===t&&n&&"button"!==n)return n+" button";if("command"===t&&n&&"command"!==n)return n+" command";if("input"===t){if(!n||n&&"text"===n)return t;if(n&&/hidden|password/.test(n))return n+" input";if(n&&/file|image|reset|submit|radio/.test(n))return n+" button";if(n&&/checkbox/.test(n))return"check box";if(n&&/button/.test(n))return"button"}return t}var i=t.get("Hammerhead"),o=i.$,s={a:"link",img:"image",li:"list item",ol:"ordered list",p:"paragraph",q:"quotation",td:"table cell",th:"header cell",tr:"table row",ul:"unordered list",textarea:"text area"},a=["b","bdi","bdo","big","blockquote","br","center","cite","code","col","colgroup","del","dfn","em","font","header","hgroup","h1","h2","h3","h4","h5","h6","hr","i","ins","kbd","mark","optgroup","pre","ruby","rp","rt","s","samp","small","strike","strong","sub","sup","thead","tfoot","tbody","tt","u","var","wbr","svg","text","path","textpath","tspan","tref","dd","dir","dl","dt","nav"];n.generateStepName=function(e){var t=e.type[0].toUpperCase()+e.type.substring(1)+" ",i=e.element,s=e.elements,a=i&&i.tagName?i.tagName.toLowerCase():"",l=i&&i.type?i.type.toLowerCase():"",c="",u=null,d=function(e){var t=[],n=/(\s|$)/g,r=20,i="";if(e=o.trim(e).replace(/(\n)|(\r\n)/g,"").replace(/\s+/g," "),e.length<=r)return e;for(;n.exec(e)&&t.length<3;)t.push(n.lastIndex);return o.each(t.reverse(),function(t,n){return r>n?(i=e.substring(0,n-1)+"...",!1):void 0}),i||e.substring(0,r-1)+"..."},f=function(){var e=null,t="",n="";return o.each(arguments[0],function(r,s){if("text"===s){for(var a=0;a<i.childNodes.length;++a)3===i.childNodes[a].nodeType&&(n+=i.childNodes[a].textContent?i.childNodes[a].textContent:i.innerText);e=o.trim(n)}else e=i[s];return e?(t="text"===s?' "'+d(e)+'"':' "'+d(e)+'"',!1):void 0}),t};if("press"===e.type)return t+=/\+/.test(e.apiArguments.keysCommand)?"key combination "+e.apiArguments.keysCommand.toUpperCase():"key "+e.apiArguments.keysCommand.toUpperCase();if("wait"===e.type)return t+=e.apiArguments.ms+" milliseconds";if("screenshot"===e.type)return"Take a "+e.type;if("type"===e.type)t+="in ";else if("hover"===e.type)t+="over ";else if("select"===e.type)t+="in ";else if("upload"===e.type){var E=e.serviceInfo.fileNames;return E.join("")?t+='"'+E.join('", "')+'" file'+(E.length>1?"s":""):t="Clean up file input",t}t+=r(i);var p=o('label[for="'+i.id+'"]'),g=p.length?d(p.text()):"";switch(a){case"body":case"html":break;case"a":case"map":case"object":case"output":t+=f(["text","title","name"]);break;case"area":case"img":t+=f(["title","alt"]);break;case"form":case"iframe":case"keygen":case"select":t+=f(["title","name"]);break;case"optgroup":case"track":t+=f(["label","title"]);break;case"button":t+=f(["text","value","title","name"]);break;case"command":t+=f(["text","label","title"]);break;case"details":var m=f(["text"]);if(m)t+=m;else{var h=o(i).children("summary");t+=h.length&&o.trim(h.text())?' "'+d(h.text())+'"':f(["title"])}break;case"fieldset":var _=o(i).children("legend");if(_.length&&o.trim(_.text()))t+=' "'+d(_.text())+'"';else{var S=f(["text","title","name"]);S?t+=S:_.length&&_[0].title&&(t+=' "'+d(_[0].title)+'"')}break;case"figure":var v=o(i).children("figcaption");t+=v.length&&o.trim(v.text())?' "'+d(v.text())+'"':f(["text","title"]);break;case"input":!l||l&&("text"===l||"password"===l||"hidden"===l||"file"===l)?t+=g?' "'+g+'"':f(["title","name"]):l&&"image"===l?t+=g?' "'+g+'"':f(["title","alt","name"]):!l||"button"!==l&&"submit"!==l&&"reset"!==l?!l||"checkbox"!==l&&"radio"!==l||(t+=g?' "'+g+'"':f(["title","value","name"])):t+=f(["value"])?f(["value"]):g?' "'+g+'"':f(["title","name"]);break;case"menu":t+=f(["text","label","title"]);break;case"option":t+=f(["label","text","title","value"]);break;case"table":var A=o(i).children("caption");t+=A.length&&o.trim(A.text())?' "'+d(A.text())+'"':f(["text","title"]);break;case"textarea":t+=g?' "'+g+'"':f(["title","name"]);break;default:t+=f(["text","title"])}return s&&(2===s.length&&"select"===s[0].tagName.toLowerCase()&&"select"===s[1].tagName.toLowerCase()&&s[0]===s[1]?t+=" twice":o.each(s,function(r,i){0!==r&&(u=o.extend(u,e),u.element=i,delete u.elements,c=n.generateStepName(u),t+=" and "+c.charAt(0).toLowerCase()+c.substring(1))})),t}}),n.define("Recorder.Util",function(n,r){var i=t.get("Hammerhead"),o=i.$,s=i.JSON,a=n("Recorder.StepNameGenerator"),l=n("Shared.ServiceCommands"),c=n("Base.Transport");r.ELEMENT_PICKING_CLASSES={elementFrame:"element-frame",elementFramePart:"element-frame-part"},r.ELEMENTS_MARKER_CLASS="elements-marker",r.BROWSER_DIALOG_INDEXES={alert:0,confirm:1,prompt:2,beforeUnload:3},r.getActionStepInfo=function(e){var t=e.element;t&&(e.element=null);var n=o.extend(!0,{},e);return t&&(e.element=t,n.element=t),{name:a.generateStepName(e),actionDescriptor:n,selectors:e.serviceInfo&&e.serviceInfo.selectors,iFrameSelectors:null,currentSelectorIndex:0,currentIFrameSelectorIndex:0,useOffsets:e.serviceInfo&&e.serviceInfo.useOffsets}},r.getAssertionsStepInfo=function(){return{isAssertion:!0,name:"Assert",blocks:[]}},r.parseStepArguments=function(e){if(!e.isAssertion){var t=e.actionDescriptor;"drag"===t.type&&(""===t.apiArguments.dragOffsetX&&(t.apiArguments.dragOffsetX=0),""===t.apiArguments.dragOffsetX&&(t.apiArguments.dragOffsetX=0)),"wait"===t.type&&""===t.apiArguments.ms&&(t.apiArguments.ms=0)}},r.getServerCompatibleStepInfo=function(e){return e.isAssertion?e:r.getServerCompatibleActionStepInfo(e)},r.sendStepsInfo=function(e,t,n,i){for(var o=[],s=0;s<e.length;s++)o.push(r.getServerCompatibleStepInfo(e[s]));var a={cmd:l.STEPS_INFO_SET,stepsInfo:o,hasUnsavedChanges:t,getStepsScript:i};c.queuedAsyncServiceMsg(a,n)},r.getServerCompatibleActionStepInfo=function(e){var t={action:e.actionDescriptor.type,actionArgs:[],failed:e.failed||!1,error:e.error||null,dialogError:e.dialogError||null};for(var n in e)e.hasOwnProperty(n)&&!/actiondescriptor|actionargs/.test(n.toLowerCase())&&(/selectors/.test(n.toLowerCase())&&"undefined"!=typeof e[n]&&(t[n]=e[n]&&e[n].length?o.extend(!0,[],e[n]):null),t[n]=/nativedialoghandlers/.test(n.toLowerCase())&&"undefined"!=typeof e[n]?e[n]&&e[n].length?o.extend(!0,[],e[n]):null:e[n]);var r=e.actionDescriptor.apiArguments,i=null;return"drag"===e.actionDescriptor.type&&(t.actionArgs.push({dragOffsetX:r.dragOffsetX}),t.actionArgs.push({dragOffsetY:r.dragOffsetY})),"type"===e.actionDescriptor.type&&t.actionArgs.push({text:r.text}),"press"===e.actionDescriptor.type&&t.actionArgs.push({keysCommand:r.keysCommand}),"wait"===e.actionDescriptor.type&&t.actionArgs.push({ms:r.ms}),"select"===e.actionDescriptor.type&&(t.actionArgs.push({startPos:r.startPos}),t.actionArgs.push({endPos:r.endPos})),"upload"===e.actionDescriptor.type&&t.actionArgs.push({files:r.files}),/click|drag|type|hover/.test(e.actionDescriptor.type)&&r.options&&(i=o.extend(!0,{},r.options),i&&t.actionArgs.push({options:i})),t},r.parseServerCompatibleStepInfo=function(e){return e.isAssertion?e:r.parseServerCompatibleActionStepInfo(e)},r.parseServerCompatibleActionStepInfo=function(e){for(var t=o.extend(!0,{},e,{actionDescriptor:{type:e.action,apiArguments:{},failed:e.failed,error:null}}),n=0;n<e.actionArgs.length;n++){var r=e.actionArgs[n];for(var i in r)r.hasOwnProperty(i)&&(t.actionDescriptor.apiArguments[i]=r[i])}return t};var u={};r.serializeStepInfo=function(e){return e.id||(e.id=Date.now()),e.actionDescriptor&&(e.actionDescriptor.serviceInfo&&e.actionDescriptor.serviceInfo.prevPageState&&(u[e.id]=e.actionDescriptor.serviceInfo.prevPageState,e.actionDescriptor.serviceInfo.prevPageState=null),e.actionDescriptor.element=null),s.stringify(e)},r.parseStepInfo=function(e){var t=s.parse(e);return t.id&&u[t.id]&&(t.actionDescriptor.serviceInfo.prevPageState=u[t.id]),t},r.getNativeDialogs=function(){return function(t,n,r){return{alert:function(n){return t.call(e,n)},confirm:function(t){return n.call(e,t)},prompt:function(t){return r.call(e,t)}}}(e.alert,e.confirm,e.prompt)}}),n.define("Recorder.IFrameRecorder",function(n){var r=t.get("Hammerhead"),i=r.$,o=r.MessageSandbox,s=r.Util,a=n("Base.JavascriptExecutor"),l=n("Settings"),c=n("Recorder.SelectorGenerator"),u=n("Shared.Const"),d=n("Automation"),f=n("Recorder.EventListener"),E=n("Recorder.RecorderBase"),p=n("UI.Recorder"),g=n("Recorder.Util"),m=r.PageState,h=n("Recorder.ElementPicker"),_=this.exports=function(e){E.apply(this,[e])};s.inherit(_,E),_.prototype.completeInitialization=function(){var t={cmd:E.IFRAME_RECORDER_INITIALIZED_CMD};o.sendServiceMsg(t,e.top);var n=this;o.on(o.SERVICE_MSG_RECEIVED,function(e){var t=e.message;switch(t.cmd){case E.START_IFRAME_RECORDER_CMD:l.PLAYBACK=!1,n.start(),t.initNativeDialogs&&n.initNativeDialogsHandling();break;case E.IFRAME_CONFIRM_ACTION_RESPONSE_CMD:"function"==typeof n.currentConfirmationCallback&&(n.currentConfirmationCallback(t.confirmed,t.stepInfo?g.parseStepInfo(t.stepInfo):null),n.currentConfirmationCallback=null);break;case E.IFRAME_TYPING_STATE_CHANGED_RESPONSE_CMD:"function"==typeof n.currentCompleteTypingCallback&&(n.currentCompleteTypingCallback(),n.currentCompleteTypingCallback=null);break;case E.IFRAME_CLICK_EDITOR_STATE_CHANGED_RESPONSE_CMD:"function"==typeof n.currentCompleteClickEditorCallback&&(n.currentCompleteClickEditorCallback(),n.currentCompleteClickEditorCallback=null);break;case E.IFRAME_START_PICKING_ELEMENT_CMD:n._startPickingElement();break;case E.IFRAME_STOP_PICKING_ELEMENT_CMD:n._stopPickingElement();break;case E.IFRAME_HOVER_ACTION_RECORDED_CMD:n._hoverActionRecorded(t.elementSelectors,t.options);break;case E.IFRAME_CREATE_ALL_DEFERRED_ACTIONS_CMD:f.setPreventingMode(!0),n._createAllDeferred(),f.setPreventingMode(!1)}}),this.currentConfirmationCallback=null,this.currentCompleteTypingCallback=null,this.currentCompleteClickEditorCallback=null},_.prototype.start=function(e){_.base.start.call(this,e)},_.prototype._saveDialogHandler=function(t,n){var r=function(){var r={cmd:E.IFRAME_SAVE_DIALOG_HANDLER_CMD,dialog:t,retValue:n};o.sendServiceMsg(r,e.top)};if(this.stepSaving&&"beforeUnload"!==t){var i=function(e){e.message.cmd===E.IFRAME_SAVE_STEP_RESPONSE_CMD&&(o.off(o.SERVICE_MSG_RECEIVED,i),r())};o.on(o.SERVICE_MSG_RECEIVED,i)}else r()},_.prototype._initUi=function(){function t(t){var n={cmd:E.IFRAME_SHORTCUT_PRESSED_START_CMD,shortcut:t};o.sendServiceMsg(n,e.top)}function n(t){var n={cmd:E.IFRAME_SHORTCUT_PRESSED_END_CMD,shortcut:t};o.sendServiceMsg(n,e.top)}function r(e){return{start:function(){f.setPreventingMode(!0),t(e)},end:function(){e===d.ADD_ACTION_SHORTCUTS.wait&&i._createAllDeferred(),n(e),f.setPreventingMode(!1)}}}var i=this;this.recordingManagerOptions.typingStateChangedCallback=function(t,n){t&&(i.currentCompleteTypingCallback=n);var r={cmd:E.IFRAME_TYPING_STATE_CHANGED_REQUEST_CMD,rect:s.getElementClientRectangle(s.getActiveElement()),isTypingStarted:t};o.sendServiceMsg(r,e.top)},this.recordingManagerOptions.clickEditorStateChangedCallback=function(t,n){t&&(i.currentCompleteClickEditorCallback=n);var r={cmd:E.IFRAME_CLICK_EDITOR_STATE_CHANGED_REQUEST_CMD,rect:s.getElementClientRectangle(s.getActiveElement()),isClickOnEditorStarted:t};o.sendServiceMsg(r,e.top)};for(var a in p.Shortcuts)p.Shortcuts.hasOwnProperty(a)&&(i.recordingManagerOptions.executableShortcuts[a]=r(a))},_.prototype._startPickingElement=function(){_.base._startPickingElement.call(this),f.pause(),this.elementPickCallback=function(t,n,r){o.sendServiceMsg({cmd:E.IFRAME_ELEMENT_PICKED_CMD,elementSelector:t,iFrameSelectors:n,options:r},e.top)},h.start(this.elementPickCallback)},_.prototype._stopPickingElement=function(){_.base._stopPickingElement.call(this),f.resume()},_.prototype._initHammerheadEventHandling=function(){var t=this;r.on(r.FILE_UPLOADING_EVENT,function(n,r,s){var a=c.generate(i(r)),l=function(a){a.message.cmd===E.IFRAME_UPLOAD_ALLOWED_CMD&&(o.off(o.SERVICE_MSG_RECEIVED,l),s(function(s){var a=n.map(function(e){return u.UPLOADED_FILES_PATH+e});t._onActionParsed({type:"upload",apiArguments:{files:a},serviceInfo:{selectors:c.generate(i(r)),fileNames:n}}),o.sendServiceMsg({cmd:E.IFRAME_UPLOAD_COMPLETED_CMD,errs:s},e.top)}))};o.on(o.SERVICE_MSG_RECEIVED,l),o.sendServiceMsg({cmd:E.IFRAME_UPLOAD_REQUEST_TO_UPLOAD_CMD,fileNames:n,selectors:a},e.top)})},_.prototype._confirmAction=function(t,n){var r=this,i=m.saveState(),s={cmd:E.IFRAME_CONFIRM_ACTION_REQUEST_CMD,stepInfo:t?g.serializeStepInfo(t):null};this.currentConfirmationCallback=function(){var e=arguments;m.restoreState(i,!0,function(){n.apply(r,e)})},o.sendServiceMsg(s,e.top)},_.prototype._saveStep=function(t){this.stepSaving=!0;var n=this,r=function(e){e.message.cmd===E.IFRAME_SAVE_STEP_RESPONSE_CMD&&(o.off(o.SERVICE_MSG_RECEIVED,r),n.stepSaving=!1)};o.on(o.SERVICE_MSG_RECEIVED,r);var i={cmd:E.IFRAME_SAVE_STEP_REQUEST_CMD,stepInfo:g.serializeStepInfo(t)};o.sendServiceMsg(i,e.top)},_.prototype._hoverActionRecorded=function(e,t){var n=i.extend(d.defaultMouseActionDescriptor,{type:"hover",element:a.parseSelectorSync(e[0].selector).$elements[0],apiArguments:{options:t},selector:e[0].selector,serviceInfo:{selectors:e}});this._onActionParsed(n)}})},window.initTestCafeRecorder(window)}();